{"version":3,"sources":["../../../build/babel/preset.ts"],"sourcesContent":["import { PluginItem } from 'next/dist/compiled/babel/core'\nimport { dirname } from 'path'\n\nconst isLoadIntentTest = process.env.NODE_ENV === 'test'\nconst isLoadIntentDevelopment = process.env.NODE_ENV === 'development'\n\ntype StyledJsxPlugin = [string, any] | string\ntype StyledJsxBabelOptions =\n  | {\n      plugins?: StyledJsxPlugin[]\n      'babel-test'?: boolean\n    }\n  | undefined\n\n// Resolve styled-jsx plugins\nfunction styledJsxOptions(options: StyledJsxBabelOptions) {\n  if (!options) {\n    return {}\n  }\n\n  if (!Array.isArray(options.plugins)) {\n    return options\n  }\n\n  options.plugins = options.plugins.map(\n    (plugin: StyledJsxPlugin): StyledJsxPlugin => {\n      if (Array.isArray(plugin)) {\n        const [name, pluginOptions] = plugin\n        return [require.resolve(name), pluginOptions]\n      }\n\n      return require.resolve(plugin)\n    }\n  )\n\n  return options\n}\n\ntype NextBabelPresetOptions = {\n  'preset-env'?: any\n  'preset-react'?: any\n  'class-properties'?: any\n  'transform-runtime'?: any\n  'styled-jsx'?: StyledJsxBabelOptions\n  'preset-typescript'?: any\n}\n\ntype BabelPreset = {\n  presets?: PluginItem[] | null\n  plugins?: PluginItem[] | null\n  sourceType?: 'script' | 'module' | 'unambiguous'\n  overrides?: Array<{ test: RegExp } & Omit<BabelPreset, 'overrides'>>\n}\n\n// Taken from https://github.com/babel/babel/commit/d60c5e1736543a6eac4b549553e107a9ba967051#diff-b4beead8ad9195361b4537601cc22532R158\nfunction supportsStaticESM(caller: any): boolean {\n  return !!caller?.supportsStaticESM\n}\n\nexport default (\n  api: any,\n  options: NextBabelPresetOptions = {}\n): BabelPreset => {\n  const supportsESM = api.caller(supportsStaticESM)\n  const isServer = api.caller((caller: any) => !!caller && caller.isServer)\n  const isCallerDevelopment = api.caller((caller: any) => caller?.isDev)\n\n  // Look at external intent if used without a caller (e.g. via Jest):\n  const isTest = isCallerDevelopment == null && isLoadIntentTest\n\n  // Look at external intent if used without a caller (e.g. Storybook):\n  const isDevelopment =\n    isCallerDevelopment === true ||\n    (isCallerDevelopment == null && isLoadIntentDevelopment)\n\n  // Default to production mode if not `test` nor `development`:\n  const isProduction = !(isTest || isDevelopment)\n\n  const isBabelLoader = api.caller(\n    (caller: any) =>\n      !!caller &&\n      (caller.name === 'babel-loader' ||\n        caller.name === 'next-babel-turbo-loader')\n  )\n\n  const useJsxRuntime =\n    options['preset-react']?.runtime === 'automatic' ||\n    (Boolean(api.caller((caller: any) => !!caller && caller.hasJsxRuntime)) &&\n      options['preset-react']?.runtime !== 'classic')\n\n  const presetEnvConfig = {\n    // In the test environment `modules` is often needed to be set to true, babel figures that out by itself using the `'auto'` option\n    // In production/development this option is set to `false` so that webpack can handle import/export with tree-shaking\n    modules: 'auto',\n    exclude: ['transform-typeof-symbol'],\n    include: [\n      '@babel/plugin-proposal-optional-chaining',\n      '@babel/plugin-proposal-nullish-coalescing-operator',\n    ],\n    ...options['preset-env'],\n  }\n\n  // When transpiling for the server or tests, target the current Node version\n  // if not explicitly specified:\n  if (\n    (isServer || isTest) &&\n    (!presetEnvConfig.targets ||\n      !(\n        typeof presetEnvConfig.targets === 'object' &&\n        'node' in presetEnvConfig.targets\n      ))\n  ) {\n    presetEnvConfig.targets = {\n      // Targets the current process' version of Node. This requires apps be\n      // built and deployed on the same version of Node.\n      // This is the same as using \"current\" but explicit\n      node: process.versions.node,\n    }\n  }\n\n  return {\n    sourceType: 'unambiguous',\n    presets: [\n      [require('next/dist/compiled/babel/preset-env'), presetEnvConfig],\n      [\n        require('next/dist/compiled/babel/preset-react'),\n        {\n          // This adds @babel/plugin-transform-react-jsx-source and\n          // @babel/plugin-transform-react-jsx-self automatically in development\n          development: isDevelopment || isTest,\n          ...(useJsxRuntime ? { runtime: 'automatic' } : { pragma: '__jsx' }),\n          ...options['preset-react'],\n        },\n      ],\n      [\n        require('next/dist/compiled/babel/preset-typescript'),\n        { allowNamespaces: true, ...options['preset-typescript'] },\n      ],\n    ],\n    plugins: [\n      !useJsxRuntime && [\n        require('./plugins/jsx-pragma'),\n        {\n          // This produces the following injected import for modules containing JSX:\n          //   import React from 'react';\n          //   var __jsx = React.createElement;\n          module: 'react',\n          importAs: 'React',\n          pragma: '__jsx',\n          property: 'createElement',\n        },\n      ],\n      [\n        require('./plugins/optimize-hook-destructuring'),\n        {\n          // only optimize hook functions imported from React/Preact\n          lib: true,\n        },\n      ],\n      require('next/dist/compiled/babel/plugin-syntax-dynamic-import'),\n      require('next/dist/compiled/babel/plugin-syntax-import-assertions'),\n      require('./plugins/react-loadable-plugin'),\n      [\n        require('next/dist/compiled/babel/plugin-proposal-class-properties'),\n        options['class-properties'] || {},\n      ],\n      [\n        require('next/dist/compiled/babel/plugin-proposal-object-rest-spread'),\n        {\n          useBuiltIns: true,\n        },\n      ],\n      !isServer && [\n        require('next/dist/compiled/babel/plugin-transform-runtime'),\n        {\n          corejs: false,\n          helpers: true,\n          regenerator: true,\n          useESModules: supportsESM && presetEnvConfig.modules !== 'commonjs',\n          absoluteRuntime: isBabelLoader\n            ? dirname(\n                require.resolve(\n                  'next/dist/compiled/@babel/runtime/package.json'\n                )\n              )\n            : undefined,\n          ...options['transform-runtime'],\n        },\n      ],\n      [\n        isTest && options['styled-jsx'] && options['styled-jsx']['babel-test']\n          ? require('styled-jsx/babel-test')\n          : require('styled-jsx/babel'),\n        styledJsxOptions(options['styled-jsx']),\n      ],\n      require('./plugins/amp-attributes'),\n      isProduction && [\n        require('next/dist/compiled/babel/plugin-transform-react-remove-prop-types'),\n        {\n          removeImport: true,\n        },\n      ],\n      isServer && require('next/dist/compiled/babel/plugin-syntax-bigint'),\n      // Always compile numeric separator because the resulting number is\n      // smaller.\n      require('next/dist/compiled/babel/plugin-proposal-numeric-separator'),\n      require('next/dist/compiled/babel/plugin-proposal-export-namespace-from'),\n    ].filter(Boolean),\n  }\n}\n"],"names":["isLoadIntentTest","process","env","NODE_ENV","isLoadIntentDevelopment","styledJsxOptions","options","Array","isArray","plugins","map","plugin","name","pluginOptions","require","resolve","supportsStaticESM","caller","api","supportsESM","isServer","isCallerDevelopment","isDev","isTest","isDevelopment","isProduction","isBabelLoader","useJsxRuntime","runtime","Boolean","hasJsxRuntime","presetEnvConfig","modules","exclude","include","targets","node","versions","sourceType","presets","development","pragma","allowNamespaces","module","importAs","property","lib","useBuiltIns","corejs","helpers","regenerator","useESModules","absoluteRuntime","undefined","removeImport","filter"],"mappings":"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"}