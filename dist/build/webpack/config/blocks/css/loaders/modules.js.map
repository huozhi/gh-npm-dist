{"version":3,"sources":["../../../../../../../build/webpack/config/blocks/css/loaders/modules.ts"],"sourcesContent":["import { webpack } from 'next/dist/compiled/webpack/webpack'\nimport { ConfigurationContext } from '../../../utils'\nimport { getClientStyleLoader } from './client'\nimport { cssFileResolve } from './file-resolve'\nimport { getCssModuleLocalIdent } from './getCssModuleLocalIdent'\n\nexport function getCssModuleLoader(\n  ctx: ConfigurationContext,\n  postcss: any,\n  preProcessors: readonly webpack.RuleSetUseItem[] = []\n): webpack.RuleSetUseItem[] {\n  const loaders: webpack.RuleSetUseItem[] = []\n\n  if (ctx.isClient) {\n    // Add appropriate development more or production mode style\n    // loader\n    loaders.push(\n      getClientStyleLoader({\n        isDevelopment: ctx.isDevelopment,\n        assetPrefix: ctx.assetPrefix,\n      })\n    )\n  }\n\n  // Resolve CSS `@import`s and `url()`s\n  loaders.push({\n    loader: require.resolve('../../../../loaders/css-loader/src'),\n    options: {\n      postcss,\n      importLoaders: 1 + preProcessors.length,\n      // Use CJS mode for backwards compatibility:\n      esModule: false,\n      url: (url: string, resourcePath: string) =>\n        cssFileResolve(url, resourcePath, ctx.experimental.urlImports),\n      import: (url: string, _: any, resourcePath: string) =>\n        cssFileResolve(url, resourcePath, ctx.experimental.urlImports),\n      modules: {\n        // Do not transform class names (CJS mode backwards compatibility):\n        exportLocalsConvention: 'asIs',\n        // Server-side (Node.js) rendering support:\n        exportOnlyLocals: ctx.isServer,\n        // Disallow global style exports so we can code-split CSS and\n        // not worry about loading order.\n        mode: 'pure',\n        // Generate a friendly production-ready name so it's\n        // reasonably understandable. The same name is used for\n        // development.\n        // TODO: Consider making production reduce this to a single\n        // character?\n        getLocalIdent: getCssModuleLocalIdent,\n      },\n    },\n  })\n\n  // Compile CSS\n  loaders.push({\n    loader: require.resolve('../../../../loaders/postcss-loader/src'),\n    options: {\n      postcss,\n    },\n  })\n\n  loaders.push(\n    // Webpack loaders run like a stack, so we need to reverse the natural\n    // order of preprocessors.\n    ...preProcessors.slice().reverse()\n  )\n\n  return loaders\n}\n"],"names":["getCssModuleLoader","ctx","postcss","preProcessors","loaders","isClient","push","isDevelopment","assetPrefix","loader","require","resolve","options","importLoaders","length","esModule","url","resourcePath","experimental","urlImports","import","_","modules","exportLocalsConvention","exportOnlyLocals","isServer","mode","getLocalIdent","slice","reverse"],"mappings":";;;;QAMgBA,kBAAkB,GAAlBA,kBAAkB;AAJG,GAAU,CAAV,OAAU;AAChB,GAAgB,CAAhB,YAAgB;AACR,GAA0B,CAA1B,uBAA0B;SAEjDA,kBAAkB,CAChCC,GAAyB,EACzBC,OAAY,EACZC,aAAgD,GAAG,CAAC,CAAC,EAC3B,CAAC;IAC3B,KAAK,CAACC,OAAO,GAA6B,CAAC,CAAC;IAE5C,EAAE,EAAEH,GAAG,CAACI,QAAQ,EAAE,CAAC;QACjB,EAA4D,AAA5D,0DAA4D;QAC5D,EAAS,AAAT,OAAS;QACTD,OAAO,CAACE,IAAI,KAdqB,OAAU,uBAepB,CAAC;YACpBC,aAAa,EAAEN,GAAG,CAACM,aAAa;YAChCC,WAAW,EAAEP,GAAG,CAACO,WAAW;QAC9B,CAAC;IAEL,CAAC;IAED,EAAsC,AAAtC,oCAAsC;IACtCJ,OAAO,CAACE,IAAI,CAAC,CAAC;QACZG,MAAM,EAAEC,OAAO,CAACC,OAAO,CAAC,CAAoC;QAC5DC,OAAO,EAAE,CAAC;YACRV,OAAO;YACPW,aAAa,EAAE,CAAC,GAAGV,aAAa,CAACW,MAAM;YACvC,EAA4C,AAA5C,0CAA4C;YAC5CC,QAAQ,EAAE,KAAK;YACfC,GAAG,GAAGA,GAAW,EAAEC,YAAoB,OA7Bd,YAAgB,iBA8BxBD,GAAG,EAAEC,YAAY,EAAEhB,GAAG,CAACiB,YAAY,CAACC,UAAU;;YAC/DC,MAAM,GAAGJ,GAAW,EAAEK,CAAM,EAAEJ,YAAoB,OA/BzB,YAAgB,iBAgCxBD,GAAG,EAAEC,YAAY,EAAEhB,GAAG,CAACiB,YAAY,CAACC,UAAU;;YAC/DG,OAAO,EAAE,CAAC;gBACR,EAAmE,AAAnE,iEAAmE;gBACnEC,sBAAsB,EAAE,CAAM;gBAC9B,EAA2C,AAA3C,yCAA2C;gBAC3CC,gBAAgB,EAAEvB,GAAG,CAACwB,QAAQ;gBAC9B,EAA6D,AAA7D,2DAA6D;gBAC7D,EAAiC,AAAjC,+BAAiC;gBACjCC,IAAI,EAAE,CAAM;gBACZ,EAAoD,AAApD,kDAAoD;gBACpD,EAAuD,AAAvD,qDAAuD;gBACvD,EAAe,AAAf,aAAe;gBACf,EAA2D,AAA3D,yDAA2D;gBAC3D,EAAa,AAAb,WAAa;gBACbC,aAAa,EA7CkB,uBAA0B;YA8C3D,CAAC;QACH,CAAC;IACH,CAAC;IAED,EAAc,AAAd,YAAc;IACdvB,OAAO,CAACE,IAAI,CAAC,CAAC;QACZG,MAAM,EAAEC,OAAO,CAACC,OAAO,CAAC,CAAwC;QAChEC,OAAO,EAAE,CAAC;YACRV,OAAO;QACT,CAAC;IACH,CAAC;IAEDE,OAAO,CAACE,IAAI,CACV,EAAsE,AAAtE,oEAAsE;IACtE,EAA0B,AAA1B,wBAA0B;OACvBH,aAAa,CAACyB,KAAK,GAAGC,OAAO;IAGlC,MAAM,CAACzB,OAAO;AAChB,CAAC"}