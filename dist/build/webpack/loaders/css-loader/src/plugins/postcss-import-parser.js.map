{"version":3,"sources":["../../../../../../../build/webpack/loaders/css-loader/src/plugins/postcss-import-parser.js"],"sourcesContent":["import valueParser from 'next/dist/compiled/postcss-value-parser'\n\nimport {\n  normalizeUrl,\n  resolveRequests,\n  isUrlRequestable,\n  requestify,\n  WEBPACK_IGNORE_COMMENT_REGEXP,\n} from '../utils'\n\nfunction parseNode(atRule, key) {\n  // Convert only top-level @import\n  if (atRule.parent.type !== 'root') {\n    return\n  }\n\n  if (\n    atRule.raws &&\n    atRule.raws.afterName &&\n    atRule.raws.afterName.trim().length > 0\n  ) {\n    const lastCommentIndex = atRule.raws.afterName.lastIndexOf('/*')\n    const matched = atRule.raws.afterName\n      .slice(lastCommentIndex)\n      .match(WEBPACK_IGNORE_COMMENT_REGEXP)\n\n    if (matched && matched[2] === 'true') {\n      return\n    }\n  }\n\n  const prevNode = atRule.prev()\n\n  if (prevNode && prevNode.type === 'comment') {\n    const matched = prevNode.text.match(WEBPACK_IGNORE_COMMENT_REGEXP)\n\n    if (matched && matched[2] === 'true') {\n      return\n    }\n  }\n\n  // Nodes do not exists - `@import url('http://') :root {}`\n  if (atRule.nodes) {\n    const error = new Error(\n      \"It looks like you didn't end your @import statement correctly. Child nodes are attached to it.\"\n    )\n\n    error.node = atRule\n\n    throw error\n  }\n\n  const { nodes: paramsNodes } = valueParser(atRule[key])\n\n  // No nodes - `@import ;`\n  // Invalid type - `@import foo-bar;`\n  if (\n    paramsNodes.length === 0 ||\n    (paramsNodes[0].type !== 'string' && paramsNodes[0].type !== 'function')\n  ) {\n    const error = new Error(`Unable to find uri in \"${atRule.toString()}\"`)\n\n    error.node = atRule\n\n    throw error\n  }\n\n  let isStringValue\n  let url\n\n  if (paramsNodes[0].type === 'string') {\n    isStringValue = true\n    url = paramsNodes[0].value\n  } else {\n    // Invalid function - `@import nourl(test.css);`\n    if (paramsNodes[0].value.toLowerCase() !== 'url') {\n      const error = new Error(`Unable to find uri in \"${atRule.toString()}\"`)\n\n      error.node = atRule\n\n      throw error\n    }\n\n    isStringValue =\n      paramsNodes[0].nodes.length !== 0 &&\n      paramsNodes[0].nodes[0].type === 'string'\n    url = isStringValue\n      ? paramsNodes[0].nodes[0].value\n      : valueParser.stringify(paramsNodes[0].nodes)\n  }\n\n  url = normalizeUrl(url, isStringValue)\n\n  const isRequestable = isUrlRequestable(url)\n  let prefix\n\n  if (isRequestable) {\n    const queryParts = url.split('!')\n\n    if (queryParts.length > 1) {\n      url = queryParts.pop()\n      prefix = queryParts.join('!')\n    }\n  }\n\n  // Empty url - `@import \"\";` or `@import url();`\n  if (url.trim().length === 0) {\n    const error = new Error(`Unable to find uri in \"${atRule.toString()}\"`)\n\n    error.node = atRule\n\n    throw error\n  }\n\n  const mediaNodes = paramsNodes.slice(1)\n  let media\n\n  if (mediaNodes.length > 0) {\n    media = valueParser.stringify(mediaNodes).trim().toLowerCase()\n  }\n\n  // eslint-disable-next-line consistent-return\n  return { atRule, prefix, url, media, isRequestable }\n}\n\nconst plugin = (options = {}) => {\n  return {\n    postcssPlugin: 'postcss-import-parser',\n    prepare(result) {\n      const parsedAtRules = []\n\n      return {\n        AtRule: {\n          import(atRule) {\n            let parsedAtRule\n\n            try {\n              parsedAtRule = parseNode(atRule, 'params', result)\n            } catch (error) {\n              result.warn(error.message, { node: error.node })\n            }\n\n            if (!parsedAtRule) {\n              return\n            }\n\n            parsedAtRules.push(parsedAtRule)\n          },\n        },\n        async OnceExit() {\n          if (parsedAtRules.length === 0) {\n            return\n          }\n\n          const resolvedAtRules = await Promise.all(\n            parsedAtRules.map(async (parsedAtRule) => {\n              const { atRule, isRequestable, prefix, url, media } = parsedAtRule\n\n              if (options.filter) {\n                const needKeep = await options.filter(url, media)\n\n                if (!needKeep) {\n                  return\n                }\n              }\n\n              if (isRequestable) {\n                const request = requestify(url, options.rootContext)\n\n                const { resolver, context } = options\n                const resolvedUrl = await resolveRequests(resolver, context, [\n                  ...new Set([request, url]),\n                ])\n\n                if (!resolvedUrl) {\n                  return\n                }\n\n                if (resolvedUrl === options.resourcePath) {\n                  atRule.remove()\n\n                  return\n                }\n\n                atRule.remove()\n\n                // eslint-disable-next-line consistent-return\n                return { url: resolvedUrl, media, prefix, isRequestable }\n              }\n\n              atRule.remove()\n\n              // eslint-disable-next-line consistent-return\n              return { url, media, prefix, isRequestable }\n            })\n          )\n\n          const urlToNameMap = new Map()\n\n          for (let index = 0; index <= resolvedAtRules.length - 1; index++) {\n            const resolvedAtRule = resolvedAtRules[index]\n\n            if (!resolvedAtRule) {\n              // eslint-disable-next-line no-continue\n              continue\n            }\n\n            const { url, isRequestable, media } = resolvedAtRule\n\n            if (!isRequestable) {\n              options.api.push({ url, media, index })\n\n              // eslint-disable-next-line no-continue\n              continue\n            }\n\n            const { prefix } = resolvedAtRule\n            const newUrl = prefix ? `${prefix}!${url}` : url\n            let importName = urlToNameMap.get(newUrl)\n\n            if (!importName) {\n              importName = `___CSS_LOADER_AT_RULE_IMPORT_${urlToNameMap.size}___`\n              urlToNameMap.set(newUrl, importName)\n\n              options.imports.push({\n                type: 'rule_import',\n                importName,\n                url: options.urlHandler(newUrl),\n                index,\n              })\n            }\n\n            options.api.push({ importName, media, index })\n          }\n        },\n      }\n    },\n  }\n}\n\nplugin.postcss = true\n\nexport default plugin\n"],"names":["parseNode","atRule","key","parent","type","raws","afterName","trim","length","lastCommentIndex","lastIndexOf","matched","slice","match","prevNode","prev","text","nodes","error","Error","node","paramsNodes","toString","isStringValue","url","value","toLowerCase","stringify","isRequestable","prefix","queryParts","split","pop","join","mediaNodes","media","plugin","options","postcssPlugin","prepare","result","parsedAtRules","AtRule","import","parsedAtRule","warn","message","push","OnceExit","resolvedAtRules","Promise","all","map","filter","needKeep","request","rootContext","resolver","context","resolvedUrl","Set","resourcePath","remove","urlToNameMap","Map","index","resolvedAtRule","api","newUrl","importName","get","size","set","imports","urlHandler","postcss"],"mappings":"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"}