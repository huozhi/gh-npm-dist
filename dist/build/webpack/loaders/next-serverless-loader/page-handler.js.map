{"version":3,"sources":["../../../../../build/webpack/loaders/next-serverless-loader/page-handler.ts"],"sourcesContent":["import { IncomingMessage, ServerResponse } from 'http'\nimport { parse as parseUrl, format as formatUrl, UrlWithParsedQuery } from 'url'\nimport { DecodeError, isResSent } from '../../../../shared/lib/utils'\nimport { sendRenderResult } from '../../../../server/send-payload'\nimport { getUtils, vercelHeader, ServerlessHandlerCtx } from './utils'\n\nimport { renderToHTML } from '../../../../server/render'\nimport { tryGetPreviewData } from '../../../../server/api-utils'\nimport { denormalizePagePath } from '../../../../server/denormalize-page-path'\nimport { setLazyProp, getCookieParser } from '../../../../server/api-utils'\nimport { getRedirectStatus } from '../../../../lib/load-custom-routes'\nimport getRouteNoAssetPath from '../../../../shared/lib/router/utils/get-route-from-asset-path'\nimport { PERMANENT_REDIRECT_STATUS } from '../../../../shared/lib/constants'\nimport RenderResult from '../../../../server/render-result'\nimport isError from '../../../../lib/is-error'\n\nexport function getPageHandler(ctx: ServerlessHandlerCtx) {\n  const {\n    page,\n\n    pageComponent,\n    pageConfig,\n    pageGetStaticProps,\n    pageGetStaticPaths,\n    pageGetServerSideProps,\n\n    appModule,\n    documentModule,\n    errorModule,\n    notFoundModule,\n\n    encodedPreviewProps,\n    pageIsDynamic,\n    generateEtags,\n    poweredByHeader,\n\n    runtimeConfig,\n    buildManifest,\n    reactLoadableManifest,\n\n    i18n,\n    buildId,\n    basePath,\n    assetPrefix,\n    canonicalBase,\n    escapedBuildId,\n  } = ctx\n  const {\n    handleLocale,\n    handleRewrites,\n    handleBasePath,\n    defaultRouteRegex,\n    dynamicRouteMatcher,\n    interpolateDynamicPath,\n    getParamsFromRouteMatches,\n    normalizeDynamicRouteParams,\n    normalizeVercelUrl,\n  } = getUtils(ctx)\n\n  async function renderReqToHTML(\n    req: IncomingMessage,\n    res: ServerResponse,\n    renderMode?: 'export' | 'passthrough' | true,\n    _renderOpts?: any,\n    _params?: any\n  ) {\n    let Component\n    let App\n    let config\n    let Document\n    let Error\n    let notFoundMod\n    let getStaticProps\n    let getStaticPaths\n    let getServerSideProps\n    ;[\n      getStaticProps,\n      getServerSideProps,\n      getStaticPaths,\n      Component,\n      App,\n      config,\n      { default: Document },\n      { default: Error },\n      notFoundMod,\n    ] = await Promise.all([\n      pageGetStaticProps,\n      pageGetServerSideProps,\n      pageGetStaticPaths,\n      pageComponent,\n      appModule,\n      pageConfig,\n      documentModule,\n      errorModule,\n      notFoundModule,\n    ])\n\n    const fromExport = renderMode === 'export' || renderMode === true\n    const nextStartMode = renderMode === 'passthrough'\n\n    let hasValidParams = true\n\n    setLazyProp({ req: req as any }, 'cookies', getCookieParser(req.headers))\n\n    const options = {\n      App,\n      Document,\n      buildManifest,\n      getStaticProps,\n      getServerSideProps,\n      getStaticPaths,\n      reactLoadableManifest,\n      canonicalBase,\n      buildId,\n      assetPrefix,\n      runtimeConfig: (runtimeConfig || {}).publicRuntimeConfig || {},\n      previewProps: encodedPreviewProps,\n      env: process.env,\n      basePath,\n      supportsDynamicHTML: false, // Serverless target doesn't support streaming\n      ..._renderOpts,\n    }\n    let _nextData = false\n    let defaultLocale = i18n?.defaultLocale\n    let detectedLocale = i18n?.defaultLocale\n    let parsedUrl: UrlWithParsedQuery\n\n    try {\n      // We need to trust the dynamic route params from the proxy\n      // to ensure we are using the correct values\n      const trustQuery = !getStaticProps && req.headers[vercelHeader]\n      parsedUrl = parseUrl(req.url!, true)\n      let routeNoAssetPath = parsedUrl.pathname!\n\n      if (basePath) {\n        routeNoAssetPath =\n          routeNoAssetPath.replace(new RegExp(`^${basePath}`), '') || '/'\n      }\n      const origQuery = Object.assign({}, parsedUrl.query)\n\n      parsedUrl = handleRewrites(req, parsedUrl)\n      handleBasePath(req, parsedUrl)\n\n      // remove ?amp=1 from request URL if rendering for export\n      if (fromExport && parsedUrl.query.amp) {\n        const queryNoAmp = Object.assign({}, origQuery)\n        delete queryNoAmp.amp\n\n        req.url = formatUrl({\n          ...parsedUrl,\n          search: undefined,\n          query: queryNoAmp,\n        })\n      }\n\n      if (parsedUrl.pathname!.match(/_next\\/data/)) {\n        _nextData = page !== '/_error'\n        parsedUrl.pathname = getRouteNoAssetPath(\n          parsedUrl.pathname!.replace(\n            new RegExp(`/_next/data/${escapedBuildId}/`),\n            '/'\n          ),\n          '.json'\n        )\n        routeNoAssetPath = parsedUrl.pathname\n      }\n\n      const localeResult = handleLocale(\n        req,\n        res,\n        parsedUrl,\n        routeNoAssetPath,\n        fromExport || nextStartMode\n      )\n      defaultLocale = localeResult?.defaultLocale || defaultLocale\n      detectedLocale = localeResult?.detectedLocale || detectedLocale\n      routeNoAssetPath = localeResult?.routeNoAssetPath || routeNoAssetPath\n\n      if (parsedUrl.query.nextInternalLocale) {\n        detectedLocale = parsedUrl.query.nextInternalLocale as string\n        delete parsedUrl.query.nextInternalLocale\n      }\n\n      const renderOpts = Object.assign(\n        {\n          Component,\n          pageConfig: config,\n          nextExport: fromExport,\n          isDataReq: _nextData,\n          locales: i18n?.locales,\n          locale: detectedLocale,\n          defaultLocale,\n          domainLocales: i18n?.domains,\n          optimizeImages: process.env.__NEXT_OPTIMIZE_IMAGES,\n          optimizeCss: process.env.__NEXT_OPTIMIZE_CSS,\n          concurrentFeatures: process.env.__NEXT_CONCURRENT_FEATURES,\n          crossOrigin: process.env.__NEXT_CROSS_ORIGIN,\n        },\n        options\n      )\n\n      if (page === '/_error' && !res.statusCode) {\n        res.statusCode = 404\n      }\n\n      let params = {}\n\n      if (!fromExport && pageIsDynamic) {\n        const result = normalizeDynamicRouteParams(\n          trustQuery\n            ? parsedUrl.query\n            : (dynamicRouteMatcher!(parsedUrl.pathname) as Record<\n                string,\n                string | string[]\n              >)\n        )\n\n        hasValidParams = result.hasValidParams\n        params = result.params\n      }\n\n      let nowParams = null\n\n      if (\n        pageIsDynamic &&\n        !hasValidParams &&\n        req.headers?.['x-now-route-matches']\n      ) {\n        nowParams = getParamsFromRouteMatches(req, renderOpts, detectedLocale)\n      }\n\n      // make sure to set renderOpts to the correct params e.g. _params\n      // if provided from worker or params if we're parsing them here\n      renderOpts.params = _params || params\n\n      normalizeVercelUrl(req, !!trustQuery)\n\n      // normalize request URL/asPath for fallback/revalidate pages since the\n      // proxy sets the request URL to the output's path for fallback pages\n      if (pageIsDynamic && nowParams && defaultRouteRegex) {\n        const _parsedUrl = parseUrl(req.url!)\n\n        _parsedUrl.pathname = interpolateDynamicPath(\n          _parsedUrl.pathname!,\n          nowParams\n        )\n        parsedUrl.pathname = _parsedUrl.pathname\n        req.url = formatUrl(_parsedUrl)\n      }\n\n      // make sure to normalize asPath for revalidate and _next/data requests\n      // since the asPath should match what is shown on the client\n      if (!fromExport && (getStaticProps || getServerSideProps)) {\n        // don't include dynamic route params in query while normalizing\n        // asPath\n        if (pageIsDynamic && trustQuery && defaultRouteRegex) {\n          delete (parsedUrl as any).search\n\n          for (const param of Object.keys(defaultRouteRegex.groups)) {\n            delete origQuery[param]\n          }\n        }\n\n        parsedUrl.pathname = denormalizePagePath(parsedUrl.pathname!)\n        renderOpts.resolvedUrl = formatUrl({\n          ...parsedUrl,\n          query: origQuery,\n        })\n\n        // For getServerSideProps we need to ensure we use the original URL\n        // and not the resolved URL to prevent a hydration mismatch on asPath\n        renderOpts.resolvedAsPath = getServerSideProps\n          ? formatUrl({\n              ...parsedUrl,\n              pathname: routeNoAssetPath,\n              query: origQuery,\n            })\n          : renderOpts.resolvedUrl\n      }\n\n      const isFallback = parsedUrl.query.__nextFallback\n\n      const previewData = tryGetPreviewData(req, res, options.previewProps)\n      const isPreviewMode = previewData !== false\n\n      if (process.env.__NEXT_OPTIMIZE_FONTS) {\n        renderOpts.optimizeFonts = true\n        /**\n         * __webpack_require__.__NEXT_FONT_MANIFEST__ is added by\n         * font-stylesheet-gathering-plugin\n         */\n        // @ts-ignore\n        renderOpts.fontManifest = __webpack_require__.__NEXT_FONT_MANIFEST__\n      }\n\n      let result = await renderToHTML(\n        req,\n        res,\n        page,\n        Object.assign(\n          {},\n          getStaticProps\n            ? { ...(parsedUrl.query.amp ? { amp: '1' } : {}) }\n            : parsedUrl.query,\n          nowParams ? nowParams : params,\n          _params,\n          isFallback ? { __nextFallback: 'true' } : {}\n        ),\n        renderOpts\n      )\n\n      if (!renderMode) {\n        if (_nextData || getStaticProps || getServerSideProps) {\n          if (renderOpts.isNotFound) {\n            res.statusCode = 404\n\n            if (_nextData) {\n              res.end('{\"notFound\":true}')\n              return null\n            }\n\n            const NotFoundComponent = notFoundMod ? notFoundMod.default : Error\n            const errPathname = notFoundMod ? '/404' : '/_error'\n\n            const result2 = await renderToHTML(\n              req,\n              res,\n              errPathname,\n              parsedUrl.query,\n              Object.assign({}, options, {\n                getStaticProps: notFoundMod\n                  ? notFoundMod.getStaticProps\n                  : undefined,\n                getStaticPaths: undefined,\n                getServerSideProps: undefined,\n                Component: NotFoundComponent,\n                err: undefined,\n                locale: detectedLocale,\n                locales: i18n?.locales,\n                defaultLocale: i18n?.defaultLocale,\n              })\n            )\n            sendRenderResult({\n              req,\n              res,\n              result: result2 ?? RenderResult.empty,\n              type: 'html',\n              generateEtags,\n              poweredByHeader,\n              options: {\n                private: isPreviewMode || page === '/404',\n                stateful: !!getServerSideProps,\n                revalidate: renderOpts.revalidate,\n              },\n            })\n            return null\n          } else if (renderOpts.isRedirect && !_nextData) {\n            const redirect = {\n              destination: renderOpts.pageData.pageProps.__N_REDIRECT,\n              statusCode: renderOpts.pageData.pageProps.__N_REDIRECT_STATUS,\n              basePath: renderOpts.pageData.pageProps.__N_REDIRECT_BASE_PATH,\n            }\n            const statusCode = getRedirectStatus(redirect)\n\n            if (\n              basePath &&\n              redirect.basePath !== false &&\n              redirect.destination.startsWith('/')\n            ) {\n              redirect.destination = `${basePath}${redirect.destination}`\n            }\n\n            if (statusCode === PERMANENT_REDIRECT_STATUS) {\n              res.setHeader('Refresh', `0;url=${redirect.destination}`)\n            }\n\n            res.statusCode = statusCode\n            res.setHeader('Location', redirect.destination)\n            res.end(redirect.destination)\n            return null\n          } else {\n            sendRenderResult({\n              req,\n              res,\n              result: _nextData\n                ? RenderResult.fromStatic(JSON.stringify(renderOpts.pageData))\n                : result ?? RenderResult.empty,\n              type: _nextData ? 'json' : 'html',\n              generateEtags,\n              poweredByHeader,\n              options: {\n                private: isPreviewMode || renderOpts.is404Page,\n                stateful: !!getServerSideProps,\n                revalidate: renderOpts.revalidate,\n              },\n            })\n            return null\n          }\n        }\n      } else if (isPreviewMode) {\n        res.setHeader(\n          'Cache-Control',\n          'private, no-cache, no-store, max-age=0, must-revalidate'\n        )\n      }\n\n      if (renderMode) return { html: result, renderOpts }\n      return result ? result.toUnchunkedString() : null\n    } catch (err) {\n      if (!parsedUrl!) {\n        parsedUrl = parseUrl(req.url!, true)\n      }\n\n      if (isError(err) && err.code === 'ENOENT') {\n        res.statusCode = 404\n      } else if (err instanceof DecodeError) {\n        res.statusCode = 400\n      } else {\n        console.error('Unhandled error during request:', err)\n\n        // Backwards compat (call getInitialProps in custom error):\n        try {\n          await renderToHTML(\n            req,\n            res,\n            '/_error',\n            parsedUrl!.query,\n            Object.assign({}, options, {\n              getStaticProps: undefined,\n              getStaticPaths: undefined,\n              getServerSideProps: undefined,\n              Component: Error,\n              err: err,\n              // Short-circuit rendering:\n              isDataReq: true,\n            })\n          )\n        } catch (underErrorErr) {\n          console.error(\n            'Failed call /_error subroutine, continuing to crash function:',\n            underErrorErr\n          )\n        }\n\n        // Throw the error to crash the serverless function\n        if (isResSent(res)) {\n          console.error('!!! WARNING !!!')\n          console.error(\n            'Your function crashed, but closed the response before allowing the function to exit.\\\\n' +\n              'This may cause unexpected behavior for the next request.'\n          )\n          console.error('!!! WARNING !!!')\n        }\n        throw err\n      }\n\n      const result2 = await renderToHTML(\n        req,\n        res,\n        '/_error',\n        parsedUrl!.query,\n        Object.assign({}, options, {\n          getStaticProps: undefined,\n          getStaticPaths: undefined,\n          getServerSideProps: undefined,\n          Component: Error,\n          err: res.statusCode === 404 ? undefined : err,\n        })\n      )\n      return result2 ? result2.toUnchunkedString() : null\n    }\n  }\n\n  return {\n    renderReqToHTML,\n    render: async function render(req: IncomingMessage, res: ServerResponse) {\n      try {\n        const html = await renderReqToHTML(req, res)\n        if (html) {\n          sendRenderResult({\n            req,\n            res,\n            result: RenderResult.fromStatic(html as any),\n            type: 'html',\n            generateEtags,\n            poweredByHeader,\n          })\n        }\n      } catch (err) {\n        console.error(err)\n        // Throw the error to crash the serverless function\n        throw err\n      }\n    },\n  }\n}\n"],"names":["getPageHandler","ctx","page","pageComponent","pageConfig","pageGetStaticProps","pageGetStaticPaths","pageGetServerSideProps","appModule","documentModule","errorModule","notFoundModule","encodedPreviewProps","pageIsDynamic","generateEtags","poweredByHeader","runtimeConfig","buildManifest","reactLoadableManifest","i18n","buildId","basePath","assetPrefix","canonicalBase","escapedBuildId","handleLocale","handleRewrites","handleBasePath","defaultRouteRegex","dynamicRouteMatcher","interpolateDynamicPath","getParamsFromRouteMatches","normalizeDynamicRouteParams","normalizeVercelUrl","renderReqToHTML","req","res","renderMode","_renderOpts","_params","Component","App","config","Document","Error","notFoundMod","getStaticProps","getStaticPaths","getServerSideProps","default","Promise","all","fromExport","nextStartMode","hasValidParams","headers","options","publicRuntimeConfig","previewProps","env","process","supportsDynamicHTML","_nextData","defaultLocale","detectedLocale","parsedUrl","trustQuery","url","routeNoAssetPath","pathname","replace","RegExp","origQuery","Object","assign","query","amp","queryNoAmp","search","undefined","match","localeResult","nextInternalLocale","renderOpts","nextExport","isDataReq","locales","locale","domainLocales","domains","optimizeImages","__NEXT_OPTIMIZE_IMAGES","optimizeCss","__NEXT_OPTIMIZE_CSS","concurrentFeatures","__NEXT_CONCURRENT_FEATURES","crossOrigin","__NEXT_CROSS_ORIGIN","statusCode","params","result","nowParams","_parsedUrl","param","keys","groups","resolvedUrl","resolvedAsPath","isFallback","__nextFallback","previewData","isPreviewMode","__NEXT_OPTIMIZE_FONTS","optimizeFonts","fontManifest","__webpack_require__","__NEXT_FONT_MANIFEST__","isNotFound","end","NotFoundComponent","errPathname","result2","err","empty","type","private","stateful","revalidate","isRedirect","redirect","destination","pageData","pageProps","__N_REDIRECT","__N_REDIRECT_STATUS","__N_REDIRECT_BASE_PATH","startsWith","setHeader","fromStatic","JSON","stringify","is404Page","html","toUnchunkedString","code","console","error","underErrorErr","render"],"mappings":"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"}