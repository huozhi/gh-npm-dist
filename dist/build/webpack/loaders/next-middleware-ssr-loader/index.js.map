{"version":3,"sources":["../../../../../build/webpack/loaders/next-middleware-ssr-loader/index.ts"],"sourcesContent":["import { stringifyRequest } from '../../stringify-request'\n\nexport default async function middlewareSSRLoader(this: any) {\n  const {\n    dev,\n    page,\n    buildId,\n    absolutePagePath,\n    absoluteAppPath,\n    absoluteDocumentPath,\n    absolute500Path,\n    absoluteErrorPath,\n    isServerComponent,\n    stringifiedConfig,\n  } = this.getOptions()\n\n  const stringifiedPagePath = stringifyRequest(this, absolutePagePath)\n  const stringifiedAppPath = stringifyRequest(this, absoluteAppPath)\n  const stringifiedErrorPath = stringifyRequest(this, absoluteErrorPath)\n  const stringifiedDocumentPath = stringifyRequest(this, absoluteDocumentPath)\n  const stringified500Path = absolute500Path\n    ? stringifyRequest(this, absolute500Path)\n    : 'null'\n\n  const transformed = `\n    import { adapter } from 'next/dist/server/web/adapter'\n    import { RouterContext } from 'next/dist/shared/lib/router-context'\n\n    import { getRender } from 'next/dist/build/webpack/loaders/next-middleware-ssr-loader/render'\n\n    import App from ${stringifiedAppPath}\n    import Document from ${stringifiedDocumentPath}\n\n    const pageMod = require(${stringifiedPagePath})\n    const errorMod = require(${stringifiedErrorPath})\n    const error500Mod = ${stringified500Path} ? require(${stringified500Path}) : null\n\n    const buildManifest = self.__BUILD_MANIFEST\n    const reactLoadableManifest = self.__REACT_LOADABLE_MANIFEST\n    const rscManifest = self.__RSC_MANIFEST\n\n    if (typeof pageMod.default !== 'function') {\n      throw new Error('Your page must export a \\`default\\` component')\n    }\n\n    // Set server context\n    self.__server_context = {\n      page: ${JSON.stringify(page)},\n      buildId: ${JSON.stringify(buildId)},\n    }\n  \n    const render = getRender({\n      dev: ${dev},\n      page: ${JSON.stringify(page)},\n      pageMod,\n      errorMod,\n      error500Mod,\n      App,\n      Document,\n      buildManifest,\n      reactLoadableManifest,\n      serverComponentManifest: ${isServerComponent} ? rscManifest : null,\n      isServerComponent: ${isServerComponent},\n      config: ${stringifiedConfig},\n      buildId: ${JSON.stringify(buildId)},\n    })\n\n    export default function rscMiddleware(opts) {\n      return adapter({\n        ...opts,\n        handler: render\n      })\n    }`\n\n  return transformed\n}\n"],"names":["middlewareSSRLoader","dev","page","buildId","absolutePagePath","absoluteAppPath","absoluteDocumentPath","absolute500Path","absoluteErrorPath","isServerComponent","stringifiedConfig","getOptions","stringifiedPagePath","stringifiedAppPath","stringifiedErrorPath","stringifiedDocumentPath","stringified500Path","transformed","JSON","stringify"],"mappings":";;;;kBAE8BA,mBAAmB;AAFhB,GAAyB,CAAzB,iBAAyB;eAE5BA,mBAAmB,GAAY,CAAC;IAC5D,KAAK,CAAC,CAAC,CACLC,GAAG,GACHC,IAAI,GACJC,OAAO,GACPC,gBAAgB,GAChBC,eAAe,GACfC,oBAAoB,GACpBC,eAAe,GACfC,iBAAiB,GACjBC,iBAAiB,GACjBC,iBAAiB,IACnB,CAAC,GAAG,IAAI,CAACC,UAAU;IAEnB,KAAK,CAACC,mBAAmB,OAhBM,iBAAyB,mBAgBX,IAAI,EAAER,gBAAgB;IACnE,KAAK,CAACS,kBAAkB,OAjBO,iBAAyB,mBAiBZ,IAAI,EAAER,eAAe;IACjE,KAAK,CAACS,oBAAoB,OAlBK,iBAAyB,mBAkBV,IAAI,EAAEN,iBAAiB;IACrE,KAAK,CAACO,uBAAuB,OAnBE,iBAAyB,mBAmBP,IAAI,EAAET,oBAAoB;IAC3E,KAAK,CAACU,kBAAkB,GAAGT,eAAe,OApBX,iBAAyB,mBAqBnC,IAAI,EAAEA,eAAe,IACtC,CAAM;IAEV,KAAK,CAACU,WAAW,IAAI;;;;;;oBAMH,EAAEJ,kBAAkB,CAAC;yBAChB,EAAEE,uBAAuB,CAAC;;4BAEvB,EAAEH,mBAAmB,CAAC;6BACrB,EAAEE,oBAAoB,CAAC;wBAC5B,EAAEE,kBAAkB,CAAC,WAAW,EAAEA,kBAAkB,CAAC;;;;;;;;;;;;YAYjE,EAAEE,IAAI,CAACC,SAAS,CAACjB,IAAI,EAAE;eACpB,EAAEgB,IAAI,CAACC,SAAS,CAAChB,OAAO,EAAE;;;;WAI9B,EAAEF,GAAG,CAAC;YACL,EAAEiB,IAAI,CAACC,SAAS,CAACjB,IAAI,EAAE;;;;;;;;+BAQJ,EAAEO,iBAAiB,CAAC;yBAC1B,EAAEA,iBAAiB,CAAC;cAC/B,EAAEC,iBAAiB,CAAC;eACnB,EAAEQ,IAAI,CAACC,SAAS,CAAChB,OAAO,EAAE;;;;;;;;KAQpC;IAEH,MAAM,CAACc,WAAW;AACpB,CAAC"}