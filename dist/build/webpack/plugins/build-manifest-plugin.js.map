{"version":3,"sources":["../../../../build/webpack/plugins/build-manifest-plugin.ts"],"sourcesContent":["import devalue from 'next/dist/compiled/devalue'\nimport { webpack, sources } from 'next/dist/compiled/webpack/webpack'\nimport {\n  BUILD_MANIFEST,\n  MIDDLEWARE_BUILD_MANIFEST,\n  CLIENT_STATIC_FILES_PATH,\n  CLIENT_STATIC_FILES_RUNTIME_MAIN,\n  CLIENT_STATIC_FILES_RUNTIME_POLYFILLS_SYMBOL,\n  CLIENT_STATIC_FILES_RUNTIME_REACT_REFRESH,\n  CLIENT_STATIC_FILES_RUNTIME_AMP,\n} from '../../../shared/lib/constants'\nimport { BuildManifest } from '../../../server/get-page-files'\nimport getRouteFromEntrypoint from '../../../server/get-route-from-entrypoint'\nimport { ampFirstEntryNamesMap } from './next-drop-client-page-plugin'\nimport { Rewrite } from '../../../lib/load-custom-routes'\nimport { getSortedRoutes } from '../../../shared/lib/router/utils'\nimport { spans } from './profiling-plugin'\nimport { CustomRoutes } from '../../../lib/load-custom-routes'\n\ntype DeepMutable<T> = { -readonly [P in keyof T]: DeepMutable<T[P]> }\n\nexport type ClientBuildManifest = Record<string, string[]>\n\n// This function takes the asset map generated in BuildManifestPlugin and creates a\n// reduced version to send to the client.\nfunction generateClientManifest(\n  compiler: any,\n  compilation: any,\n  assetMap: BuildManifest,\n  rewrites: CustomRoutes['rewrites']\n): string {\n  const compilationSpan = spans.get(compilation) || spans.get(compiler)\n  const genClientManifestSpan = compilationSpan?.traceChild(\n    'NextJsBuildManifest-generateClientManifest'\n  )\n\n  return genClientManifestSpan?.traceFn(() => {\n    const clientManifest: ClientBuildManifest = {\n      // TODO: update manifest type to include rewrites\n      __rewrites: rewrites as any,\n    }\n    const appDependencies = new Set(assetMap.pages['/_app'])\n    const sortedPageKeys = getSortedRoutes(Object.keys(assetMap.pages))\n\n    sortedPageKeys.forEach((page) => {\n      const dependencies = assetMap.pages[page]\n\n      if (page === '/_app') return\n      // Filter out dependencies in the _app entry, because those will have already\n      // been loaded by the client prior to a navigation event\n      const filteredDeps = dependencies.filter(\n        (dep) => !appDependencies.has(dep)\n      )\n\n      // The manifest can omit the page if it has no requirements\n      if (filteredDeps.length) {\n        clientManifest[page] = filteredDeps\n      }\n    })\n    // provide the sorted pages as an array so we don't rely on the object's keys\n    // being in order and we don't slow down look-up time for page assets\n    clientManifest.sortedPages = sortedPageKeys\n\n    return devalue(clientManifest)\n  })\n}\n\nfunction getEntrypointFiles(entrypoint: any): string[] {\n  return (\n    entrypoint\n      ?.getFiles()\n      .filter((file: string) => {\n        // We don't want to include `.hot-update.js` files into the initial page\n        return /(?<!\\.hot-update)\\.(js|css)($|\\?)/.test(file)\n      })\n      .map((file: string) => file.replace(/\\\\/g, '/')) ?? []\n  )\n}\n\nconst processRoute = (r: Rewrite) => {\n  const rewrite = { ...r }\n\n  // omit external rewrite destinations since these aren't\n  // handled client-side\n  if (!rewrite.destination.startsWith('/')) {\n    delete (rewrite as any).destination\n  }\n  return rewrite\n}\n\n// This plugin creates a build-manifest.json for all assets that are being output\n// It has a mapping of \"entry\" filename to real filename. Because the real filename can be hashed in production\nexport default class BuildManifestPlugin {\n  private buildId: string\n  private rewrites: CustomRoutes['rewrites']\n  private isDevFallback: boolean\n  private exportRuntime: boolean\n\n  constructor(options: {\n    buildId: string\n    rewrites: CustomRoutes['rewrites']\n    isDevFallback?: boolean\n    exportRuntime?: boolean\n  }) {\n    this.buildId = options.buildId\n    this.isDevFallback = !!options.isDevFallback\n    this.rewrites = {\n      beforeFiles: [],\n      afterFiles: [],\n      fallback: [],\n    }\n    this.rewrites.beforeFiles = options.rewrites.beforeFiles.map(processRoute)\n    this.rewrites.afterFiles = options.rewrites.afterFiles.map(processRoute)\n    this.rewrites.fallback = options.rewrites.fallback.map(processRoute)\n    this.exportRuntime = !!options.exportRuntime\n  }\n\n  createAssets(compiler: any, compilation: any, assets: any) {\n    const compilationSpan = spans.get(compilation) || spans.get(compiler)\n    const createAssetsSpan = compilationSpan?.traceChild(\n      'NextJsBuildManifest-createassets'\n    )\n    return createAssetsSpan?.traceFn(() => {\n      const entrypoints: Map<string, any> = compilation.entrypoints\n      const assetMap: DeepMutable<BuildManifest> = {\n        polyfillFiles: [],\n        devFiles: [],\n        ampDevFiles: [],\n        lowPriorityFiles: [],\n        pages: { '/_app': [] },\n        ampFirstPages: [],\n      }\n\n      const ampFirstEntryNames = ampFirstEntryNamesMap.get(compilation)\n      if (ampFirstEntryNames) {\n        for (const entryName of ampFirstEntryNames) {\n          const pagePath = getRouteFromEntrypoint(entryName)\n          if (!pagePath) {\n            continue\n          }\n\n          assetMap.ampFirstPages.push(pagePath)\n        }\n      }\n\n      const mainFiles = new Set(\n        getEntrypointFiles(entrypoints.get(CLIENT_STATIC_FILES_RUNTIME_MAIN))\n      )\n\n      const compilationAssets: {\n        name: string\n        source: typeof sources.RawSource\n        info: object\n      }[] = compilation.getAssets()\n\n      assetMap.polyfillFiles = compilationAssets\n        .filter((p) => {\n          // Ensure only .js files are passed through\n          if (!p.name.endsWith('.js')) {\n            return false\n          }\n\n          return (\n            p.info && CLIENT_STATIC_FILES_RUNTIME_POLYFILLS_SYMBOL in p.info\n          )\n        })\n        .map((v) => v.name)\n\n      assetMap.devFiles = getEntrypointFiles(\n        entrypoints.get(CLIENT_STATIC_FILES_RUNTIME_REACT_REFRESH)\n      ).filter((file) => !mainFiles.has(file))\n\n      assetMap.ampDevFiles = getEntrypointFiles(\n        entrypoints.get(CLIENT_STATIC_FILES_RUNTIME_AMP)\n      )\n\n      const systemEntrypoints = new Set([\n        CLIENT_STATIC_FILES_RUNTIME_MAIN,\n        CLIENT_STATIC_FILES_RUNTIME_REACT_REFRESH,\n        CLIENT_STATIC_FILES_RUNTIME_AMP,\n      ])\n\n      for (const entrypoint of compilation.entrypoints.values()) {\n        if (systemEntrypoints.has(entrypoint.name)) continue\n        const pagePath = getRouteFromEntrypoint(entrypoint.name)\n\n        if (!pagePath) {\n          continue\n        }\n\n        const filesForPage = getEntrypointFiles(entrypoint)\n\n        assetMap.pages[pagePath] = [...new Set([...mainFiles, ...filesForPage])]\n      }\n\n      if (!this.isDevFallback) {\n        // Add the runtime build manifest file (generated later in this file)\n        // as a dependency for the app. If the flag is false, the file won't be\n        // downloaded by the client.\n        assetMap.lowPriorityFiles.push(\n          `${CLIENT_STATIC_FILES_PATH}/${this.buildId}/_buildManifest.js`\n        )\n        // Add the runtime ssg manifest file as a lazy-loaded file dependency.\n        // We also stub this file out for development mode (when it is not\n        // generated).\n        const srcEmptySsgManifest = `self.__SSG_MANIFEST=new Set;self.__SSG_MANIFEST_CB&&self.__SSG_MANIFEST_CB()`\n\n        const ssgManifestPath = `${CLIENT_STATIC_FILES_PATH}/${this.buildId}/_ssgManifest.js`\n        assetMap.lowPriorityFiles.push(ssgManifestPath)\n        assets[ssgManifestPath] = new sources.RawSource(srcEmptySsgManifest)\n\n        const srcEmptyMiddlewareManifest = `self.__MIDDLEWARE_MANIFEST=[];self.__MIDDLEWARE_MANIFEST_CB&&self.__MIDDLEWARE_MANIFEST_CB()`\n        const middlewareManifestPath = `${CLIENT_STATIC_FILES_PATH}/${this.buildId}/_middlewareManifest.js`\n        assetMap.lowPriorityFiles.push(middlewareManifestPath)\n        assets[middlewareManifestPath] = new sources.RawSource(\n          srcEmptyMiddlewareManifest\n        )\n      }\n\n      assetMap.pages = Object.keys(assetMap.pages)\n        .sort()\n        // eslint-disable-next-line\n        .reduce((a, c) => ((a[c] = assetMap.pages[c]), a), {} as any)\n\n      let buildManifestName = BUILD_MANIFEST\n\n      if (this.isDevFallback) {\n        buildManifestName = `fallback-${BUILD_MANIFEST}`\n      }\n\n      assets[buildManifestName] = new sources.RawSource(\n        JSON.stringify(assetMap, null, 2)\n      )\n\n      if (this.exportRuntime) {\n        assets[`server/${MIDDLEWARE_BUILD_MANIFEST}.js`] =\n          new sources.RawSource(\n            `self.__BUILD_MANIFEST=${JSON.stringify(assetMap)}`\n          )\n      }\n\n      if (!this.isDevFallback) {\n        const clientManifestPath = `${CLIENT_STATIC_FILES_PATH}/${this.buildId}/_buildManifest.js`\n\n        assets[clientManifestPath] = new sources.RawSource(\n          `self.__BUILD_MANIFEST = ${generateClientManifest(\n            compiler,\n            compilation,\n            assetMap,\n            this.rewrites\n          )};self.__BUILD_MANIFEST_CB && self.__BUILD_MANIFEST_CB()`\n        )\n      }\n\n      return assets\n    })\n  }\n\n  apply(compiler: webpack.Compiler) {\n    compiler.hooks.make.tap('NextJsBuildManifest', (compilation) => {\n      // @ts-ignore TODO: Remove ignore when webpack 5 is stable\n      compilation.hooks.processAssets.tap(\n        {\n          name: 'NextJsBuildManifest',\n          // @ts-ignore TODO: Remove ignore when webpack 5 is stable\n          stage: webpack.Compilation.PROCESS_ASSETS_STAGE_ADDITIONS,\n        },\n        (assets: any) => {\n          this.createAssets(compiler, compilation, assets)\n        }\n      )\n    })\n    return\n  }\n}\n"],"names":["generateClientManifest","compiler","compilation","assetMap","rewrites","compilationSpan","get","genClientManifestSpan","traceChild","traceFn","clientManifest","__rewrites","appDependencies","Set","pages","sortedPageKeys","Object","keys","forEach","page","dependencies","filteredDeps","filter","dep","has","length","sortedPages","getEntrypointFiles","entrypoint","getFiles","file","test","map","replace","processRoute","r","rewrite","destination","startsWith","BuildManifestPlugin","options","buildId","isDevFallback","beforeFiles","afterFiles","fallback","exportRuntime","createAssets","assets","createAssetsSpan","entrypoints","polyfillFiles","devFiles","ampDevFiles","lowPriorityFiles","ampFirstPages","ampFirstEntryNames","entryName","pagePath","push","mainFiles","compilationAssets","getAssets","p","name","endsWith","info","v","systemEntrypoints","values","filesForPage","srcEmptySsgManifest","ssgManifestPath","RawSource","srcEmptyMiddlewareManifest","middlewareManifestPath","sort","reduce","a","c","buildManifestName","JSON","stringify","clientManifestPath","apply","hooks","make","tap","processAssets","stage","Compilation","PROCESS_ASSETS_STAGE_ADDITIONS"],"mappings":"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"}