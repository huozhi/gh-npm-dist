{"version":3,"sources":["../../../../build/webpack/plugins/nextjs-ssr-import.ts"],"sourcesContent":["import { join, resolve, relative, dirname } from 'path'\nimport { webpack } from 'next/dist/compiled/webpack/webpack'\n\n// This plugin modifies the require-ensure code generated by Webpack\n// to work with Next.js SSR\nexport default class NextJsSsrImportPlugin {\n  apply(compiler: webpack.Compiler) {\n    compiler.hooks.compilation.tap('NextJsSSRImport', (compilation: any) => {\n      compilation.mainTemplate.hooks.requireEnsure.tap(\n        'NextJsSSRImport',\n        (code: string, chunk: any) => {\n          // Update to load chunks from our custom chunks directory\n          const outputPath = resolve('/')\n          const pagePath = join('/', dirname(chunk.name))\n          const relativePathToBaseDir = relative(pagePath, outputPath)\n          // Make sure even in windows, the path looks like in unix\n          // Node.js require system will convert it accordingly\n          const relativePathToBaseDirNormalized = relativePathToBaseDir.replace(\n            /\\\\/g,\n            '/'\n          )\n          return code\n            .replace(\n              'require(\"./\"',\n              `require(\"${relativePathToBaseDirNormalized}/\"`\n            )\n            .replace(\n              'readFile(join(__dirname',\n              `readFile(join(__dirname, \"${relativePathToBaseDirNormalized}\"`\n            )\n        }\n      )\n    })\n  }\n}\n"],"names":["NextJsSsrImportPlugin","apply","compiler","hooks","compilation","tap","mainTemplate","requireEnsure","code","chunk","outputPath","pagePath","name","relativePathToBaseDir","relativePathToBaseDirNormalized","replace"],"mappings":";;;;;AAAiD,GAAM,CAAN,KAAM;MAKlCA,qBAAqB;IACxCC,KAAK,CAACC,QAA0B,EAAE,CAAC;QACjCA,QAAQ,CAACC,KAAK,CAACC,WAAW,CAACC,GAAG,CAAC,CAAiB,mBAAGD,WAAgB,GAAK,CAAC;YACvEA,WAAW,CAACE,YAAY,CAACH,KAAK,CAACI,aAAa,CAACF,GAAG,CAC9C,CAAiB,mBAChBG,IAAY,EAAEC,KAAU,GAAK,CAAC;gBAC7B,EAAyD,AAAzD,uDAAyD;gBACzD,KAAK,CAACC,UAAU,OAZuB,KAAM,UAYlB,CAAG;gBAC9B,KAAK,CAACC,QAAQ,OAbyB,KAAM,OAavB,CAAG,QAbc,KAAM,UAaVF,KAAK,CAACG,IAAI;gBAC7C,KAAK,CAACC,qBAAqB,OAdY,KAAM,WAcNF,QAAQ,EAAED,UAAU;gBAC3D,EAAyD,AAAzD,uDAAyD;gBACzD,EAAqD,AAArD,mDAAqD;gBACrD,KAAK,CAACI,+BAA+B,GAAGD,qBAAqB,CAACE,OAAO,QAEnE,CAAG;gBAEL,MAAM,CAACP,IAAI,CACRO,OAAO,CACN,CAAc,gBACb,SAAS,EAAED,+BAA+B,CAAC,EAAE,GAE/CC,OAAO,CACN,CAAyB,2BACxB,0BAA0B,EAAED,+BAA+B,CAAC,CAAC;YAEpE,CAAC;QAEL,CAAC;IACH,CAAC;;kBA5BkBd,qBAAqB"}