{"version":3,"sources":["../../../../build/webpack/plugins/font-stylesheet-gathering-plugin.ts"],"sourcesContent":["import {\n  webpack,\n  BasicEvaluatedExpression,\n  sources,\n} from 'next/dist/compiled/webpack/webpack'\nimport {\n  getFontDefinitionFromNetwork,\n  FontManifest,\n} from '../../../server/font-utils'\nimport postcss from 'postcss'\nimport minifier from 'next/dist/compiled/cssnano-simple'\nimport {\n  FONT_MANIFEST,\n  OPTIMIZED_FONT_PROVIDERS,\n} from '../../../shared/lib/constants'\nimport * as Log from '../../output/log'\n\nfunction minifyCss(css: string): Promise<string> {\n  return postcss([\n    minifier(\n      {\n        excludeAll: true,\n        discardComments: true,\n        normalizeWhitespace: { exclude: false },\n      },\n      postcss\n    ),\n  ])\n    .process(css, { from: undefined })\n    .then((res) => res.css)\n}\n\nexport class FontStylesheetGatheringPlugin {\n  compiler?: webpack.Compiler\n  gatheredStylesheets: Array<string> = []\n  manifestContent: FontManifest = []\n  isLikeServerless: boolean\n\n  constructor({ isLikeServerless }: { isLikeServerless: boolean }) {\n    this.isLikeServerless = isLikeServerless\n  }\n\n  private parserHandler = (\n    factory: webpack.compilation.NormalModuleFactory\n  ): void => {\n    const JS_TYPES = ['auto', 'esm', 'dynamic']\n    // Do an extra walk per module and add interested visitors to the walk.\n    for (const type of JS_TYPES) {\n      factory.hooks.parser\n        .for('javascript/' + type)\n        .tap(this.constructor.name, (parser: any) => {\n          /**\n           * Webpack fun facts:\n           * `parser.hooks.call.for` cannot catch calls for user defined identifiers like `__jsx`\n           * it can only detect calls for native objects like `window`, `this`, `eval` etc.\n           * In order to be able to catch calls of variables like `__jsx`, first we need to catch them as\n           * Identifier and then return `BasicEvaluatedExpression` whose `id` and `type` webpack matches to\n           * invoke hook for call.\n           * See: https://github.com/webpack/webpack/blob/webpack-4/lib/Parser.js#L1931-L1932.\n           */\n          parser.hooks.evaluate\n            .for('Identifier')\n            .tap(this.constructor.name, (node: any) => {\n              // We will only optimize fonts from first party code.\n              if (parser?.state?.module?.resource.includes('node_modules')) {\n                return\n              }\n              let result\n              if (node.name === '_jsx' || node.name === '__jsx') {\n                result = new BasicEvaluatedExpression()\n                // @ts-ignore\n                result.setRange(node.range)\n                result.setExpression(node)\n                result.setIdentifier(node.name)\n\n                // This was added in webpack 5.\n                result.getMembers = () => []\n              }\n              return result\n            })\n\n          const jsxNodeHandler = (node: any) => {\n            if (node.arguments.length !== 2) {\n              // A font link tag has only two arguments rel=stylesheet and href='...'\n              return\n            }\n            if (!isNodeCreatingLinkElement(node)) {\n              return\n            }\n\n            // node.arguments[0] is the name of the tag and [1] are the props.\n            const arg1 = node.arguments[1]\n\n            const propsNode =\n              arg1.type === 'ObjectExpression' ? (arg1 as any) : undefined\n            const props: { [key: string]: string } = {}\n            if (propsNode) {\n              propsNode.properties.forEach((prop: any) => {\n                if (prop.type !== 'Property') {\n                  return\n                }\n                if (\n                  prop.key.type === 'Identifier' &&\n                  prop.value.type === 'Literal'\n                ) {\n                  props[prop.key.name] = prop.value.value as string\n                }\n              })\n            }\n\n            if (\n              !props.rel ||\n              props.rel !== 'stylesheet' ||\n              !props.href ||\n              !OPTIMIZED_FONT_PROVIDERS.some(({ url }) =>\n                props.href.startsWith(url)\n              )\n            ) {\n              return false\n            }\n\n            this.gatheredStylesheets.push(props.href)\n\n            const buildInfo = parser?.state?.module?.buildInfo\n\n            if (buildInfo) {\n              buildInfo.valueDependencies.set(\n                FONT_MANIFEST,\n                this.gatheredStylesheets\n              )\n            }\n          }\n\n          // React JSX transform:\n          parser.hooks.call\n            .for('_jsx')\n            .tap(this.constructor.name, jsxNodeHandler)\n          // Next.js JSX transform:\n          parser.hooks.call\n            .for('__jsx')\n            .tap(this.constructor.name, jsxNodeHandler)\n          // New React JSX transform:\n          parser.hooks.call\n            .for('imported var')\n            .tap(this.constructor.name, jsxNodeHandler)\n        })\n    }\n  }\n\n  public apply(compiler: webpack.Compiler) {\n    this.compiler = compiler\n    compiler.hooks.normalModuleFactory.tap(\n      this.constructor.name,\n      this.parserHandler\n    )\n    compiler.hooks.make.tapAsync(this.constructor.name, (compilation, cb) => {\n      if (this.isLikeServerless) {\n        /**\n         * Inline font manifest for serverless case only.\n         * For target: server drive the manifest through physical file and less of webpack magic.\n         */\n        const mainTemplate = compilation.mainTemplate\n        mainTemplate.hooks.requireExtensions.tap(\n          this.constructor.name,\n          (source: string) => {\n            return `${source}\n                // Font manifest declaration\n                __webpack_require__.__NEXT_FONT_MANIFEST__ = ${JSON.stringify(\n                  this.manifestContent\n                )};\n            // Enable feature:\n            process.env.__NEXT_OPTIMIZE_FONTS = JSON.stringify(true);`\n          }\n        )\n      }\n      compilation.hooks.finishModules.tapAsync(\n        this.constructor.name,\n        async (modules: any, modulesFinished: Function) => {\n          let fontStylesheets = this.gatheredStylesheets\n\n          const fontUrls = new Set<string>()\n          modules.forEach((module: any) => {\n            const fontDependencies =\n              module?.buildInfo?.valueDependencies?.get(FONT_MANIFEST)\n            if (fontDependencies) {\n              fontDependencies.forEach((v: string) => fontUrls.add(v))\n            }\n          })\n\n          fontStylesheets = Array.from(fontUrls)\n\n          const fontDefinitionPromises = fontStylesheets.map((url) =>\n            getFontDefinitionFromNetwork(url)\n          )\n\n          this.manifestContent = []\n          for (let promiseIndex in fontDefinitionPromises) {\n            const css = await fontDefinitionPromises[promiseIndex]\n\n            if (css) {\n              try {\n                const content = await minifyCss(css)\n                this.manifestContent.push({\n                  url: fontStylesheets[promiseIndex],\n                  content,\n                })\n              } catch (err) {\n                Log.warn(\n                  `Failed to minify the stylesheet for ${fontStylesheets[promiseIndex]}. Skipped optimizing this font.`\n                )\n                console.error(err)\n              }\n            }\n          }\n\n          compilation.assets[FONT_MANIFEST] = new sources.RawSource(\n            JSON.stringify(this.manifestContent, null, '  ')\n          )\n\n          modulesFinished()\n        }\n      )\n      cb()\n    })\n\n    compiler.hooks.make.tap(this.constructor.name, (compilation) => {\n      // @ts-ignore TODO: Remove ignore when webpack 5 is stable\n      compilation.hooks.processAssets.tap(\n        {\n          name: this.constructor.name,\n          // @ts-ignore TODO: Remove ignore when webpack 5 is stable\n          stage: webpack.Compilation.PROCESS_ASSETS_STAGE_ADDITIONS,\n        },\n        (assets: any) => {\n          assets['../' + FONT_MANIFEST] = new sources.RawSource(\n            JSON.stringify(this.manifestContent, null, '  ')\n          )\n        }\n      )\n    })\n  }\n}\n\nfunction isNodeCreatingLinkElement(node: any) {\n  const callee = node.callee as any\n  if (callee.type !== 'Identifier') {\n    return false\n  }\n  const componentNode = node.arguments[0] as any\n  if (componentNode.type !== 'Literal') {\n    return false\n  }\n  // React has pragma: _jsx.\n  // Next has pragma: __jsx.\n  return (\n    (callee.name === '_jsx' || callee.name === '__jsx') &&\n    componentNode.value === 'link'\n  )\n}\n"],"names":["Log","minifyCss","css","excludeAll","discardComments","normalizeWhitespace","exclude","process","from","undefined","then","res","FontStylesheetGatheringPlugin","isLikeServerless","gatheredStylesheets","manifestContent","parserHandler","factory","JS_TYPES","type","hooks","parser","for","tap","constructor","name","evaluate","node","state","module","resource","includes","result","setRange","range","setExpression","setIdentifier","getMembers","jsxNodeHandler","arguments","length","isNodeCreatingLinkElement","arg1","propsNode","props","properties","forEach","prop","key","value","rel","href","some","url","startsWith","push","buildInfo","valueDependencies","set","call","apply","compiler","normalModuleFactory","make","tapAsync","compilation","cb","mainTemplate","requireExtensions","source","JSON","stringify","finishModules","modules","modulesFinished","fontStylesheets","fontUrls","Set","fontDependencies","get","v","add","Array","fontDefinitionPromises","map","promiseIndex","content","err","warn","console","error","assets","RawSource","processAssets","stage","Compilation","PROCESS_ASSETS_STAGE_ADDITIONS","callee","componentNode"],"mappings":";;;;AAIO,GAAoC,CAApC,QAAoC;AAIpC,GAA4B,CAA5B,UAA4B;AACf,GAAS,CAAT,QAAS;AACR,GAAmC,CAAnC,cAAmC;AAIjD,GAA+B,CAA/B,UAA+B;AAC1BA,GAAG,CAAHA,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;SAENC,SAAS,CAACC,GAAW,EAAmB,CAAC;IAChD,MAAM,KATY,QAAS,UASZ,CAAC;YARG,cAAmC,UAUlD,CAAC;YACCC,UAAU,EAAE,IAAI;YAChBC,eAAe,EAAE,IAAI;YACrBC,mBAAmB,EAAE,CAAC;gBAACC,OAAO,EAAE,KAAK;YAAC,CAAC;QACzC,CAAC,EAfa,QAAS;IAkB3B,CAAC,EACEC,OAAO,CAACL,GAAG,EAAE,CAAC;QAACM,IAAI,EAAEC,SAAS;IAAC,CAAC,EAChCC,IAAI,EAAEC,GAAG,GAAKA,GAAG,CAACT,GAAG;;AAC1B,CAAC;MAEYU,6BAA6B;gBAM5B,CAAC,CAACC,gBAAgB,EAAgC,CAAC,CAAE,CAAC;QAN7D,IAiNN,CA/MCC,mBAAmB,GAAkB,CAAC,CAAC;QAFlC,IAiNN,CA9MCC,eAAe,GAAiB,CAAC,CAAC;QAH7B,IAiNN,CAvMSC,aAAa,IACnBC,OAAgD,GACvC,CAAC;YACV,KAAK,CAACC,QAAQ,GAAG,CAAC;gBAAA,CAAM;gBAAE,CAAK;gBAAE,CAAS;YAAA,CAAC;YAC3C,EAAuE,AAAvE,qEAAuE;YACvE,GAAG,EAAE,KAAK,CAACC,IAAI,IAAID,QAAQ,CAAE,CAAC;gBAC5BD,OAAO,CAACG,KAAK,CAACC,MAAM,CACjBC,GAAG,CAAC,CAAa,eAAGH,IAAI,EACxBI,GAAG,CAAC,IAAI,CAACC,WAAW,CAACC,IAAI,GAAGJ,MAAW,GAAK,CAAC;oBAC5C,EAQG,AARH;;;;;;;;WAQG,AARH,EAQG,CACHA,MAAM,CAACD,KAAK,CAACM,QAAQ,CAClBJ,GAAG,CAAC,CAAY,aAChBC,GAAG,CAAC,IAAI,CAACC,WAAW,CAACC,IAAI,GAAGE,IAAS,GAAK,CAAC;4BAEtCN,GAAa;wBADjB,EAAqD,AAArD,mDAAqD;wBACrD,EAAE,EAAEA,MAAM,aAANA,MAAM,KAANA,IAAI,CAAJA,CAAa,GAAbA,IAAI,CAAJA,CAAa,IAAbA,GAAa,GAAbA,MAAM,CAAEO,KAAK,cAAbP,GAAa,KAAbA,IAAI,CAAJA,CAAa,GAAbA,IAAI,CAAJA,CAAa,WAAbA,GAAa,CAAEQ,MAAM,uBAArBR,IAAI,CAAJA,CAAa,GAAbA,IAAI,CAAJA,CAAa,QAAUS,QAAQ,CAACC,QAAQ,CAAC,CAAc,gBAAG,CAAC;4BAC7D,MAAM;wBACR,CAAC;wBACD,GAAG,CAACC,MAAM;wBACV,EAAE,EAAEL,IAAI,CAACF,IAAI,KAAK,CAAM,SAAIE,IAAI,CAACF,IAAI,KAAK,CAAO,QAAE,CAAC;4BAClDO,MAAM,GAAG,GAAG,CAjErB,QAAoC;4BAkE3B,EAAa,AAAb,WAAa;4BACbA,MAAM,CAACC,QAAQ,CAACN,IAAI,CAACO,KAAK;4BAC1BF,MAAM,CAACG,aAAa,CAACR,IAAI;4BACzBK,MAAM,CAACI,aAAa,CAACT,IAAI,CAACF,IAAI;4BAE9B,EAA+B,AAA/B,6BAA+B;4BAC/BO,MAAM,CAACK,UAAU,OAAS,CAAC,CAAC;;wBAC9B,CAAC;wBACD,MAAM,CAACL,MAAM;oBACf,CAAC;oBAEH,KAAK,CAACM,cAAc,IAAIX,IAAS,GAAK,CAAC;4BA0CnBN,GAAa;wBAzC/B,EAAE,EAAEM,IAAI,CAACY,SAAS,CAACC,MAAM,KAAK,CAAC,EAAE,CAAC;4BAChC,EAAuE,AAAvE,qEAAuE;4BACvE,MAAM;wBACR,CAAC;wBACD,EAAE,GAAGC,yBAAyB,CAACd,IAAI,GAAG,CAAC;4BACrC,MAAM;wBACR,CAAC;wBAED,EAAkE,AAAlE,gEAAkE;wBAClE,KAAK,CAACe,IAAI,GAAGf,IAAI,CAACY,SAAS,CAAC,CAAC;wBAE7B,KAAK,CAACI,SAAS,GACbD,IAAI,CAACvB,IAAI,KAAK,CAAkB,oBAAIuB,IAAI,GAAWjC,SAAS;wBAC9D,KAAK,CAACmC,KAAK,GAA8B,CAAC,CAAC;wBAC3C,EAAE,EAAED,SAAS,EAAE,CAAC;4BACdA,SAAS,CAACE,UAAU,CAACC,OAAO,EAAEC,IAAS,GAAK,CAAC;gCAC3C,EAAE,EAAEA,IAAI,CAAC5B,IAAI,KAAK,CAAU,WAAE,CAAC;oCAC7B,MAAM;gCACR,CAAC;gCACD,EAAE,EACA4B,IAAI,CAACC,GAAG,CAAC7B,IAAI,KAAK,CAAY,eAC9B4B,IAAI,CAACE,KAAK,CAAC9B,IAAI,KAAK,CAAS,UAC7B,CAAC;oCACDyB,KAAK,CAACG,IAAI,CAACC,GAAG,CAACvB,IAAI,IAAIsB,IAAI,CAACE,KAAK,CAACA,KAAK;gCACzC,CAAC;4BACH,CAAC;wBACH,CAAC;wBAED,EAAE,GACCL,KAAK,CAACM,GAAG,IACVN,KAAK,CAACM,GAAG,KAAK,CAAY,gBACzBN,KAAK,CAACO,IAAI,KAnGlB,UAA+B,0BAoGEC,IAAI,EAAE,CAAC,CAACC,GAAG,EAAC,CAAC,GACrCT,KAAK,CAACO,IAAI,CAACG,UAAU,CAACD,GAAG;2BAE3B,CAAC;4BACD,MAAM,CAAC,KAAK;wBACd,CAAC;wBAED,IAAI,CAACvC,mBAAmB,CAACyC,IAAI,CAACX,KAAK,CAACO,IAAI;wBAExC,KAAK,CAACK,SAAS,GAAGnC,MAAM,aAANA,MAAM,KAANA,IAAI,CAAJA,CAAa,GAAbA,IAAI,CAAJA,CAAa,IAAbA,GAAa,GAAbA,MAAM,CAAEO,KAAK,cAAbP,GAAa,KAAbA,IAAI,CAAJA,CAAa,GAAbA,IAAI,CAAJA,CAAa,WAAbA,GAAa,CAAEQ,MAAM,uBAArBR,IAAI,CAAJA,CAAa,GAAbA,IAAI,CAAJA,CAAa,QAAUmC,SAAS;wBAElD,EAAE,EAAEA,SAAS,EAAE,CAAC;4BACdA,SAAS,CAACC,iBAAiB,CAACC,GAAG,CAhHtC,UAA+B,gBAkHtB,IAAI,CAAC5C,mBAAmB;wBAE5B,CAAC;oBACH,CAAC;oBAED,EAAuB,AAAvB,qBAAuB;oBACvBO,MAAM,CAACD,KAAK,CAACuC,IAAI,CACdrC,GAAG,CAAC,CAAM,OACVC,GAAG,CAAC,IAAI,CAACC,WAAW,CAACC,IAAI,EAAEa,cAAc;oBAC5C,EAAyB,AAAzB,uBAAyB;oBACzBjB,MAAM,CAACD,KAAK,CAACuC,IAAI,CACdrC,GAAG,CAAC,CAAO,QACXC,GAAG,CAAC,IAAI,CAACC,WAAW,CAACC,IAAI,EAAEa,cAAc;oBAC5C,EAA2B,AAA3B,yBAA2B;oBAC3BjB,MAAM,CAACD,KAAK,CAACuC,IAAI,CACdrC,GAAG,CAAC,CAAc,eAClBC,GAAG,CAAC,IAAI,CAACC,WAAW,CAACC,IAAI,EAAEa,cAAc;gBAC9C,CAAC;YACL,CAAC;QACH,CAAC;QA5GC,IAAI,CAACzB,gBAAgB,GAAGA,gBAAgB;IAC1C,CAAC;IA6GM+C,KAAK,CAACC,QAA0B,EAAE,CAAC;QACxC,IAAI,CAACA,QAAQ,GAAGA,QAAQ;QACxBA,QAAQ,CAACzC,KAAK,CAAC0C,mBAAmB,CAACvC,GAAG,CACpC,IAAI,CAACC,WAAW,CAACC,IAAI,EACrB,IAAI,CAACT,aAAa;QAEpB6C,QAAQ,CAACzC,KAAK,CAAC2C,IAAI,CAACC,QAAQ,CAAC,IAAI,CAACxC,WAAW,CAACC,IAAI,GAAGwC,WAAW,EAAEC,EAAE,GAAK,CAAC;YACxE,EAAE,EAAE,IAAI,CAACrD,gBAAgB,EAAE,CAAC;gBAC1B,EAGG,AAHH;;;SAGG,AAHH,EAGG,CACH,KAAK,CAACsD,YAAY,GAAGF,WAAW,CAACE,YAAY;gBAC7CA,YAAY,CAAC/C,KAAK,CAACgD,iBAAiB,CAAC7C,GAAG,CACtC,IAAI,CAACC,WAAW,CAACC,IAAI,GACpB4C,MAAc,GAAK,CAAC;oBACnB,MAAM,IAAIA,MAAM,CAAC;;6DAEgC,EAAEC,IAAI,CAACC,SAAS,CAC3D,IAAI,CAACxD,eAAe,EACpB;;qEAEmD;gBAC3D,CAAC;YAEL,CAAC;YACDkD,WAAW,CAAC7C,KAAK,CAACoD,aAAa,CAACR,QAAQ,CACtC,IAAI,CAACxC,WAAW,CAACC,IAAI,SACdgD,OAAY,EAAEC,eAAyB,GAAK,CAAC;gBAClD,GAAG,CAACC,eAAe,GAAG,IAAI,CAAC7D,mBAAmB;gBAE9C,KAAK,CAAC8D,QAAQ,GAAG,GAAG,CAACC,GAAG;gBACxBJ,OAAO,CAAC3B,OAAO,EAAEjB,MAAW,GAAK,CAAC;wBAE9BA,GAAiB;oBADnB,KAAK,CAACiD,gBAAgB,GACpBjD,MAAM,aAANA,MAAM,KAANA,IAAI,CAAJA,CAAiB,GAAjBA,IAAI,CAAJA,CAAiB,IAAjBA,GAAiB,GAAjBA,MAAM,CAAE2B,SAAS,cAAjB3B,GAAiB,KAAjBA,IAAI,CAAJA,CAAiB,GAAjBA,IAAI,CAAJA,CAAiB,WAAjBA,GAAiB,CAAE4B,iBAAiB,uBAApC5B,IAAI,CAAJA,CAAiB,GAAjBA,IAAI,CAAJA,CAAiB,QAAqBkD,GAAG,CAzKhD,UAA+B;oBA0K1B,EAAE,EAAED,gBAAgB,EAAE,CAAC;wBACrBA,gBAAgB,CAAChC,OAAO,EAAEkC,CAAS,GAAKJ,QAAQ,CAACK,GAAG,CAACD,CAAC;;oBACxD,CAAC;gBACH,CAAC;gBAEDL,eAAe,GAAGO,KAAK,CAAC1E,IAAI,CAACoE,QAAQ;gBAErC,KAAK,CAACO,sBAAsB,GAAGR,eAAe,CAACS,GAAG,EAAE/B,GAAG,OAvL1D,UAA4B,+BAwLMA,GAAG;;gBAGlC,IAAI,CAACtC,eAAe,GAAG,CAAC,CAAC;gBACzB,GAAG,CAAE,GAAG,CAACsE,YAAY,IAAIF,sBAAsB,CAAE,CAAC;oBAChD,KAAK,CAACjF,GAAG,GAAG,KAAK,CAACiF,sBAAsB,CAACE,YAAY;oBAErD,EAAE,EAAEnF,GAAG,EAAE,CAAC;wBACR,GAAG,CAAC,CAAC;4BACH,KAAK,CAACoF,OAAO,GAAG,KAAK,CAACrF,SAAS,CAACC,GAAG;4BACnC,IAAI,CAACa,eAAe,CAACwC,IAAI,CAAC,CAAC;gCACzBF,GAAG,EAAEsB,eAAe,CAACU,YAAY;gCACjCC,OAAO;4BACT,CAAC;wBACH,CAAC,CAAC,KAAK,EAAEC,GAAG,EAAE,CAAC;4BA/LjBvF,GAAG,CAgMKwF,IAAI,EACL,oCAAoC,EAAEb,eAAe,CAACU,YAAY,EAAE,+BAA+B;4BAEtGI,OAAO,CAACC,KAAK,CAACH,GAAG;wBACnB,CAAC;oBACH,CAAC;gBACH,CAAC;gBAEDtB,WAAW,CAAC0B,MAAM,CAzMrB,UAA+B,kBAyMQ,GAAG,CAnN1C,QAAoC,SAmNeC,SAAS,CACvDtB,IAAI,CAACC,SAAS,CAAC,IAAI,CAACxD,eAAe,EAAE,IAAI,EAAE,CAAI;gBAGjD2D,eAAe;YACjB,CAAC;YAEHR,EAAE;QACJ,CAAC;QAEDL,QAAQ,CAACzC,KAAK,CAAC2C,IAAI,CAACxC,GAAG,CAAC,IAAI,CAACC,WAAW,CAACC,IAAI,GAAGwC,WAAW,GAAK,CAAC;YAC/D,EAA0D,AAA1D,wDAA0D;YAC1DA,WAAW,CAAC7C,KAAK,CAACyE,aAAa,CAACtE,GAAG,CACjC,CAAC;gBACCE,IAAI,EAAE,IAAI,CAACD,WAAW,CAACC,IAAI;gBAC3B,EAA0D,AAA1D,wDAA0D;gBAC1DqE,KAAK,EAnOR,QAAoC,SAmOlBC,WAAW,CAACC,8BAA8B;YAC3D,CAAC,GACAL,MAAW,GAAK,CAAC;gBAChBA,MAAM,CAAC,CAAK,OA5Nf,UAA+B,kBA4NI,GAAG,CAtOtC,QAAoC,SAsOWC,SAAS,CACnDtB,IAAI,CAACC,SAAS,CAAC,IAAI,CAACxD,eAAe,EAAE,IAAI,EAAE,CAAI;YAEnD,CAAC;QAEL,CAAC;IACH,CAAC;;QAhNUH,6BAA6B,GAA7BA,6BAA6B;SAmNjC6B,yBAAyB,CAACd,IAAS,EAAE,CAAC;IAC7C,KAAK,CAACsE,MAAM,GAAGtE,IAAI,CAACsE,MAAM;IAC1B,EAAE,EAAEA,MAAM,CAAC9E,IAAI,KAAK,CAAY,aAAE,CAAC;QACjC,MAAM,CAAC,KAAK;IACd,CAAC;IACD,KAAK,CAAC+E,aAAa,GAAGvE,IAAI,CAACY,SAAS,CAAC,CAAC;IACtC,EAAE,EAAE2D,aAAa,CAAC/E,IAAI,KAAK,CAAS,UAAE,CAAC;QACrC,MAAM,CAAC,KAAK;IACd,CAAC;IACD,EAA0B,AAA1B,wBAA0B;IAC1B,EAA0B,AAA1B,wBAA0B;IAC1B,MAAM,EACH8E,MAAM,CAACxE,IAAI,KAAK,CAAM,SAAIwE,MAAM,CAACxE,IAAI,KAAK,CAAO,WAClDyE,aAAa,CAACjD,KAAK,KAAK,CAAM;AAElC,CAAC"}