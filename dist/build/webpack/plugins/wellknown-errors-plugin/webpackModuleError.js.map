{"version":3,"sources":["../../../../../build/webpack/plugins/wellknown-errors-plugin/webpackModuleError.ts"],"sourcesContent":["import { readFileSync } from 'fs'\nimport * as path from 'path'\nimport type { webpack5 as webpack } from 'next/dist/compiled/webpack/webpack'\nimport { getBabelError } from './parseBabel'\nimport { getCssError } from './parseCss'\nimport { getScssError } from './parseScss'\nimport { getNotFoundError } from './parseNotFoundError'\nimport { SimpleWebpackError } from './simpleWebpackError'\nimport isError from '../../../../lib/is-error'\n\nfunction getFileData(\n  compilation: webpack.Compilation,\n  m: any\n): [string, string | null] {\n  let resolved: string\n  let ctx: string | null = compilation.compiler?.context ?? null\n  if (ctx !== null && typeof m.resource === 'string') {\n    const res = path.relative(ctx, m.resource).replace(/\\\\/g, path.posix.sep)\n    resolved = res.startsWith('.') ? res : `.${path.posix.sep}${res}`\n  } else {\n    const requestShortener = compilation.requestShortener\n    if (typeof m?.readableIdentifier === 'function') {\n      resolved = m.readableIdentifier(requestShortener)\n    } else {\n      resolved = m.request ?? m.userRequest\n    }\n  }\n\n  if (resolved) {\n    let content: string | null = null\n    try {\n      content = readFileSync(\n        ctx ? path.resolve(ctx, resolved) : resolved,\n        'utf8'\n      )\n    } catch {}\n    return [resolved, content]\n  }\n\n  return ['<unknown>', null]\n}\n\nexport async function getModuleBuildError(\n  compilation: webpack.Compilation,\n  input: any\n): Promise<SimpleWebpackError | false> {\n  if (\n    !(\n      typeof input === 'object' &&\n      (input?.name === 'ModuleBuildError' ||\n        input?.name === 'ModuleNotFoundError') &&\n      Boolean(input.module) &&\n      isError(input.error)\n    )\n  ) {\n    return false\n  }\n\n  const err: Error = input.error\n  const [sourceFilename, sourceContent] = getFileData(compilation, input.module)\n\n  const notFoundError = await getNotFoundError(\n    compilation,\n    input,\n    sourceFilename\n  )\n  if (notFoundError !== false) {\n    return notFoundError\n  }\n\n  const babel = getBabelError(sourceFilename, err)\n  if (babel !== false) {\n    return babel\n  }\n\n  const css = getCssError(sourceFilename, err)\n  if (css !== false) {\n    return css\n  }\n\n  const scss = getScssError(sourceFilename, sourceContent, err)\n  if (scss !== false) {\n    return scss\n  }\n\n  return false\n}\n"],"names":["getModuleBuildError","path","getFileData","compilation","m","resolved","ctx","compiler","context","resource","res","relative","replace","posix","sep","startsWith","requestShortener","readableIdentifier","request","userRequest","content","resolve","input","name","Boolean","module","error","err","sourceFilename","sourceContent","notFoundError","babel","css","scss"],"mappings":"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"}