{"version":3,"sources":["../../../build/swc/options.js"],"sourcesContent":["const nextDistPath =\n  /(next[\\\\/]dist[\\\\/]shared[\\\\/]lib)|(next[\\\\/]dist[\\\\/]client)|(next[\\\\/]dist[\\\\/]pages)/\n\nconst regeneratorRuntimePath = require.resolve(\n  'next/dist/compiled/regenerator-runtime'\n)\n\nexport function getBaseSWCOptions({\n  filename,\n  jest,\n  development,\n  hasReactRefresh,\n  globalWindow,\n  nextConfig,\n  resolvedBaseUrl,\n  jsConfig,\n}) {\n  const isTSFile = filename.endsWith('.ts')\n  const isTypeScript = isTSFile || filename.endsWith('.tsx')\n  const paths = jsConfig?.compilerOptions?.paths\n  const enableDecorators = Boolean(\n    jsConfig?.compilerOptions?.experimentalDecorators\n  )\n  const emitDecoratorMetadata = Boolean(\n    jsConfig?.compilerOptions?.emitDecoratorMetadata\n  )\n  return {\n    jsc: {\n      ...(resolvedBaseUrl && paths\n        ? {\n            baseUrl: resolvedBaseUrl,\n            paths,\n          }\n        : {}),\n      parser: {\n        syntax: isTypeScript ? 'typescript' : 'ecmascript',\n        dynamicImport: true,\n        importAssertions: true,\n        decorators: enableDecorators,\n        // Exclude regular TypeScript files from React transformation to prevent e.g. generic parameters and angle-bracket type assertion from being interpreted as JSX tags.\n        [isTypeScript ? 'tsx' : 'jsx']: isTSFile ? false : true,\n      },\n      experimental: {\n        keepImportAssertions: true,\n      },\n      transform: {\n        // Enables https://github.com/swc-project/swc/blob/0359deb4841be743d73db4536d4a22ac797d7f65/crates/swc_ecma_ext_transforms/src/jest.rs\n        ...(jest\n          ? {\n              hidden: {\n                jest: true,\n              },\n            }\n          : {}),\n        legacyDecorator: enableDecorators,\n        decoratorMetadata: emitDecoratorMetadata,\n        react: {\n          importSource: jsConfig?.compilerOptions?.jsxImportSource || 'react',\n          runtime: 'automatic',\n          pragma: 'React.createElement',\n          pragmaFrag: 'React.Fragment',\n          throwIfNamespace: true,\n          development: !!development,\n          useBuiltins: true,\n          refresh: !!hasReactRefresh,\n        },\n        optimizer: {\n          simplify: false,\n          globals: jest\n            ? null\n            : {\n                typeofs: {\n                  window: globalWindow ? 'object' : 'undefined',\n                },\n                envs: {\n                  NODE_ENV: development ? '\"development\"' : '\"production\"',\n                },\n                // TODO: handle process.browser to match babel replacing as well\n              },\n        },\n        regenerator: {\n          importPath: regeneratorRuntimePath,\n        },\n      },\n    },\n    sourceMaps: jest ? 'inline' : undefined,\n    styledComponents: nextConfig?.experimental?.styledComponents\n      ? {\n          displayName: Boolean(development),\n        }\n      : null,\n    removeConsole: nextConfig?.experimental?.removeConsole,\n    reactRemoveProperties: nextConfig?.experimental?.reactRemoveProperties,\n    relay: nextConfig?.experimental?.relay,\n  }\n}\n\nexport function getJestSWCOptions({\n  isServer,\n  filename,\n  esm,\n  nextConfig,\n  jsConfig,\n  // This is not passed yet as \"paths\" resolving needs a test first\n  // resolvedBaseUrl,\n}) {\n  let baseOptions = getBaseSWCOptions({\n    filename,\n    jest: true,\n    development: false,\n    hasReactRefresh: false,\n    globalWindow: !isServer,\n    nextConfig,\n    jsConfig,\n    // resolvedBaseUrl,\n  })\n\n  const isNextDist = nextDistPath.test(filename)\n\n  return {\n    ...baseOptions,\n    env: {\n      targets: {\n        // Targets the current version of Node.js\n        node: process.versions.node,\n      },\n      // we always transpile optional chaining and nullish coalescing\n      // since it can cause issues with webpack even if the node target\n      // supports them\n      include: [\n        'proposal-optional-chaining',\n        'proposal-nullish-coalescing-operator',\n      ],\n    },\n    module: {\n      type: esm && !isNextDist ? 'es6' : 'commonjs',\n    },\n    disableNextSsg: true,\n    disablePageConfig: true,\n  }\n}\n\nexport function getLoaderSWCOptions({\n  filename,\n  development,\n  isServer,\n  pagesDir,\n  isPageFile,\n  hasReactRefresh,\n  nextConfig,\n  jsConfig,\n  // This is not passed yet as \"paths\" resolving is handled by webpack currently.\n  // resolvedBaseUrl,\n}) {\n  let baseOptions = getBaseSWCOptions({\n    filename,\n    development,\n    globalWindow: !isServer,\n    hasReactRefresh,\n    nextConfig,\n    jsConfig,\n    // resolvedBaseUrl,\n  })\n\n  const isNextDist = nextDistPath.test(filename)\n\n  if (isServer) {\n    return {\n      ...baseOptions,\n      // Disables getStaticProps/getServerSideProps tree shaking on the server compilation for pages\n      disableNextSsg: true,\n      disablePageConfig: true,\n      isDevelopment: development,\n      isServer,\n      pagesDir,\n      isPageFile,\n      env: {\n        targets: {\n          // Targets the current version of Node.js\n          node: process.versions.node,\n        },\n        // we always transpile optional chaining and nullish coalescing\n        // since it can cause issues with webpack even if the node target\n        // supports them\n        include: [\n          'proposal-optional-chaining',\n          'proposal-nullish-coalescing-operator',\n        ],\n      },\n    }\n  } else {\n    // Matches default @babel/preset-env behavior\n    baseOptions.jsc.target = 'es5'\n    return {\n      ...baseOptions,\n      // Ensure Next.js internals are output as commonjs modules\n      ...(isNextDist\n        ? {\n            module: {\n              type: 'commonjs',\n            },\n          }\n        : {}),\n      disableNextSsg: !isPageFile,\n      isDevelopment: development,\n      isServer,\n      pagesDir,\n      isPageFile,\n    }\n  }\n}\n"],"names":["getBaseSWCOptions","getJestSWCOptions","getLoaderSWCOptions","nextDistPath","regeneratorRuntimePath","require","resolve","filename","jest","development","hasReactRefresh","globalWindow","nextConfig","resolvedBaseUrl","jsConfig","isTSFile","endsWith","isTypeScript","paths","compilerOptions","enableDecorators","Boolean","experimentalDecorators","emitDecoratorMetadata","jsc","baseUrl","parser","syntax","dynamicImport","importAssertions","decorators","experimental","keepImportAssertions","transform","hidden","legacyDecorator","decoratorMetadata","react","importSource","jsxImportSource","runtime","pragma","pragmaFrag","throwIfNamespace","useBuiltins","refresh","optimizer","simplify","globals","typeofs","window","envs","NODE_ENV","regenerator","importPath","sourceMaps","undefined","styledComponents","displayName","removeConsole","reactRemoveProperties","relay","isServer","esm","baseOptions","isNextDist","test","env","targets","node","process","versions","include","module","type","disableNextSsg","disablePageConfig","pagesDir","isPageFile","isDevelopment","target"],"mappings":"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"}