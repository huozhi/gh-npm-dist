{"version":3,"sources":["../../cli/next-telemetry.ts"],"sourcesContent":["#!/usr/bin/env node\nimport chalk from 'next/dist/compiled/chalk'\nimport arg from 'next/dist/compiled/arg/index.js'\nimport { printAndExit } from '../server/lib/utils'\nimport { cliCommand } from '../bin/next'\nimport { Telemetry } from '../telemetry/storage'\nimport isError from '../lib/is-error'\n\nconst nextTelemetry: cliCommand = (argv) => {\n  const validArgs: arg.Spec = {\n    // Types\n    '--help': Boolean,\n    '--enable': Boolean,\n    '--disable': Boolean,\n    // Aliases\n    '-h': '--help',\n  }\n  let args: arg.Result<arg.Spec>\n  try {\n    args = arg(validArgs, { argv })\n  } catch (error) {\n    if (isError(error) && error.code === 'ARG_UNKNOWN_OPTION') {\n      return printAndExit(error.message, 1)\n    }\n    throw error\n  }\n\n  if (args['--help']) {\n    console.log(\n      `\n      Description\n        Allows you to control Next.js' telemetry collection\n\n      Usage\n        $ next telemetry [enable/disable]\n\n      You may pass the 'enable' or 'disable' argument to turn Next.js' telemetry collection on or off.\n\n      Learn more: ${chalk.cyan('https://nextjs.org/telemetry')}\n    `\n    )\n    return\n  }\n\n  const telemetry = new Telemetry({ distDir: process.cwd() })\n\n  let isEnabled = telemetry.isEnabled\n\n  if (args['--enable'] || args._[0] === 'enable') {\n    telemetry.setEnabled(true)\n    console.log(chalk.cyan('Success!'))\n    console.log()\n\n    isEnabled = true\n  } else if (args['--disable'] || args._[0] === 'disable') {\n    const path = telemetry.setEnabled(false)\n    if (isEnabled) {\n      console.log(\n        chalk.cyan(\n          `Your preference has been saved${path ? ` to ${path}` : ''}.`\n        )\n      )\n    } else {\n      console.log(\n        chalk.yellow(`Next.js' telemetry collection is already disabled.`)\n      )\n    }\n    console.log()\n\n    isEnabled = false\n  } else {\n    console.log(chalk.bold('Next.js Telemetry'))\n    console.log()\n  }\n\n  console.log(\n    `Status: ${\n      isEnabled ? chalk.bold.green('Enabled') : chalk.bold.red('Disabled')\n    }`\n  )\n  console.log()\n\n  if (isEnabled) {\n    console.log(\n      `Next.js telemetry is completely anonymous. Thank you for participating!`\n    )\n  } else {\n    console.log(`You have opted-out of Next.js' anonymous telemetry program.`)\n    console.log(`No data will be collected from your machine.`)\n  }\n\n  console.log(`Learn more: https://nextjs.org/telemetry`)\n  console.log()\n}\n\nexport { nextTelemetry }\n"],"names":["nextTelemetry","argv","validArgs","Boolean","args","error","code","message","console","log","cyan","telemetry","distDir","process","cwd","isEnabled","_","setEnabled","path","yellow","bold","green","red"],"mappings":"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"}