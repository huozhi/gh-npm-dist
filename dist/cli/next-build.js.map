{"version":3,"sources":["../../cli/next-build.ts"],"sourcesContent":["#!/usr/bin/env node\nimport { existsSync } from 'fs'\nimport arg from 'next/dist/compiled/arg/index.js'\nimport * as Log from '../build/output/log'\nimport { cliCommand } from '../bin/next'\nimport build from '../build'\nimport { printAndExit } from '../server/lib/utils'\nimport isError from '../lib/is-error'\nimport { getProjectDir } from '../lib/get-project-dir'\n\nconst nextBuild: cliCommand = (argv) => {\n  const validArgs: arg.Spec = {\n    // Types\n    '--help': Boolean,\n    '--profile': Boolean,\n    '--debug': Boolean,\n    '--no-lint': Boolean,\n    // Aliases\n    '-h': '--help',\n    '-d': '--debug',\n  }\n\n  let args: arg.Result<arg.Spec>\n  try {\n    args = arg(validArgs, { argv })\n  } catch (error) {\n    if (isError(error) && error.code === 'ARG_UNKNOWN_OPTION') {\n      return printAndExit(error.message, 1)\n    }\n    throw error\n  }\n  if (args['--help']) {\n    printAndExit(\n      `\n      Description\n        Compiles the application for production deployment\n\n      Usage\n        $ next build <dir>\n\n      <dir> represents the directory of the Next.js application.\n      If no directory is provided, the current directory will be used.\n\n      Options\n      --profile     Can be used to enable React Production Profiling\n      --no-lint     Disable linting\n    `,\n      0\n    )\n  }\n  if (args['--profile']) {\n    Log.warn('Profiling is enabled. Note: This may affect performance')\n  }\n  if (args['--no-lint']) {\n    Log.warn('Linting is disabled')\n  }\n  const dir = getProjectDir(args._[0])\n\n  // Check if the provided directory exists\n  if (!existsSync(dir)) {\n    printAndExit(`> No such directory exists as the project root: ${dir}`)\n  }\n\n  return build(\n    dir,\n    null,\n    args['--profile'],\n    args['--debug'],\n    !args['--no-lint']\n  ).catch((err) => {\n    console.error('')\n    if (\n      isError(err) &&\n      (err.code === 'INVALID_RESOLVE_ALIAS' ||\n        err.code === 'WEBPACK_ERRORS' ||\n        err.code === 'BUILD_OPTIMIZATION_FAILED' ||\n        err.code === 'EDGE_RUNTIME_UNSUPPORTED_API')\n    ) {\n      printAndExit(`> ${err.message}`)\n    } else {\n      console.error('> Build error occurred')\n      printAndExit(err)\n    }\n  })\n}\n\nexport { nextBuild }\n"],"names":["Log","nextBuild","argv","validArgs","Boolean","args","error","code","message","warn","dir","_","catch","err","console"],"mappings":";;;;;;AAC2B,GAAI,CAAJ,GAAI;AACf,GAAiC,CAAjC,QAAiC;AACrCA,GAAG,CAAHA,GAAG;AAEG,GAAU,CAAV,MAAU;AACC,GAAqB,CAArB,MAAqB;AAC9B,GAAiB,CAAjB,QAAiB;AACP,GAAwB,CAAxB,cAAwB;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEtD,KAAK,CAACC,SAAS,IAAgBC,IAAI,GAAK,CAAC;IACvC,KAAK,CAACC,SAAS,GAAa,CAAC;QAC3B,EAAQ,AAAR,MAAQ;QACR,CAAQ,SAAEC,OAAO;QACjB,CAAW,YAAEA,OAAO;QACpB,CAAS,UAAEA,OAAO;QAClB,CAAW,YAAEA,OAAO;QACpB,EAAU,AAAV,QAAU;QACV,CAAI,KAAE,CAAQ;QACd,CAAI,KAAE,CAAS;IACjB,CAAC;IAED,GAAG,CAACC,IAAI;IACR,GAAG,CAAC,CAAC;QACHA,IAAI,OAtBQ,QAAiC,UAsBlCF,SAAS,EAAE,CAAC;YAACD,IAAI;QAAC,CAAC;IAChC,CAAC,CAAC,KAAK,EAAEI,KAAK,EAAE,CAAC;QACf,EAAE,MAnBc,QAAiB,UAmBrBA,KAAK,KAAKA,KAAK,CAACC,IAAI,KAAK,CAAoB,qBAAE,CAAC;YAC1D,MAAM,KArBiB,MAAqB,eAqBxBD,KAAK,CAACE,OAAO,EAAE,CAAC;QACtC,CAAC;QACD,KAAK,CAACF,KAAK;IACb,CAAC;IACD,EAAE,EAAED,IAAI,CAAC,CAAQ,UAAG,CAAC;YAzBM,MAAqB,gBA2B3C;;;;;;;;;;;;;IAaH,GACE,CAAC;IAEL,CAAC;IACD,EAAE,EAAEA,IAAI,CAAC,CAAW,aAAG,CAAC;QA/CdL,GAAG,CAgDPS,IAAI,CAAC,CAAyD;IACpE,CAAC;IACD,EAAE,EAAEJ,IAAI,CAAC,CAAW,aAAG,CAAC;QAlDdL,GAAG,CAmDPS,IAAI,CAAC,CAAqB;IAChC,CAAC;IACD,KAAK,CAACC,GAAG,OAhDmB,cAAwB,gBAgD1BL,IAAI,CAACM,CAAC,CAAC,CAAC;IAElC,EAAyC,AAAzC,uCAAyC;IACzC,EAAE,OA1DuB,GAAI,aA0DbD,GAAG,GAAG,CAAC;YArDI,MAAqB,gBAsDhC,gDAAgD,EAAEA,GAAG;IACrE,CAAC;IAED,MAAM,KA1DU,MAAU,UA2DxBA,GAAG,EACH,IAAI,EACJL,IAAI,CAAC,CAAW,aAChBA,IAAI,CAAC,CAAS,YACbA,IAAI,CAAC,CAAW,aACjBO,KAAK,EAAEC,GAAG,GAAK,CAAC;QAChBC,OAAO,CAACR,KAAK,CAAC,CAAE;QAChB,EAAE,MAhEc,QAAiB,UAiEvBO,GAAG,MACVA,GAAG,CAACN,IAAI,KAAK,CAAuB,0BACnCM,GAAG,CAACN,IAAI,KAAK,CAAgB,mBAC7BM,GAAG,CAACN,IAAI,KAAK,CAA2B,8BACxCM,GAAG,CAACN,IAAI,KAAK,CAA8B,gCAC7C,CAAC;gBAvEsB,MAAqB,gBAwE9B,EAAE,EAAEM,GAAG,CAACL,OAAO;QAC/B,CAAC,MAAM,CAAC;YACNM,OAAO,CAACR,KAAK,CAAC,CAAwB;gBA1Ef,MAAqB,eA2E/BO,GAAG;QAClB,CAAC;IACH,CAAC;AACH,CAAC;QAEQZ,SAAS,GAATA,SAAS"}