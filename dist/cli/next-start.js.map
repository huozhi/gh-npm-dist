{"version":3,"sources":["../../cli/next-start.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport arg from 'next/dist/compiled/arg/index.js'\nimport { startServer } from '../server/lib/start-server'\nimport { printAndExit } from '../server/lib/utils'\nimport { cliCommand } from '../bin/next'\nimport * as Log from '../build/output/log'\nimport isError from '../lib/is-error'\nimport { getProjectDir } from '../lib/get-project-dir'\n\nconst nextStart: cliCommand = (argv) => {\n  const validArgs: arg.Spec = {\n    // Types\n    '--help': Boolean,\n    '--port': Number,\n    '--hostname': String,\n\n    // Aliases\n    '-h': '--help',\n    '-p': '--port',\n    '-H': '--hostname',\n  }\n  let args: arg.Result<arg.Spec>\n  try {\n    args = arg(validArgs, { argv })\n  } catch (error) {\n    if (isError(error) && error.code === 'ARG_UNKNOWN_OPTION') {\n      return printAndExit(error.message, 1)\n    }\n    throw error\n  }\n  if (args['--help']) {\n    console.log(`\n      Description\n        Starts the application in production mode.\n        The application should be compiled with \\`next build\\` first.\n\n      Usage\n        $ next start <dir> -p <port>\n\n      <dir> represents the directory of the Next.js application.\n      If no directory is provided, the current directory will be used.\n\n      Options\n        --port, -p      A port number on which to start the application\n        --hostname, -H  Hostname on which to start the application (default: 0.0.0.0)\n        --help, -h      Displays this message\n    `)\n    process.exit(0)\n  }\n\n  const dir = getProjectDir(args._[0])\n  let port: number =\n    args['--port'] || (process.env.PORT && parseInt(process.env.PORT)) || 3000\n  const host = args['--hostname'] || '0.0.0.0'\n\n  if (process.env.__NEXT_RAND_PORT) {\n    port = 0\n  }\n\n  startServer({\n    dir,\n    hostname: host,\n    port,\n  })\n    .then(async (app) => {\n      const appUrl = `http://${app.hostname}:${app.port}`\n      Log.ready(`started server on ${host}:${app.port}, url: ${appUrl}`)\n      await app.prepare()\n    })\n    .catch((err) => {\n      console.error(err)\n      process.exit(1)\n    })\n}\n\nexport { nextStart }\n"],"names":["Log","nextStart","argv","validArgs","Boolean","Number","String","args","error","code","message","console","log","process","exit","dir","_","port","env","PORT","parseInt","host","__NEXT_RAND_PORT","hostname","then","app","appUrl","ready","prepare","catch","err"],"mappings":";;;;;;AAEgB,GAAiC,CAAjC,QAAiC;AACrB,GAA4B,CAA5B,YAA4B;AAC3B,GAAqB,CAArB,MAAqB;AAEtCA,GAAG,CAAHA,GAAG;AACK,GAAiB,CAAjB,QAAiB;AACP,GAAwB,CAAxB,cAAwB;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEtD,KAAK,CAACC,SAAS,IAAgBC,IAAI,GAAK,CAAC;IACvC,KAAK,CAACC,SAAS,GAAa,CAAC;QAC3B,EAAQ,AAAR,MAAQ;QACR,CAAQ,SAAEC,OAAO;QACjB,CAAQ,SAAEC,MAAM;QAChB,CAAY,aAAEC,MAAM;QAEpB,EAAU,AAAV,QAAU;QACV,CAAI,KAAE,CAAQ;QACd,CAAI,KAAE,CAAQ;QACd,CAAI,KAAE,CAAY;IACpB,CAAC;IACD,GAAG,CAACC,IAAI;IACR,GAAG,CAAC,CAAC;QACHA,IAAI,OAtBQ,QAAiC,UAsBlCJ,SAAS,EAAE,CAAC;YAACD,IAAI;QAAC,CAAC;IAChC,CAAC,CAAC,KAAK,EAAEM,KAAK,EAAE,CAAC;QACf,EAAE,MAnBc,QAAiB,UAmBrBA,KAAK,KAAKA,KAAK,CAACC,IAAI,KAAK,CAAoB,qBAAE,CAAC;YAC1D,MAAM,KAvBiB,MAAqB,eAuBxBD,KAAK,CAACE,OAAO,EAAE,CAAC;QACtC,CAAC;QACD,KAAK,CAACF,KAAK;IACb,CAAC;IACD,EAAE,EAAED,IAAI,CAAC,CAAQ,UAAG,CAAC;QACnBI,OAAO,CAACC,GAAG,EAAE;;;;;;;;;;;;;;;IAeb;QACAC,OAAO,CAACC,IAAI,CAAC,CAAC;IAChB,CAAC;IAED,KAAK,CAACC,GAAG,OA3CmB,cAAwB,gBA2C1BR,IAAI,CAACS,CAAC,CAAC,CAAC;IAClC,GAAG,CAACC,IAAI,GACNV,IAAI,CAAC,CAAQ,YAAMM,OAAO,CAACK,GAAG,CAACC,IAAI,IAAIC,QAAQ,CAACP,OAAO,CAACK,GAAG,CAACC,IAAI,KAAM,IAAI;IAC5E,KAAK,CAACE,IAAI,GAAGd,IAAI,CAAC,CAAY,gBAAK,CAAS;IAE5C,EAAE,EAAEM,OAAO,CAACK,GAAG,CAACI,gBAAgB,EAAE,CAAC;QACjCL,IAAI,GAAG,CAAC;IACV,CAAC;QAvDyB,YAA4B,cAyD1C,CAAC;QACXF,GAAG;QACHQ,QAAQ,EAAEF,IAAI;QACdJ,IAAI;IACN,CAAC,EACEO,IAAI,QAAQC,GAAG,GAAK,CAAC;QACpB,KAAK,CAACC,MAAM,IAAI,OAAO,EAAED,GAAG,CAACF,QAAQ,CAAC,CAAC,EAAEE,GAAG,CAACR,IAAI;QA5D3CjB,GAAG,CA6DL2B,KAAK,EAAE,kBAAkB,EAAEN,IAAI,CAAC,CAAC,EAAEI,GAAG,CAACR,IAAI,CAAC,OAAO,EAAES,MAAM;QAC/D,KAAK,CAACD,GAAG,CAACG,OAAO;IACnB,CAAC,EACAC,KAAK,EAAEC,GAAG,GAAK,CAAC;QACfnB,OAAO,CAACH,KAAK,CAACsB,GAAG;QACjBjB,OAAO,CAACC,IAAI,CAAC,CAAC;IAChB,CAAC;AACL,CAAC;QAEQb,SAAS,GAATA,SAAS"}