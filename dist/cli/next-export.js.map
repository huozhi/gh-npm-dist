{"version":3,"sources":["../../cli/next-export.ts"],"sourcesContent":["#!/usr/bin/env node\nimport { resolve, join } from 'path'\nimport { existsSync } from 'fs'\nimport arg from 'next/dist/compiled/arg/index.js'\nimport exportApp from '../export'\nimport { printAndExit } from '../server/lib/utils'\nimport { cliCommand } from '../bin/next'\nimport { trace } from '../trace'\nimport isError from '../lib/is-error'\nimport { getProjectDir } from '../lib/get-project-dir'\n\nconst nextExport: cliCommand = (argv) => {\n  const nextExportCliSpan = trace('next-export-cli')\n  const validArgs: arg.Spec = {\n    // Types\n    '--help': Boolean,\n    '--silent': Boolean,\n    '--outdir': String,\n    '--threads': Number,\n\n    // Aliases\n    '-h': '--help',\n    '-s': '--silent',\n    '-o': '--outdir',\n  }\n  let args: arg.Result<arg.Spec>\n  try {\n    args = arg(validArgs, { argv })\n  } catch (error) {\n    if (isError(error) && error.code === 'ARG_UNKNOWN_OPTION') {\n      return printAndExit(error.message, 1)\n    }\n    throw error\n  }\n  if (args['--help']) {\n    console.log(`\n      Description\n        Exports the application for production deployment\n\n      Usage\n        $ next export [options] <dir>\n\n      <dir> represents the directory of the Next.js application.\n      If no directory is provided, the current directory will be used.\n\n      Options\n        -h - list this help\n        -o - set the output dir (defaults to 'out')\n        -s - do not print any messages to console\n    `)\n    process.exit(0)\n  }\n\n  const dir = getProjectDir(args._[0])\n\n  // Check if pages dir exists and warn if not\n  if (!existsSync(dir)) {\n    printAndExit(`> No such directory exists as the project root: ${dir}`)\n  }\n\n  const options = {\n    silent: args['--silent'] || false,\n    threads: args['--threads'],\n    outdir: args['--outdir'] ? resolve(args['--outdir']) : join(dir, 'out'),\n  }\n\n  exportApp(dir, options, nextExportCliSpan)\n    .then(() => {\n      nextExportCliSpan.stop()\n      printAndExit(`Export successful. Files written to ${options.outdir}`, 0)\n    })\n    .catch((err) => {\n      nextExportCliSpan.stop()\n      printAndExit(err)\n    })\n}\n\nexport { nextExport }\n"],"names":["nextExport","argv","nextExportCliSpan","validArgs","Boolean","String","Number","args","error","code","message","console","log","process","exit","dir","_","options","silent","threads","outdir","then","stop","catch","err"],"mappings":";;;;;;AAC8B,GAAM,CAAN,KAAM;AACT,GAAI,CAAJ,GAAI;AACf,GAAiC,CAAjC,QAAiC;AAC3B,GAAW,CAAX,OAAW;AACJ,GAAqB,CAArB,MAAqB;AAE5B,GAAU,CAAV,MAAU;AACZ,GAAiB,CAAjB,QAAiB;AACP,GAAwB,CAAxB,cAAwB;;;;;;AAEtD,KAAK,CAACA,UAAU,IAAgBC,IAAI,GAAK,CAAC;IACxC,KAAK,CAACC,iBAAiB,OALH,MAAU,QAKE,CAAiB;IACjD,KAAK,CAACC,SAAS,GAAa,CAAC;QAC3B,EAAQ,AAAR,MAAQ;QACR,CAAQ,SAAEC,OAAO;QACjB,CAAU,WAAEA,OAAO;QACnB,CAAU,WAAEC,MAAM;QAClB,CAAW,YAAEC,MAAM;QAEnB,EAAU,AAAV,QAAU;QACV,CAAI,KAAE,CAAQ;QACd,CAAI,KAAE,CAAU;QAChB,CAAI,KAAE,CAAU;IAClB,CAAC;IACD,GAAG,CAACC,IAAI;IACR,GAAG,CAAC,CAAC;QACHA,IAAI,OAxBQ,QAAiC,UAwBlCJ,SAAS,EAAE,CAAC;YAACF,IAAI;QAAC,CAAC;IAChC,CAAC,CAAC,KAAK,EAAEO,KAAK,EAAE,CAAC;QACf,EAAE,MArBc,QAAiB,UAqBrBA,KAAK,KAAKA,KAAK,CAACC,IAAI,KAAK,CAAoB,qBAAE,CAAC;YAC1D,MAAM,KAzBiB,MAAqB,eAyBxBD,KAAK,CAACE,OAAO,EAAE,CAAC;QACtC,CAAC;QACD,KAAK,CAACF,KAAK;IACb,CAAC;IACD,EAAE,EAAED,IAAI,CAAC,CAAQ,UAAG,CAAC;QACnBI,OAAO,CAACC,GAAG,EAAE;;;;;;;;;;;;;;IAcb;QACAC,OAAO,CAACC,IAAI,CAAC,CAAC;IAChB,CAAC;IAED,KAAK,CAACC,GAAG,OA5CmB,cAAwB,gBA4C1BR,IAAI,CAACS,CAAC,CAAC,CAAC;IAElC,EAA4C,AAA5C,0CAA4C;IAC5C,EAAE,OAtDuB,GAAI,aAsDbD,GAAG,GAAG,CAAC;YAnDI,MAAqB,gBAoDhC,gDAAgD,EAAEA,GAAG;IACrE,CAAC;IAED,KAAK,CAACE,OAAO,GAAG,CAAC;QACfC,MAAM,EAAEX,IAAI,CAAC,CAAU,cAAK,KAAK;QACjCY,OAAO,EAAEZ,IAAI,CAAC,CAAW;QACzBa,MAAM,EAAEb,IAAI,CAAC,CAAU,iBA9DG,KAAM,UA8DGA,IAAI,CAAC,CAAU,kBA9DxB,KAAM,OA8D4BQ,GAAG,EAAE,CAAK;IACxE,CAAC;QA5DmB,OAAW,UA8DrBA,GAAG,EAAEE,OAAO,EAAEf,iBAAiB,EACtCmB,IAAI,KAAO,CAAC;QACXnB,iBAAiB,CAACoB,IAAI;YA/DC,MAAqB,gBAgE9B,oCAAoC,EAAEL,OAAO,CAACG,MAAM,IAAI,CAAC;IACzE,CAAC,EACAG,KAAK,EAAEC,GAAG,GAAK,CAAC;QACftB,iBAAiB,CAACoB,IAAI;YAnEC,MAAqB,eAoE/BE,GAAG;IAClB,CAAC;AACL,CAAC;QAEQxB,UAAU,GAAVA,UAAU"}