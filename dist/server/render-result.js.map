{"version":3,"sources":["../../server/render-result.ts"],"sourcesContent":["import type { ServerResponse } from 'http'\n\nexport default class RenderResult {\n  _result: string | ReadableStream\n\n  constructor(response: string | ReadableStream) {\n    this._result = response\n  }\n\n  toUnchunkedString(): string {\n    if (typeof this._result !== 'string') {\n      throw new Error(\n        'invariant: dynamic responses cannot be unchunked. This is a bug in Next.js'\n      )\n    }\n    return this._result\n  }\n\n  pipe(res: ServerResponse): Promise<void> {\n    if (typeof this._result === 'string') {\n      throw new Error(\n        'invariant: static responses cannot be piped. This is a bug in Next.js'\n      )\n    }\n    const response = this._result\n    const flush =\n      typeof (res as any).flush === 'function'\n        ? () => (res as any).flush()\n        : () => {}\n\n    return (async () => {\n      const reader = response.getReader()\n      let fatalError = false\n\n      try {\n        while (true) {\n          const { done, value } = await reader.read()\n\n          if (done) {\n            res.end()\n            return\n          }\n\n          fatalError = true\n          res.write(value)\n          flush()\n        }\n      } catch (err) {\n        if (fatalError) {\n          res.destroy(err as any)\n        }\n        throw err\n      }\n    })()\n  }\n\n  isDynamic(): boolean {\n    return typeof this._result !== 'string'\n  }\n\n  static fromStatic(value: string): RenderResult {\n    return new RenderResult(value)\n  }\n\n  static empty = RenderResult.fromStatic('')\n}\n"],"names":["RenderResult","response","_result","toUnchunkedString","Error","pipe","res","flush","reader","getReader","fatalError","done","value","read","end","write","err","destroy","isDynamic","fromStatic","empty"],"mappings":";;;;;MAEqBA,YAAY;gBAGnBC,QAAiC,CAAE,CAAC;QAC9C,IAAI,CAACC,OAAO,GAAGD,QAAQ;IACzB,CAAC;IAEDE,iBAAiB,GAAW,CAAC;QAC3B,EAAE,EAAE,MAAM,CAAC,IAAI,CAACD,OAAO,KAAK,CAAQ,SAAE,CAAC;YACrC,KAAK,CAAC,GAAG,CAACE,KAAK,CACb,CAA4E;QAEhF,CAAC;QACD,MAAM,CAAC,IAAI,CAACF,OAAO;IACrB,CAAC;IAEDG,IAAI,CAACC,GAAmB,EAAiB,CAAC;QACxC,EAAE,EAAE,MAAM,CAAC,IAAI,CAACJ,OAAO,KAAK,CAAQ,SAAE,CAAC;YACrC,KAAK,CAAC,GAAG,CAACE,KAAK,CACb,CAAuE;QAE3E,CAAC;QACD,KAAK,CAACH,QAAQ,GAAG,IAAI,CAACC,OAAO;QAC7B,KAAK,CAACK,KAAK,GACT,MAAM,CAAED,GAAG,CAASC,KAAK,KAAK,CAAU,gBAC7BD,GAAG,CAASC,KAAK;eAClB,CAAC,CAAC;QAEd,MAAM,YAAc,CAAC;YACnB,KAAK,CAACC,MAAM,GAAGP,QAAQ,CAACQ,SAAS;YACjC,GAAG,CAACC,UAAU,GAAG,KAAK;YAEtB,GAAG,CAAC,CAAC;sBACI,IAAI,CAAE,CAAC;oBACZ,KAAK,CAAC,CAAC,CAACC,IAAI,GAAEC,KAAK,EAAC,CAAC,GAAG,KAAK,CAACJ,MAAM,CAACK,IAAI;oBAEzC,EAAE,EAAEF,IAAI,EAAE,CAAC;wBACTL,GAAG,CAACQ,GAAG;wBACP,MAAM;oBACR,CAAC;oBAEDJ,UAAU,GAAG,IAAI;oBACjBJ,GAAG,CAACS,KAAK,CAACH,KAAK;oBACfL,KAAK;gBACP,CAAC;YACH,CAAC,CAAC,KAAK,EAAES,GAAG,EAAE,CAAC;gBACb,EAAE,EAAEN,UAAU,EAAE,CAAC;oBACfJ,GAAG,CAACW,OAAO,CAACD,GAAG;gBACjB,CAAC;gBACD,KAAK,CAACA,GAAG;YACX,CAAC;QACH,CAAC;IACH,CAAC;IAEDE,SAAS,GAAY,CAAC;QACpB,MAAM,CAAC,MAAM,CAAC,IAAI,CAAChB,OAAO,KAAK,CAAQ;IACzC,CAAC;WAEMiB,UAAU,CAACP,KAAa,EAAgB,CAAC;QAC9C,MAAM,CAAC,GAAG,CAACZ,YAAY,CAACY,KAAK;IAC/B,CAAC;;AA5DkBZ,YAAY,CA8DxBoB,KAAK,GA9DOpB,YAAY,CA8DHmB,UAAU,CAAC,CAAE;kBA9DtBnB,YAAY"}