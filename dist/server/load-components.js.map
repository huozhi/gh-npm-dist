{"version":3,"sources":["../../server/load-components.ts"],"sourcesContent":["import {\n  BUILD_MANIFEST,\n  REACT_LOADABLE_MANIFEST,\n} from '../shared/lib/constants'\nimport { join } from 'path'\nimport { requirePage } from './require'\nimport { BuildManifest } from './get-page-files'\nimport { AppType, DocumentType } from '../shared/lib/utils'\nimport { interopDefault } from '../lib/interop-default'\nimport {\n  PageConfig,\n  GetStaticPaths,\n  GetServerSideProps,\n  GetStaticProps,\n} from 'next/types'\n\nexport type ManifestItem = {\n  id: number | string\n  files: string[]\n}\n\nexport type ReactLoadableManifest = { [moduleId: string]: ManifestItem }\n\nexport type LoadComponentsReturnType = {\n  Component: React.ComponentType\n  pageConfig: PageConfig\n  buildManifest: BuildManifest\n  reactLoadableManifest: ReactLoadableManifest\n  Document: DocumentType\n  App: AppType\n  getStaticProps?: GetStaticProps\n  getStaticPaths?: GetStaticPaths\n  getServerSideProps?: GetServerSideProps\n  ComponentMod: any\n}\n\nexport async function loadDefaultErrorComponents(distDir: string) {\n  const Document = interopDefault(require('next/dist/pages/_document'))\n  const App = interopDefault(require('next/dist/pages/_app'))\n  const ComponentMod = require('next/dist/pages/_error')\n  const Component = interopDefault(ComponentMod)\n\n  return {\n    App,\n    Document,\n    Component,\n    pageConfig: {},\n    buildManifest: require(join(distDir, `fallback-${BUILD_MANIFEST}`)),\n    reactLoadableManifest: {},\n    ComponentMod,\n  }\n}\n\nexport async function loadComponents(\n  distDir: string,\n  pathname: string,\n  serverless: boolean\n): Promise<LoadComponentsReturnType> {\n  if (serverless) {\n    const ComponentMod = await requirePage(pathname, distDir, serverless)\n    if (typeof ComponentMod === 'string') {\n      return {\n        Component: ComponentMod as any,\n        pageConfig: {},\n        ComponentMod,\n      } as LoadComponentsReturnType\n    }\n\n    let {\n      default: Component,\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps,\n    } = ComponentMod\n\n    Component = await Component\n    getStaticProps = await getStaticProps\n    getStaticPaths = await getStaticPaths\n    getServerSideProps = await getServerSideProps\n    const pageConfig = (await ComponentMod.config) || {}\n\n    return {\n      Component,\n      pageConfig,\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps,\n      ComponentMod,\n    } as LoadComponentsReturnType\n  }\n\n  const [DocumentMod, AppMod, ComponentMod] = await Promise.all([\n    requirePage('/_document', distDir, serverless),\n    requirePage('/_app', distDir, serverless),\n    requirePage(pathname, distDir, serverless),\n  ])\n\n  const [buildManifest, reactLoadableManifest] = await Promise.all([\n    require(join(distDir, BUILD_MANIFEST)),\n    require(join(distDir, REACT_LOADABLE_MANIFEST)),\n  ])\n\n  const Component = interopDefault(ComponentMod)\n  const Document = interopDefault(DocumentMod)\n  const App = interopDefault(AppMod)\n\n  const { getServerSideProps, getStaticProps, getStaticPaths } = ComponentMod\n\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    pageConfig: ComponentMod.config || {},\n    ComponentMod,\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths,\n  }\n}\n"],"names":["loadDefaultErrorComponents","loadComponents","distDir","Document","require","App","ComponentMod","Component","pageConfig","buildManifest","reactLoadableManifest","pathname","serverless","default","getStaticProps","getStaticPaths","getServerSideProps","config","DocumentMod","AppMod","Promise","all"],"mappings":"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"}