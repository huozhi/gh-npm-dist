{"version":3,"sources":["../../server/base-server.ts"],"sourcesContent":["import type { __ApiPreviewProps } from './api-utils'\nimport type { CustomRoutes } from '../lib/load-custom-routes'\nimport type { DomainLocale } from './config'\nimport type { DynamicRoutes, PageChecker, Params, Route } from './router'\nimport type { FontManifest } from './font-utils'\nimport type { LoadComponentsReturnType } from './load-components'\nimport type { MiddlewareManifest } from '../build/webpack/plugins/middleware-plugin'\nimport type { NextConfig, NextConfigComplete } from './config-shared'\nimport type { NextParsedUrlQuery, NextUrlWithParsedQuery } from './request-meta'\nimport type { ParsedUrlQuery } from 'querystring'\nimport type { Rewrite } from '../lib/load-custom-routes'\nimport type { RenderOpts, RenderOptsPartial } from './render'\nimport type { ResponseCacheEntry, ResponseCacheValue } from './response-cache'\nimport type { UrlWithParsedQuery } from 'url'\nimport type { CacheFs } from '../shared/lib/utils'\nimport type { PreviewData } from 'next/types'\nimport type { PagesManifest } from '../build/webpack/plugins/pages-manifest-plugin'\nimport type { BaseNextRequest, BaseNextResponse } from './base-http'\n\nimport { join, resolve } from 'path'\nimport { parse as parseQs } from 'querystring'\nimport { format as formatUrl, parse as parseUrl } from 'url'\nimport { getRedirectStatus } from '../lib/load-custom-routes'\nimport {\n  SERVERLESS_DIRECTORY,\n  SERVER_DIRECTORY,\n  STATIC_STATUS_PAGES,\n  TEMPORARY_REDIRECT_STATUS,\n} from '../shared/lib/constants'\nimport {\n  getRouteMatcher,\n  getRouteRegex,\n  getSortedRoutes,\n  isDynamicRoute,\n} from '../shared/lib/router/utils'\nimport * as envConfig from '../shared/lib/runtime-config'\nimport { DecodeError, normalizeRepeatedSlashes } from '../shared/lib/utils'\nimport { setLazyProp, getCookieParser, tryGetPreviewData } from './api-utils'\nimport { isTargetLikeServerless } from './utils'\nimport Router, { replaceBasePath, route } from './router'\nimport { PayloadOptions, setRevalidateHeaders } from './send-payload'\nimport { IncrementalCache } from './incremental-cache'\nimport { execOnce } from '../shared/lib/utils'\nimport { isBlockedPage, isBot } from './utils'\nimport RenderResult from './render-result'\nimport { removePathTrailingSlash } from '../client/normalize-trailing-slash'\nimport getRouteFromAssetPath from '../shared/lib/router/utils/get-route-from-asset-path'\nimport { denormalizePagePath } from './denormalize-page-path'\nimport { normalizeLocalePath } from '../shared/lib/i18n/normalize-locale-path'\nimport * as Log from '../build/output/log'\nimport { detectDomainLocale } from '../shared/lib/i18n/detect-domain-locale'\nimport escapePathDelimiters from '../shared/lib/router/utils/escape-path-delimiters'\nimport { getUtils } from '../build/webpack/loaders/next-serverless-loader/utils'\nimport ResponseCache from './response-cache'\nimport { parseNextUrl } from '../shared/lib/router/utils/parse-next-url'\nimport isError, { getProperError } from '../lib/is-error'\nimport { MIDDLEWARE_ROUTE } from '../lib/constants'\nimport { addRequestMeta, getRequestMeta } from './request-meta'\nimport { createHeaderRoute, createRedirectRoute } from './server-route-utils'\nimport { PrerenderManifest } from '../build'\n\nexport type FindComponentsResult = {\n  components: LoadComponentsReturnType\n  query: NextParsedUrlQuery\n}\n\ninterface RoutingItem {\n  page: string\n  match: ReturnType<typeof getRouteMatcher>\n  ssr?: boolean\n}\n\nexport interface Options {\n  /**\n   * Object containing the configuration next.config.js\n   */\n  conf: NextConfig\n  /**\n   * Set to false when the server was created by Next.js\n   */\n  customServer?: boolean\n  /**\n   * Tells if Next.js is running in dev mode\n   */\n  dev?: boolean\n  /**\n   * Where the Next project is located\n   */\n  dir?: string\n  /**\n   * Tells if Next.js is running in a Serverless platform\n   */\n  minimalMode?: boolean\n  /**\n   * Hide error messages containing server information\n   */\n  quiet?: boolean\n  /**\n   * The hostname the server is running behind\n   */\n  hostname?: string\n  /**\n   * The port the server is running behind\n   */\n  port?: number\n}\n\nexport interface BaseRequestHandler {\n  (\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    parsedUrl?: NextUrlWithParsedQuery | undefined\n  ): Promise<void>\n}\n\ntype RequestContext = {\n  req: BaseNextRequest\n  res: BaseNextResponse\n  pathname: string\n  query: NextParsedUrlQuery\n  renderOpts: RenderOptsPartial\n}\n\nexport default abstract class Server {\n  protected dir: string\n  protected quiet: boolean\n  protected nextConfig: NextConfigComplete\n  protected distDir: string\n  protected pagesDir?: string\n  protected publicDir: string\n  protected hasStaticDir: boolean\n  protected pagesManifest?: PagesManifest\n  protected buildId: string\n  protected minimalMode: boolean\n  protected renderOpts: {\n    poweredByHeader: boolean\n    buildId: string\n    generateEtags: boolean\n    runtimeConfig?: { [key: string]: any }\n    assetPrefix?: string\n    canonicalBase: string\n    dev?: boolean\n    previewProps: __ApiPreviewProps\n    customServer?: boolean\n    ampOptimizerConfig?: { [key: string]: any }\n    basePath: string\n    optimizeFonts: boolean\n    images: string\n    fontManifest?: FontManifest\n    optimizeImages: boolean\n    disableOptimizedLoading?: boolean\n    optimizeCss: any\n    locale?: string\n    locales?: string[]\n    defaultLocale?: string\n    domainLocales?: DomainLocale[]\n    distDir: string\n    concurrentFeatures?: boolean\n    serverComponents?: boolean\n    crossOrigin?: string\n    supportsDynamicHTML?: boolean\n    serverComponentManifest?: any\n    renderServerComponentData?: boolean\n    serverComponentProps?: any\n  }\n  private incrementalCache: IncrementalCache\n  private responseCache: ResponseCache\n  protected router: Router\n  protected dynamicRoutes?: DynamicRoutes\n  protected customRoutes: CustomRoutes\n  protected middlewareManifest?: MiddlewareManifest\n  protected middleware?: RoutingItem[]\n  public readonly hostname?: string\n  public readonly port?: number\n\n  protected abstract getPublicDir(): string\n  protected abstract getHasStaticDir(): boolean\n  protected abstract getPagesManifest(): PagesManifest | undefined\n  protected abstract getBuildId(): string\n  protected abstract generatePublicRoutes(): Route[]\n  protected abstract generateImageRoutes(): Route[]\n  protected abstract generateStaticRoutes(): Route[]\n  protected abstract generateFsStaticRoutes(): Route[]\n  protected abstract generateCatchAllMiddlewareRoute(): Route | undefined\n  protected abstract generateRewrites({\n    restrictedRedirectPaths,\n  }: {\n    restrictedRedirectPaths: string[]\n  }): {\n    beforeFiles: Route[]\n    afterFiles: Route[]\n    fallback: Route[]\n  }\n  protected abstract getFilesystemPaths(): Set<string>\n  protected abstract getMiddleware(): {\n    match: (pathname: string | null | undefined) =>\n      | false\n      | {\n          [paramName: string]: string | string[]\n        }\n    page: string\n  }[]\n  protected abstract findPageComponents(\n    pathname: string,\n    query?: NextParsedUrlQuery,\n    params?: Params | null\n  ): Promise<FindComponentsResult | null>\n  protected abstract hasMiddleware(\n    pathname: string,\n    _isSSR?: boolean\n  ): Promise<boolean>\n  protected abstract getPagePath(pathname: string, locales?: string[]): string\n  protected abstract getFontManifest(): FontManifest | undefined\n  protected abstract getMiddlewareManifest(): MiddlewareManifest | undefined\n  protected abstract getRoutesManifest(): CustomRoutes\n  protected abstract getPrerenderManifest(): PrerenderManifest\n\n  protected abstract sendRenderResult(\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    options: {\n      result: RenderResult\n      type: 'html' | 'json'\n      generateEtags: boolean\n      poweredByHeader: boolean\n      options?: PayloadOptions\n    }\n  ): Promise<void>\n\n  protected abstract runApi(\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    query: ParsedUrlQuery,\n    params: Params | boolean,\n    page: string,\n    builtPagePath: string\n  ): Promise<boolean>\n\n  protected abstract renderHTML(\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    pathname: string,\n    query: NextParsedUrlQuery,\n    renderOpts: RenderOpts\n  ): Promise<RenderResult | null>\n\n  protected abstract handleCompression(\n    req: BaseNextRequest,\n    res: BaseNextResponse\n  ): void\n\n  protected abstract loadEnvConfig(params: { dev: boolean }): void\n\n  public constructor({\n    dir = '.',\n    quiet = false,\n    conf,\n    dev = false,\n    minimalMode = false,\n    customServer = true,\n    hostname,\n    port,\n  }: Options) {\n    this.dir = resolve(dir)\n    this.quiet = quiet\n    this.loadEnvConfig({ dev })\n\n    // TODO: should conf be normalized to prevent missing\n    // values from causing issues as this can be user provided\n    this.nextConfig = conf as NextConfigComplete\n    this.hostname = hostname\n    this.port = port\n    this.distDir = join(this.dir, this.nextConfig.distDir)\n    this.publicDir = this.getPublicDir()\n    this.hasStaticDir = !minimalMode && this.getHasStaticDir()\n\n    // Only serverRuntimeConfig needs the default\n    // publicRuntimeConfig gets it's default in client/index.js\n    const {\n      serverRuntimeConfig = {},\n      publicRuntimeConfig,\n      assetPrefix,\n      generateEtags,\n    } = this.nextConfig\n\n    this.buildId = this.getBuildId()\n    this.minimalMode = minimalMode\n\n    this.renderOpts = {\n      poweredByHeader: this.nextConfig.poweredByHeader,\n      canonicalBase: this.nextConfig.amp.canonicalBase || '',\n      buildId: this.buildId,\n      generateEtags,\n      previewProps: this.getPreviewProps(),\n      customServer: customServer === true ? true : undefined,\n      ampOptimizerConfig: this.nextConfig.experimental.amp?.optimizer,\n      basePath: this.nextConfig.basePath,\n      images: JSON.stringify(this.nextConfig.images),\n      optimizeFonts: !!this.nextConfig.optimizeFonts && !dev,\n      fontManifest:\n        this.nextConfig.optimizeFonts && !dev\n          ? this.getFontManifest()\n          : undefined,\n      optimizeImages: !!this.nextConfig.experimental.optimizeImages,\n      optimizeCss: this.nextConfig.experimental.optimizeCss,\n      disableOptimizedLoading:\n        this.nextConfig.experimental.disableOptimizedLoading,\n      domainLocales: this.nextConfig.i18n?.domains,\n      distDir: this.distDir,\n      concurrentFeatures: this.nextConfig.experimental.concurrentFeatures,\n      serverComponents: this.nextConfig.experimental.serverComponents,\n      crossOrigin: this.nextConfig.crossOrigin\n        ? this.nextConfig.crossOrigin\n        : undefined,\n    }\n\n    // Only the `publicRuntimeConfig` key is exposed to the client side\n    // It'll be rendered as part of __NEXT_DATA__ on the client side\n    if (Object.keys(publicRuntimeConfig).length > 0) {\n      this.renderOpts.runtimeConfig = publicRuntimeConfig\n    }\n\n    // Initialize next/config with the environment configuration\n    envConfig.setConfig({\n      serverRuntimeConfig,\n      publicRuntimeConfig,\n    })\n\n    this.pagesManifest = this.getPagesManifest()\n    this.middlewareManifest = this.getMiddlewareManifest()\n\n    this.customRoutes = this.getCustomRoutes()\n    this.router = new Router(this.generateRoutes())\n    this.setAssetPrefix(assetPrefix)\n\n    this.incrementalCache = new IncrementalCache({\n      fs: this.getCacheFilesystem(),\n      dev,\n      distDir: this.distDir,\n      pagesDir: join(\n        this.distDir,\n        this._isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n        'pages'\n      ),\n      locales: this.nextConfig.i18n?.locales,\n      max: this.nextConfig.experimental.isrMemoryCacheSize,\n      flushToDisk: !minimalMode && this.nextConfig.experimental.isrFlushToDisk,\n      getPrerenderManifest: () => {\n        if (dev) {\n          return {\n            version: -1 as any, // letting us know this doesn't conform to spec\n            routes: {},\n            dynamicRoutes: {},\n            notFoundRoutes: [],\n            preview: null as any, // `preview` is special case read in next-dev-server\n          }\n        } else {\n          return this.getPrerenderManifest()\n        }\n      },\n    })\n    this.responseCache = new ResponseCache(this.incrementalCache)\n  }\n\n  public logError(err: Error): void {\n    if (this.quiet) return\n    console.error(err)\n  }\n\n  private async handleRequest(\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    parsedUrl?: NextUrlWithParsedQuery\n  ): Promise<void> {\n    try {\n      const urlParts = (req.url || '').split('?')\n      const urlNoQuery = urlParts[0]\n\n      if (urlNoQuery?.match(/(\\\\|\\/\\/)/)) {\n        const cleanUrl = normalizeRepeatedSlashes(req.url!)\n        res.redirect(cleanUrl, 308).body(cleanUrl).send()\n        return\n      }\n\n      setLazyProp({ req: req as any }, 'cookies', getCookieParser(req.headers))\n\n      // Parse url if parsedUrl not provided\n      if (!parsedUrl || typeof parsedUrl !== 'object') {\n        parsedUrl = parseUrl(req.url!, true)\n      }\n\n      // Parse the querystring ourselves if the user doesn't handle querystring parsing\n      if (typeof parsedUrl.query === 'string') {\n        parsedUrl.query = parseQs(parsedUrl.query)\n      }\n\n      // When there are hostname and port we build an absolute URL\n      const initUrl =\n        this.hostname && this.port\n          ? `http://${this.hostname}:${this.port}${req.url}`\n          : req.url\n\n      addRequestMeta(req, '__NEXT_INIT_URL', initUrl)\n      addRequestMeta(req, '__NEXT_INIT_QUERY', { ...parsedUrl.query })\n\n      const url = parseNextUrl({\n        headers: req.headers,\n        nextConfig: this.nextConfig,\n        url: req.url?.replace(/^\\/+/, '/'),\n      })\n\n      if (url.basePath) {\n        req.url = replaceBasePath(req.url!, this.nextConfig.basePath)\n        addRequestMeta(req, '_nextHadBasePath', true)\n      }\n\n      if (\n        this.minimalMode &&\n        req.headers['x-matched-path'] &&\n        typeof req.headers['x-matched-path'] === 'string'\n      ) {\n        const reqUrlIsDataUrl = req.url?.includes('/_next/data')\n        const matchedPathIsDataUrl =\n          req.headers['x-matched-path']?.includes('/_next/data')\n        const isDataUrl = reqUrlIsDataUrl || matchedPathIsDataUrl\n\n        let parsedPath = parseUrl(\n          isDataUrl ? req.url! : (req.headers['x-matched-path'] as string),\n          true\n        )\n\n        let matchedPathname = parsedPath.pathname!\n\n        let matchedPathnameNoExt = isDataUrl\n          ? matchedPathname.replace(/\\.json$/, '')\n          : matchedPathname\n\n        if (this.nextConfig.i18n) {\n          const localePathResult = normalizeLocalePath(\n            matchedPathname || '/',\n            this.nextConfig.i18n.locales\n          )\n\n          if (localePathResult.detectedLocale) {\n            parsedUrl.query.__nextLocale = localePathResult.detectedLocale\n          }\n        }\n\n        if (isDataUrl) {\n          matchedPathname = denormalizePagePath(matchedPathname)\n          matchedPathnameNoExt = denormalizePagePath(matchedPathnameNoExt)\n        }\n\n        const pageIsDynamic = isDynamicRoute(matchedPathnameNoExt)\n        const combinedRewrites: Rewrite[] = []\n\n        combinedRewrites.push(...this.customRoutes.rewrites.beforeFiles)\n        combinedRewrites.push(...this.customRoutes.rewrites.afterFiles)\n        combinedRewrites.push(...this.customRoutes.rewrites.fallback)\n\n        const utils = getUtils({\n          pageIsDynamic,\n          page: matchedPathnameNoExt,\n          i18n: this.nextConfig.i18n,\n          basePath: this.nextConfig.basePath,\n          rewrites: combinedRewrites,\n        })\n\n        try {\n          // ensure parsedUrl.pathname includes URL before processing\n          // rewrites or they won't match correctly\n          if (this.nextConfig.i18n && !url.locale?.path.detectedLocale) {\n            parsedUrl.pathname = `/${url.locale?.locale}${parsedUrl.pathname}`\n          }\n          utils.handleRewrites(req, parsedUrl)\n\n          // interpolate dynamic params and normalize URL if needed\n          if (pageIsDynamic) {\n            let params: ParsedUrlQuery | false = {}\n\n            Object.assign(parsedUrl.query, parsedPath.query)\n            const paramsResult = utils.normalizeDynamicRouteParams(\n              parsedUrl.query\n            )\n\n            if (paramsResult.hasValidParams) {\n              params = paramsResult.params\n            } else if (req.headers['x-now-route-matches']) {\n              const opts: Record<string, string> = {}\n              params = utils.getParamsFromRouteMatches(\n                req,\n                opts,\n                parsedUrl.query.__nextLocale || ''\n              )\n\n              if (opts.locale) {\n                parsedUrl.query.__nextLocale = opts.locale\n              }\n            } else {\n              params = utils.dynamicRouteMatcher!(matchedPathnameNoExt)\n            }\n\n            if (params) {\n              if (!paramsResult.hasValidParams) {\n                params = utils.normalizeDynamicRouteParams(params).params\n              }\n\n              matchedPathname = utils.interpolateDynamicPath(\n                matchedPathname,\n                params\n              )\n              req.url = utils.interpolateDynamicPath(req.url!, params)\n            }\n\n            if (reqUrlIsDataUrl && matchedPathIsDataUrl) {\n              req.url = formatUrl({\n                ...parsedPath,\n                pathname: matchedPathname,\n              })\n            }\n\n            Object.assign(parsedUrl.query, params)\n            utils.normalizeVercelUrl(req, true)\n          }\n        } catch (err) {\n          if (err instanceof DecodeError) {\n            res.statusCode = 400\n            return this.renderError(null, req, res, '/_error', {})\n          }\n          throw err\n        }\n\n        parsedUrl.pathname = `${this.nextConfig.basePath || ''}${\n          matchedPathname === '/' && this.nextConfig.basePath\n            ? ''\n            : matchedPathname\n        }`\n        url.pathname = parsedUrl.pathname\n      }\n\n      addRequestMeta(req, '__nextHadTrailingSlash', url.locale?.trailingSlash)\n      if (url.locale?.domain) {\n        addRequestMeta(req, '__nextIsLocaleDomain', true)\n      }\n\n      if (url.locale?.path.detectedLocale) {\n        req.url = formatUrl(url)\n        addRequestMeta(req, '__nextStrippedLocale', true)\n        if (url.pathname === '/api' || url.pathname.startsWith('/api/')) {\n          return this.render404(req, res, parsedUrl)\n        }\n      }\n\n      if (!this.minimalMode || !parsedUrl.query.__nextLocale) {\n        if (url?.locale?.locale) {\n          parsedUrl.query.__nextLocale = url.locale.locale\n        }\n      }\n\n      if (url?.locale?.defaultLocale) {\n        parsedUrl.query.__nextDefaultLocale = url.locale.defaultLocale\n      }\n\n      if (url.locale?.redirect) {\n        res\n          .redirect(url.locale.redirect, TEMPORARY_REDIRECT_STATUS)\n          .body(url.locale.redirect)\n          .send()\n        return\n      }\n\n      res.statusCode = 200\n      return await this.run(req, res, parsedUrl)\n    } catch (err: any) {\n      if (\n        (err && typeof err === 'object' && err.code === 'ERR_INVALID_URL') ||\n        err instanceof DecodeError\n      ) {\n        res.statusCode = 400\n        return this.renderError(null, req, res, '/_error', {})\n      }\n\n      if (this.minimalMode || this.renderOpts.dev) {\n        throw err\n      }\n      this.logError(getProperError(err))\n      res.statusCode = 500\n      res.body('Internal Server Error').send()\n    }\n  }\n\n  public getRequestHandler(): BaseRequestHandler {\n    return this.handleRequest.bind(this)\n  }\n\n  public setAssetPrefix(prefix?: string): void {\n    this.renderOpts.assetPrefix = prefix ? prefix.replace(/\\/$/, '') : ''\n  }\n\n  // Backwards compatibility\n  public async prepare(): Promise<void> {}\n\n  // Backwards compatibility\n  protected async close(): Promise<void> {}\n\n  protected getCustomRoutes(): CustomRoutes {\n    const customRoutes = this.getRoutesManifest()\n    let rewrites: CustomRoutes['rewrites']\n\n    // rewrites can be stored as an array when an array is\n    // returned in next.config.js so massage them into\n    // the expected object format\n    if (Array.isArray(customRoutes.rewrites)) {\n      rewrites = {\n        beforeFiles: [],\n        afterFiles: customRoutes.rewrites,\n        fallback: [],\n      }\n    } else {\n      rewrites = customRoutes.rewrites\n    }\n    return Object.assign(customRoutes, { rewrites })\n  }\n\n  protected getPreviewProps(): __ApiPreviewProps {\n    return this.getPrerenderManifest().preview\n  }\n\n  protected async ensureMiddleware(_pathname: string, _isSSR?: boolean) {}\n\n  protected generateRoutes(): {\n    basePath: string\n    headers: Route[]\n    rewrites: {\n      beforeFiles: Route[]\n      afterFiles: Route[]\n      fallback: Route[]\n    }\n    fsRoutes: Route[]\n    redirects: Route[]\n    catchAllRoute: Route\n    catchAllMiddleware?: Route\n    pageChecker: PageChecker\n    useFileSystemPublicRoutes: boolean\n    dynamicRoutes: DynamicRoutes | undefined\n    locales: string[]\n  } {\n    const publicRoutes = this.generatePublicRoutes()\n    const imageRoutes = this.generateImageRoutes()\n    const staticFilesRoutes = this.generateStaticRoutes()\n\n    const fsRoutes: Route[] = [\n      ...this.generateFsStaticRoutes(),\n      {\n        match: route('/_next/data/:path*'),\n        type: 'route',\n        name: '_next/data catchall',\n        fn: async (req, res, params, _parsedUrl) => {\n          // Make sure to 404 for /_next/data/ itself and\n          // we also want to 404 if the buildId isn't correct\n          if (!params.path || params.path[0] !== this.buildId) {\n            await this.render404(req, res, _parsedUrl)\n            return {\n              finished: true,\n            }\n          }\n          // remove buildId from URL\n          params.path.shift()\n\n          const lastParam = params.path[params.path.length - 1]\n\n          // show 404 if it doesn't end with .json\n          if (typeof lastParam !== 'string' || !lastParam.endsWith('.json')) {\n            await this.render404(req, res, _parsedUrl)\n            return {\n              finished: true,\n            }\n          }\n\n          // re-create page's pathname\n          let pathname = `/${params.path.join('/')}`\n          pathname = getRouteFromAssetPath(pathname, '.json')\n\n          if (this.nextConfig.i18n) {\n            const { host } = req?.headers || {}\n            // remove port from host and remove port if present\n            const hostname = host?.split(':')[0].toLowerCase()\n            const localePathResult = normalizeLocalePath(\n              pathname,\n              this.nextConfig.i18n.locales\n            )\n            const { defaultLocale } =\n              detectDomainLocale(this.nextConfig.i18n.domains, hostname) || {}\n\n            let detectedLocale = ''\n\n            if (localePathResult.detectedLocale) {\n              pathname = localePathResult.pathname\n              detectedLocale = localePathResult.detectedLocale\n            }\n\n            _parsedUrl.query.__nextLocale = detectedLocale\n            _parsedUrl.query.__nextDefaultLocale =\n              defaultLocale || this.nextConfig.i18n.defaultLocale\n\n            if (!detectedLocale) {\n              _parsedUrl.query.__nextLocale =\n                _parsedUrl.query.__nextDefaultLocale\n              await this.render404(req, res, _parsedUrl)\n              return { finished: true }\n            }\n          }\n\n          const parsedUrl = parseUrl(pathname, true)\n\n          await this.render(\n            req,\n            res,\n            pathname,\n            { ..._parsedUrl.query, _nextDataReq: '1' },\n            parsedUrl,\n            true\n          )\n          return {\n            finished: true,\n          }\n        },\n      },\n      ...imageRoutes,\n      {\n        match: route('/_next/:path*'),\n        type: 'route',\n        name: '_next catchall',\n        // This path is needed because `render()` does a check for `/_next` and the calls the routing again\n        fn: async (req, res, _params, parsedUrl) => {\n          await this.render404(req, res, parsedUrl)\n          return {\n            finished: true,\n          }\n        },\n      },\n      ...publicRoutes,\n      ...staticFilesRoutes,\n    ]\n\n    const restrictedRedirectPaths = this.nextConfig.basePath\n      ? [`${this.nextConfig.basePath}/_next`]\n      : ['/_next']\n\n    // Headers come very first\n    const headers = this.minimalMode\n      ? []\n      : this.customRoutes.headers.map((rule) =>\n          createHeaderRoute({ rule, restrictedRedirectPaths })\n        )\n\n    const redirects = this.minimalMode\n      ? []\n      : this.customRoutes.redirects.map((rule) =>\n          createRedirectRoute({ rule, restrictedRedirectPaths })\n        )\n\n    const rewrites = this.generateRewrites({ restrictedRedirectPaths })\n    const catchAllMiddleware = this.generateCatchAllMiddlewareRoute()\n\n    const catchAllRoute: Route = {\n      match: route('/:path*'),\n      type: 'route',\n      name: 'Catchall render',\n      fn: async (req, res, _params, parsedUrl) => {\n        let { pathname, query } = parsedUrl\n        if (!pathname) {\n          throw new Error('pathname is undefined')\n        }\n\n        // next.js core assumes page path without trailing slash\n        pathname = removePathTrailingSlash(pathname)\n\n        if (this.nextConfig.i18n) {\n          const localePathResult = normalizeLocalePath(\n            pathname,\n            this.nextConfig.i18n?.locales\n          )\n\n          if (localePathResult.detectedLocale) {\n            pathname = localePathResult.pathname\n            parsedUrl.query.__nextLocale = localePathResult.detectedLocale\n          }\n        }\n        const bubbleNoFallback = !!query._nextBubbleNoFallback\n\n        if (pathname.match(MIDDLEWARE_ROUTE)) {\n          await this.render404(req, res, parsedUrl)\n          return {\n            finished: true,\n          }\n        }\n\n        if (pathname === '/api' || pathname.startsWith('/api/')) {\n          delete query._nextBubbleNoFallback\n\n          const handled = await this.handleApiRequest(req, res, pathname, query)\n          if (handled) {\n            return { finished: true }\n          }\n        }\n\n        try {\n          await this.render(req, res, pathname, query, parsedUrl, true)\n\n          return {\n            finished: true,\n          }\n        } catch (err) {\n          if (err instanceof NoFallbackError && bubbleNoFallback) {\n            return {\n              finished: false,\n            }\n          }\n          throw err\n        }\n      },\n    }\n\n    const { useFileSystemPublicRoutes } = this.nextConfig\n\n    if (useFileSystemPublicRoutes) {\n      this.dynamicRoutes = this.getDynamicRoutes()\n      if (!this.minimalMode) {\n        this.middleware = this.getMiddleware()\n      }\n    }\n\n    return {\n      headers,\n      fsRoutes,\n      rewrites,\n      redirects,\n      catchAllRoute,\n      catchAllMiddleware,\n      useFileSystemPublicRoutes,\n      dynamicRoutes: this.dynamicRoutes,\n      basePath: this.nextConfig.basePath,\n      pageChecker: this.hasPage.bind(this),\n      locales: this.nextConfig.i18n?.locales || [],\n    }\n  }\n\n  protected async hasPage(pathname: string): Promise<boolean> {\n    let found = false\n    try {\n      found = !!this.getPagePath(pathname, this.nextConfig.i18n?.locales)\n    } catch (_) {}\n\n    return found\n  }\n\n  protected async _beforeCatchAllRender(\n    _req: BaseNextRequest,\n    _res: BaseNextResponse,\n    _params: Params,\n    _parsedUrl: UrlWithParsedQuery\n  ): Promise<boolean> {\n    return false\n  }\n\n  // Used to build API page in development\n  protected async ensureApiPage(_pathname: string): Promise<void> {}\n\n  /**\n   * Resolves `API` request, in development builds on demand\n   * @param req http request\n   * @param res http response\n   * @param pathname path of request\n   */\n  private async handleApiRequest(\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    pathname: string,\n    query: ParsedUrlQuery\n  ): Promise<boolean> {\n    let page = pathname\n    let params: Params | false = false\n    let pageFound = !isDynamicRoute(page) && (await this.hasPage(page))\n\n    if (!pageFound && this.dynamicRoutes) {\n      for (const dynamicRoute of this.dynamicRoutes) {\n        params = dynamicRoute.match(pathname)\n        if (dynamicRoute.page.startsWith('/api') && params) {\n          page = dynamicRoute.page\n          pageFound = true\n          break\n        }\n      }\n    }\n\n    if (!pageFound) {\n      return false\n    }\n    // Make sure the page is built before getting the path\n    // or else it won't be in the manifest yet\n    await this.ensureApiPage(page)\n\n    let builtPagePath\n    try {\n      builtPagePath = this.getPagePath(page)\n    } catch (err) {\n      if (isError(err) && err.code === 'ENOENT') {\n        return false\n      }\n      throw err\n    }\n\n    return this.runApi(req, res, query, params, page, builtPagePath)\n  }\n\n  protected getDynamicRoutes(): Array<RoutingItem> {\n    const addedPages = new Set<string>()\n\n    return getSortedRoutes(\n      Object.keys(this.pagesManifest!).map(\n        (page) =>\n          normalizeLocalePath(page, this.nextConfig.i18n?.locales).pathname\n      )\n    )\n      .map((page) => {\n        if (addedPages.has(page) || !isDynamicRoute(page)) return null\n        addedPages.add(page)\n        return {\n          page,\n          match: getRouteMatcher(getRouteRegex(page)),\n        }\n      })\n      .filter((item): item is RoutingItem => Boolean(item))\n  }\n\n  protected async run(\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    parsedUrl: UrlWithParsedQuery\n  ): Promise<void> {\n    this.handleCompression(req, res)\n\n    try {\n      const matched = await this.router.execute(req, res, parsedUrl)\n      if (matched) {\n        return\n      }\n    } catch (err) {\n      if (err instanceof DecodeError) {\n        res.statusCode = 400\n        return this.renderError(null, req, res, '/_error', {})\n      }\n      throw err\n    }\n\n    await this.render404(req, res, parsedUrl)\n  }\n\n  private async pipe(\n    fn: (ctx: RequestContext) => Promise<ResponsePayload | null>,\n    partialContext: {\n      req: BaseNextRequest\n      res: BaseNextResponse\n      pathname: string\n      query: NextParsedUrlQuery\n    }\n  ): Promise<void> {\n    const userAgent = partialContext.req.headers['user-agent']\n    const ctx = {\n      ...partialContext,\n      renderOpts: {\n        ...this.renderOpts,\n        supportsDynamicHTML: userAgent ? !isBot(userAgent) : false,\n      },\n    } as const\n    const payload = await fn(ctx)\n    if (payload === null) {\n      return\n    }\n    const { req, res } = ctx\n    const { body, type, revalidateOptions } = payload\n    if (!res.sent) {\n      const { generateEtags, poweredByHeader, dev } = this.renderOpts\n      if (dev) {\n        // In dev, we should not cache pages for any reason.\n        res.setHeader('Cache-Control', 'no-store, must-revalidate')\n      }\n      return this.sendRenderResult(req, res, {\n        result: body,\n        type,\n        generateEtags,\n        poweredByHeader,\n        options: revalidateOptions,\n      })\n    }\n  }\n\n  private async getStaticHTML(\n    fn: (ctx: RequestContext) => Promise<ResponsePayload | null>,\n    partialContext: {\n      req: BaseNextRequest\n      res: BaseNextResponse\n      pathname: string\n      query: ParsedUrlQuery\n    }\n  ): Promise<string | null> {\n    const payload = await fn({\n      ...partialContext,\n      renderOpts: {\n        ...this.renderOpts,\n        supportsDynamicHTML: false,\n      },\n    })\n    if (payload === null) {\n      return null\n    }\n    return payload.body.toUnchunkedString()\n  }\n\n  public async render(\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    pathname: string,\n    query: NextParsedUrlQuery = {},\n    parsedUrl?: NextUrlWithParsedQuery,\n    internalRender = false\n  ): Promise<void> {\n    if (!pathname.startsWith('/')) {\n      console.warn(\n        `Cannot render page with path \"${pathname}\", did you mean \"/${pathname}\"?. See more info here: https://nextjs.org/docs/messages/render-no-starting-slash`\n      )\n    }\n\n    if (\n      this.renderOpts.customServer &&\n      pathname === '/index' &&\n      !(await this.hasPage('/index'))\n    ) {\n      // maintain backwards compatibility for custom server\n      // (see custom-server integration tests)\n      pathname = '/'\n    }\n\n    // we allow custom servers to call render for all URLs\n    // so check if we need to serve a static _next file or not.\n    // we don't modify the URL for _next/data request but still\n    // call render so we special case this to prevent an infinite loop\n    if (\n      !internalRender &&\n      !this.minimalMode &&\n      !query._nextDataReq &&\n      (req.url?.match(/^\\/_next\\//) ||\n        (this.hasStaticDir && req.url!.match(/^\\/static\\//)))\n    ) {\n      return this.handleRequest(req, res, parsedUrl)\n    }\n\n    // Custom server users can run `app.render()` which needs compression.\n    if (this.renderOpts.customServer) {\n      this.handleCompression(req, res)\n    }\n\n    if (isBlockedPage(pathname)) {\n      return this.render404(req, res, parsedUrl)\n    }\n\n    return this.pipe((ctx) => this.renderToResponse(ctx), {\n      req,\n      res,\n      pathname,\n      query,\n    })\n  }\n\n  protected async getStaticPaths(pathname: string): Promise<{\n    staticPaths: string[] | undefined\n    fallbackMode: 'static' | 'blocking' | false\n  }> {\n    // `staticPaths` is intentionally set to `undefined` as it should've\n    // been caught when checking disk data.\n    const staticPaths = undefined\n\n    // Read whether or not fallback should exist from the manifest.\n    const fallbackField =\n      this.getPrerenderManifest().dynamicRoutes[pathname].fallback\n\n    return {\n      staticPaths,\n      fallbackMode:\n        typeof fallbackField === 'string'\n          ? 'static'\n          : fallbackField === null\n          ? 'blocking'\n          : false,\n    }\n  }\n\n  private async renderToResponseWithComponents(\n    { req, res, pathname, renderOpts: opts }: RequestContext,\n    { components, query }: FindComponentsResult\n  ): Promise<ResponsePayload | null> {\n    const is404Page = pathname === '/404'\n    const is500Page = pathname === '/500'\n\n    const isLikeServerless =\n      typeof components.ComponentMod === 'object' &&\n      typeof (components.ComponentMod as any).renderReqToHTML === 'function'\n    const isSSG = !!components.getStaticProps\n    const hasServerProps = !!components.getServerSideProps\n    const hasStaticPaths = !!components.getStaticPaths\n    const hasGetInitialProps = !!(components.Component as any).getInitialProps\n\n    // Toggle whether or not this is a Data request\n    const isDataReq = !!query._nextDataReq && (isSSG || hasServerProps)\n    delete query._nextDataReq\n\n    // we need to ensure the status code if /404 is visited directly\n    if (is404Page && !isDataReq) {\n      res.statusCode = 404\n    }\n\n    // ensure correct status is set when visiting a status page\n    // directly e.g. /500\n    if (STATIC_STATUS_PAGES.includes(pathname)) {\n      res.statusCode = parseInt(pathname.substr(1), 10)\n    }\n\n    // handle static page\n    if (typeof components.Component === 'string') {\n      return {\n        type: 'html',\n        // TODO: Static pages should be serialized as RenderResult\n        body: RenderResult.fromStatic(components.Component),\n      }\n    }\n\n    if (!query.amp) {\n      delete query.amp\n    }\n\n    if (opts.supportsDynamicHTML === true) {\n      // Disable dynamic HTML in cases that we know it won't be generated,\n      // so that we can continue generating a cache key when possible.\n      opts.supportsDynamicHTML =\n        !isSSG &&\n        !isLikeServerless &&\n        !query.amp &&\n        !this.minimalMode &&\n        typeof components.Document?.getInitialProps !== 'function'\n    }\n\n    const defaultLocale = isSSG\n      ? this.nextConfig.i18n?.defaultLocale\n      : query.__nextDefaultLocale\n\n    const locale = query.__nextLocale\n    const locales = this.nextConfig.i18n?.locales\n\n    let previewData: PreviewData\n    let isPreviewMode = false\n\n    if (hasServerProps || isSSG) {\n      previewData = tryGetPreviewData(req, res, this.renderOpts.previewProps)\n      isPreviewMode = previewData !== false\n    }\n\n    // Compute the iSSG cache key. We use the rewroteUrl since\n    // pages with fallback: false are allowed to be rewritten to\n    // and we need to look up the path by the rewritten path\n    let urlPathname = parseUrl(req.url || '').pathname || '/'\n\n    let resolvedUrlPathname =\n      getRequestMeta(req, '_nextRewroteUrl') || urlPathname\n\n    urlPathname = removePathTrailingSlash(urlPathname)\n    resolvedUrlPathname = normalizeLocalePath(\n      removePathTrailingSlash(resolvedUrlPathname),\n      this.nextConfig.i18n?.locales\n    ).pathname\n\n    const stripNextDataPath = (path: string) => {\n      if (path.includes(this.buildId)) {\n        const splitPath = path.substring(\n          path.indexOf(this.buildId) + this.buildId.length\n        )\n\n        path = denormalizePagePath(splitPath.replace(/\\.json$/, ''))\n      }\n\n      if (this.nextConfig.i18n) {\n        return normalizeLocalePath(path, locales).pathname\n      }\n      return path\n    }\n\n    const handleRedirect = (pageData: any) => {\n      const redirect = {\n        destination: pageData.pageProps.__N_REDIRECT,\n        statusCode: pageData.pageProps.__N_REDIRECT_STATUS,\n        basePath: pageData.pageProps.__N_REDIRECT_BASE_PATH,\n      }\n      const statusCode = getRedirectStatus(redirect)\n      const { basePath } = this.nextConfig\n\n      if (\n        basePath &&\n        redirect.basePath !== false &&\n        redirect.destination.startsWith('/')\n      ) {\n        redirect.destination = `${basePath}${redirect.destination}`\n      }\n\n      if (redirect.destination.startsWith('/')) {\n        redirect.destination = normalizeRepeatedSlashes(redirect.destination)\n      }\n\n      res\n        .redirect(redirect.destination, statusCode)\n        .body(redirect.destination)\n        .send()\n    }\n\n    // remove /_next/data prefix from urlPathname so it matches\n    // for direct page visit and /_next/data visit\n    if (isDataReq) {\n      resolvedUrlPathname = stripNextDataPath(resolvedUrlPathname)\n      urlPathname = stripNextDataPath(urlPathname)\n    }\n\n    let ssgCacheKey =\n      isPreviewMode || !isSSG || this.minimalMode || opts.supportsDynamicHTML\n        ? null // Preview mode bypasses the cache\n        : `${locale ? `/${locale}` : ''}${\n            (pathname === '/' || resolvedUrlPathname === '/') && locale\n              ? ''\n              : resolvedUrlPathname\n          }${query.amp ? '.amp' : ''}`\n\n    if ((is404Page || is500Page) && isSSG) {\n      ssgCacheKey = `${locale ? `/${locale}` : ''}${pathname}${\n        query.amp ? '.amp' : ''\n      }`\n    }\n\n    if (ssgCacheKey) {\n      // we only encode path delimiters for path segments from\n      // getStaticPaths so we need to attempt decoding the URL\n      // to match against and only escape the path delimiters\n      // this allows non-ascii values to be handled e.g. Japanese characters\n\n      // TODO: investigate adding this handling for non-SSG pages so\n      // non-ascii names work there also\n      ssgCacheKey = ssgCacheKey\n        .split('/')\n        .map((seg) => {\n          try {\n            seg = escapePathDelimiters(decodeURIComponent(seg), true)\n          } catch (_) {\n            // An improperly encoded URL was provided\n            throw new DecodeError('failed to decode param')\n          }\n          return seg\n        })\n        .join('/')\n    }\n\n    const doRender: () => Promise<ResponseCacheEntry | null> = async () => {\n      let pageData: any\n      let body: RenderResult | null\n      let sprRevalidate: number | false\n      let isNotFound: boolean | undefined\n      let isRedirect: boolean | undefined\n\n      // handle serverless\n      if (isLikeServerless) {\n        const renderResult = await (\n          components.ComponentMod as any\n        ).renderReqToHTML(req, res, 'passthrough', {\n          locale,\n          locales,\n          defaultLocale,\n          optimizeCss: this.renderOpts.optimizeCss,\n          distDir: this.distDir,\n          fontManifest: this.renderOpts.fontManifest,\n          domainLocales: this.renderOpts.domainLocales,\n        })\n\n        body = renderResult.html\n        pageData = renderResult.renderOpts.pageData\n        sprRevalidate = renderResult.renderOpts.revalidate\n        isNotFound = renderResult.renderOpts.isNotFound\n        isRedirect = renderResult.renderOpts.isRedirect\n      } else {\n        const origQuery = parseUrl(req.url || '', true).query\n        const hadTrailingSlash =\n          urlPathname !== '/' && this.nextConfig.trailingSlash\n\n        const resolvedUrl = formatUrl({\n          pathname: `${resolvedUrlPathname}${hadTrailingSlash ? '/' : ''}`,\n          // make sure to only add query values from original URL\n          query: origQuery,\n        })\n\n        const renderOpts: RenderOpts = {\n          ...components,\n          ...opts,\n          isDataReq,\n          resolvedUrl,\n          locale,\n          locales,\n          defaultLocale,\n          // For getServerSideProps and getInitialProps we need to ensure we use the original URL\n          // and not the resolved URL to prevent a hydration mismatch on\n          // asPath\n          resolvedAsPath:\n            hasServerProps || hasGetInitialProps\n              ? formatUrl({\n                  // we use the original URL pathname less the _next/data prefix if\n                  // present\n                  pathname: `${urlPathname}${hadTrailingSlash ? '/' : ''}`,\n                  query: origQuery,\n                })\n              : resolvedUrl,\n        }\n\n        const renderResult = await this.renderHTML(\n          req,\n          res,\n          pathname,\n          query,\n          renderOpts\n        )\n\n        body = renderResult\n        // TODO: change this to a different passing mechanism\n        pageData = (renderOpts as any).pageData\n        sprRevalidate = (renderOpts as any).revalidate\n        isNotFound = (renderOpts as any).isNotFound\n        isRedirect = (renderOpts as any).isRedirect\n      }\n\n      let value: ResponseCacheValue | null\n      if (isNotFound) {\n        value = null\n      } else if (isRedirect) {\n        value = { kind: 'REDIRECT', props: pageData }\n      } else {\n        if (!body) {\n          return null\n        }\n        value = { kind: 'PAGE', html: body, pageData }\n      }\n      return { revalidate: sprRevalidate, value }\n    }\n\n    const cacheEntry = await this.responseCache.get(\n      ssgCacheKey,\n      async (hasResolved) => {\n        const isProduction = !this.renderOpts.dev\n        const isDynamicPathname = isDynamicRoute(pathname)\n        const didRespond = hasResolved || res.sent\n\n        let { staticPaths, fallbackMode } = hasStaticPaths\n          ? await this.getStaticPaths(pathname)\n          : { staticPaths: undefined, fallbackMode: false }\n\n        if (\n          fallbackMode === 'static' &&\n          isBot(req.headers['user-agent'] || '')\n        ) {\n          fallbackMode = 'blocking'\n        }\n\n        // When we did not respond from cache, we need to choose to block on\n        // rendering or return a skeleton.\n        //\n        // * Data requests always block.\n        //\n        // * Blocking mode fallback always blocks.\n        //\n        // * Preview mode toggles all pages to be resolved in a blocking manner.\n        //\n        // * Non-dynamic pages should block (though this is an impossible\n        //   case in production).\n        //\n        // * Dynamic pages should return their skeleton if not defined in\n        //   getStaticPaths, then finish the data request on the client-side.\n        //\n        if (\n          this.minimalMode !== true &&\n          fallbackMode !== 'blocking' &&\n          ssgCacheKey &&\n          !didRespond &&\n          !isPreviewMode &&\n          isDynamicPathname &&\n          // Development should trigger fallback when the path is not in\n          // `getStaticPaths`\n          (isProduction ||\n            !staticPaths ||\n            !staticPaths.includes(\n              // we use ssgCacheKey here as it is normalized to match the\n              // encoding from getStaticPaths along with including the locale\n              query.amp ? ssgCacheKey.replace(/\\.amp$/, '') : ssgCacheKey\n            ))\n        ) {\n          if (\n            // In development, fall through to render to handle missing\n            // getStaticPaths.\n            (isProduction || staticPaths) &&\n            // When fallback isn't present, abort this render so we 404\n            fallbackMode !== 'static'\n          ) {\n            throw new NoFallbackError()\n          }\n\n          if (!isDataReq) {\n            // Production already emitted the fallback as static HTML.\n            if (isProduction) {\n              const html = await this.incrementalCache.getFallback(\n                locale ? `/${locale}${pathname}` : pathname\n              )\n              return {\n                value: {\n                  kind: 'PAGE',\n                  html: RenderResult.fromStatic(html),\n                  pageData: {},\n                },\n              }\n            }\n            // We need to generate the fallback on-demand for development.\n            else {\n              query.__nextFallback = 'true'\n              if (isLikeServerless) {\n                prepareServerlessUrl(req, query)\n              }\n              const result = await doRender()\n              if (!result) {\n                return null\n              }\n              // Prevent caching this result\n              delete result.revalidate\n              return result\n            }\n          }\n        }\n\n        const result = await doRender()\n        if (!result) {\n          return null\n        }\n        return {\n          ...result,\n          revalidate:\n            result.revalidate !== undefined\n              ? result.revalidate\n              : /* default to minimum revalidate (this should be an invariant) */ 1,\n        }\n      }\n    )\n\n    if (!cacheEntry) {\n      if (ssgCacheKey) {\n        // A cache entry might not be generated if a response is written\n        // in `getInitialProps` or `getServerSideProps`, but those shouldn't\n        // have a cache key. If we do have a cache key but we don't end up\n        // with a cache entry, then either Next.js or the application has a\n        // bug that needs fixing.\n        throw new Error('invariant: cache entry required but not generated')\n      }\n      return null\n    }\n\n    const { revalidate, value: cachedData } = cacheEntry\n    const revalidateOptions: any =\n      typeof revalidate !== 'undefined' &&\n      (!this.renderOpts.dev || (hasServerProps && !isDataReq))\n        ? {\n            // When the page is 404 cache-control should not be added unless\n            // we are rendering the 404 page for notFound: true which should\n            // cache according to revalidate correctly\n            private: isPreviewMode || (is404Page && cachedData),\n            stateful: !isSSG,\n            revalidate,\n          }\n        : undefined\n\n    if (!cachedData) {\n      if (revalidateOptions) {\n        setRevalidateHeaders(res, revalidateOptions)\n      }\n      if (isDataReq) {\n        res.statusCode = 404\n        res.body('{\"notFound\":true}').send()\n        return null\n      } else {\n        await this.render404(\n          req,\n          res,\n          {\n            pathname,\n            query,\n          } as UrlWithParsedQuery,\n          false\n        )\n        return null\n      }\n    } else if (cachedData.kind === 'REDIRECT') {\n      if (isDataReq) {\n        return {\n          type: 'json',\n          body: RenderResult.fromStatic(JSON.stringify(cachedData.props)),\n          revalidateOptions,\n        }\n      } else {\n        await handleRedirect(cachedData.props)\n        return null\n      }\n    } else {\n      return {\n        type: isDataReq ? 'json' : 'html',\n        body: isDataReq\n          ? RenderResult.fromStatic(JSON.stringify(cachedData.pageData))\n          : cachedData.html,\n        revalidateOptions,\n      }\n    }\n  }\n\n  private async renderToResponse(\n    ctx: RequestContext\n  ): Promise<ResponsePayload | null> {\n    const { res, query, pathname } = ctx\n    let page = pathname\n    const bubbleNoFallback = !!query._nextBubbleNoFallback\n    delete query._nextBubbleNoFallback\n\n    try {\n      // Ensure a request to the URL /accounts/[id] will be treated as a dynamic\n      // route correctly and not loaded immediately without parsing params.\n      if (!isDynamicRoute(pathname)) {\n        const result = await this.findPageComponents(pathname, query)\n        if (result) {\n          try {\n            return await this.renderToResponseWithComponents(ctx, result)\n          } catch (err) {\n            const isNoFallbackError = err instanceof NoFallbackError\n\n            if (!isNoFallbackError || (isNoFallbackError && bubbleNoFallback)) {\n              throw err\n            }\n          }\n        }\n      }\n\n      if (this.dynamicRoutes) {\n        for (const dynamicRoute of this.dynamicRoutes) {\n          const params = dynamicRoute.match(pathname)\n          if (!params) {\n            continue\n          }\n\n          const dynamicRouteResult = await this.findPageComponents(\n            dynamicRoute.page,\n            query,\n            params\n          )\n          if (dynamicRouteResult) {\n            try {\n              page = dynamicRoute.page\n              return await this.renderToResponseWithComponents(\n                {\n                  ...ctx,\n                  pathname: dynamicRoute.page,\n                  renderOpts: {\n                    ...ctx.renderOpts,\n                    params,\n                  },\n                },\n                dynamicRouteResult\n              )\n            } catch (err) {\n              const isNoFallbackError = err instanceof NoFallbackError\n\n              if (\n                !isNoFallbackError ||\n                (isNoFallbackError && bubbleNoFallback)\n              ) {\n                throw err\n              }\n            }\n          }\n        }\n      }\n    } catch (error) {\n      const err = getProperError(error)\n      if (err instanceof NoFallbackError && bubbleNoFallback) {\n        throw err\n      }\n      if (err instanceof DecodeError) {\n        res.statusCode = 400\n        return await this.renderErrorToResponse(ctx, err)\n      }\n\n      res.statusCode = 500\n      const isWrappedError = err instanceof WrappedBuildError\n      const response = await this.renderErrorToResponse(\n        ctx,\n        isWrappedError ? (err as WrappedBuildError).innerError : err\n      )\n\n      if (!isWrappedError) {\n        if ((this.minimalMode && !process.browser) || this.renderOpts.dev) {\n          if (isError(err)) err.page = page\n          throw err\n        }\n        this.logError(getProperError(err))\n      }\n      return response\n    }\n    res.statusCode = 404\n    return this.renderErrorToResponse(ctx, null)\n  }\n\n  public async renderToHTML(\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    pathname: string,\n    query: ParsedUrlQuery = {}\n  ): Promise<string | null> {\n    return this.getStaticHTML((ctx) => this.renderToResponse(ctx), {\n      req,\n      res,\n      pathname,\n      query,\n    })\n  }\n\n  public async renderError(\n    err: Error | null,\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    pathname: string,\n    query: NextParsedUrlQuery = {},\n    setHeaders = true\n  ): Promise<void> {\n    if (setHeaders) {\n      res.setHeader(\n        'Cache-Control',\n        'no-cache, no-store, max-age=0, must-revalidate'\n      )\n    }\n\n    return this.pipe(\n      async (ctx) => {\n        const response = await this.renderErrorToResponse(ctx, err)\n        if (this.minimalMode && res.statusCode === 500) {\n          throw err\n        }\n        return response\n      },\n      { req, res, pathname, query }\n    )\n  }\n\n  private customErrorNo404Warn = execOnce(() => {\n    Log.warn(\n      `You have added a custom /_error page without a custom /404 page. This prevents the 404 page from being auto statically optimized.\\nSee here for info: https://nextjs.org/docs/messages/custom-error-no-custom-404`\n    )\n  })\n\n  private async renderErrorToResponse(\n    ctx: RequestContext,\n    err: Error | null\n  ): Promise<ResponsePayload | null> {\n    const { res, query } = ctx\n    try {\n      let result: null | FindComponentsResult = null\n\n      const is404 = res.statusCode === 404\n      let using404Page = false\n\n      // use static 404 page if available and is 404 response\n      if (is404) {\n        result = await this.findPageComponents('/404', query)\n        using404Page = result !== null\n      }\n      let statusPage = `/${res.statusCode}`\n\n      if (!result && STATIC_STATUS_PAGES.includes(statusPage)) {\n        result = await this.findPageComponents(statusPage, query)\n      }\n\n      if (!result) {\n        result = await this.findPageComponents('/_error', query)\n        statusPage = '/_error'\n      }\n\n      if (\n        process.env.NODE_ENV !== 'production' &&\n        !using404Page &&\n        (await this.hasPage('/_error')) &&\n        !(await this.hasPage('/404'))\n      ) {\n        this.customErrorNo404Warn()\n      }\n\n      try {\n        return await this.renderToResponseWithComponents(\n          {\n            ...ctx,\n            pathname: statusPage,\n            renderOpts: {\n              ...ctx.renderOpts,\n              err,\n            },\n          },\n          result!\n        )\n      } catch (maybeFallbackError) {\n        if (maybeFallbackError instanceof NoFallbackError) {\n          throw new Error('invariant: failed to render error page')\n        }\n        throw maybeFallbackError\n      }\n    } catch (error) {\n      const renderToHtmlError = getProperError(error)\n      const isWrappedError = renderToHtmlError instanceof WrappedBuildError\n      if (!isWrappedError) {\n        this.logError(renderToHtmlError)\n      }\n      res.statusCode = 500\n      const fallbackComponents = await this.getFallbackErrorComponents()\n\n      if (fallbackComponents) {\n        return this.renderToResponseWithComponents(\n          {\n            ...ctx,\n            pathname: '/_error',\n            renderOpts: {\n              ...ctx.renderOpts,\n              // We render `renderToHtmlError` here because `err` is\n              // already captured in the stacktrace.\n              err: isWrappedError\n                ? renderToHtmlError.innerError\n                : renderToHtmlError,\n            },\n          },\n          {\n            query,\n            components: fallbackComponents,\n          }\n        )\n      }\n      return {\n        type: 'html',\n        body: RenderResult.fromStatic('Internal Server Error'),\n      }\n    }\n  }\n\n  public async renderErrorToHTML(\n    err: Error | null,\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    pathname: string,\n    query: ParsedUrlQuery = {}\n  ): Promise<string | null> {\n    return this.getStaticHTML((ctx) => this.renderErrorToResponse(ctx, err), {\n      req,\n      res,\n      pathname,\n      query,\n    })\n  }\n\n  protected getCacheFilesystem(): CacheFs {\n    return {\n      readFile: () => Promise.resolve(''),\n      readFileSync: () => '',\n      writeFile: () => Promise.resolve(),\n      mkdir: () => Promise.resolve(),\n      stat: () => Promise.resolve({ mtime: new Date() }),\n    }\n  }\n\n  protected async getFallbackErrorComponents(): Promise<LoadComponentsReturnType | null> {\n    // The development server will provide an implementation for this\n    return null\n  }\n\n  public async render404(\n    req: BaseNextRequest,\n    res: BaseNextResponse,\n    parsedUrl?: NextUrlWithParsedQuery,\n    setHeaders = true\n  ): Promise<void> {\n    const { pathname, query }: NextUrlWithParsedQuery = parsedUrl\n      ? parsedUrl\n      : parseUrl(req.url!, true)\n\n    if (this.nextConfig.i18n) {\n      query.__nextLocale =\n        query.__nextLocale || this.nextConfig.i18n.defaultLocale\n      query.__nextDefaultLocale =\n        query.__nextDefaultLocale || this.nextConfig.i18n.defaultLocale\n    }\n\n    res.statusCode = 404\n    return this.renderError(null, req, res, pathname!, query, setHeaders)\n  }\n\n  protected get _isLikeServerless(): boolean {\n    return isTargetLikeServerless(this.nextConfig.target)\n  }\n}\n\nexport function prepareServerlessUrl(\n  req: BaseNextRequest,\n  query: ParsedUrlQuery\n): void {\n  const curUrl = parseUrl(req.url!, true)\n  req.url = formatUrl({\n    ...curUrl,\n    search: undefined,\n    query: {\n      ...curUrl.query,\n      ...query,\n    },\n  })\n}\n\nexport { stringifyQuery } from './server-route-utils'\n\nclass NoFallbackError extends Error {}\n\n// Internal wrapper around build errors at development\n// time, to prevent us from propagating or logging them\nexport class WrappedBuildError extends Error {\n  innerError: Error\n\n  constructor(innerError: Error) {\n    super()\n    this.innerError = innerError\n  }\n}\n\ntype ResponsePayload = {\n  type: 'html' | 'json'\n  body: RenderResult\n  revalidateOptions?: any\n}\n"],"names":["prepareServerlessUrl","stringifyQuery","envConfig","Log","Server","dir","quiet","conf","dev","minimalMode","customServer","hostname","port","customErrorNo404Warn","warn","loadEnvConfig","nextConfig","distDir","publicDir","getPublicDir","hasStaticDir","getHasStaticDir","serverRuntimeConfig","publicRuntimeConfig","assetPrefix","generateEtags","buildId","getBuildId","renderOpts","poweredByHeader","canonicalBase","amp","previewProps","getPreviewProps","undefined","ampOptimizerConfig","experimental","optimizer","basePath","images","JSON","stringify","optimizeFonts","fontManifest","getFontManifest","optimizeImages","optimizeCss","disableOptimizedLoading","domainLocales","i18n","domains","concurrentFeatures","serverComponents","crossOrigin","Object","keys","length","runtimeConfig","setConfig","pagesManifest","getPagesManifest","middlewareManifest","getMiddlewareManifest","customRoutes","getCustomRoutes","router","generateRoutes","setAssetPrefix","incrementalCache","fs","getCacheFilesystem","pagesDir","_isLikeServerless","locales","max","isrMemoryCacheSize","flushToDisk","isrFlushToDisk","getPrerenderManifest","version","routes","dynamicRoutes","notFoundRoutes","preview","responseCache","logError","err","console","error","handleRequest","req","res","parsedUrl","url","urlParts","split","urlNoQuery","match","cleanUrl","redirect","body","send","headers","query","initUrl","replace","reqUrlIsDataUrl","includes","matchedPathIsDataUrl","isDataUrl","parsedPath","matchedPathname","pathname","matchedPathnameNoExt","localePathResult","detectedLocale","__nextLocale","pageIsDynamic","combinedRewrites","push","rewrites","beforeFiles","afterFiles","fallback","utils","page","locale","path","handleRewrites","params","assign","paramsResult","normalizeDynamicRouteParams","hasValidParams","opts","getParamsFromRouteMatches","dynamicRouteMatcher","interpolateDynamicPath","normalizeVercelUrl","statusCode","renderError","trailingSlash","domain","startsWith","render404","defaultLocale","__nextDefaultLocale","run","code","getRequestHandler","bind","prefix","prepare","close","getRoutesManifest","Array","isArray","ensureMiddleware","_pathname","_isSSR","publicRoutes","generatePublicRoutes","imageRoutes","generateImageRoutes","staticFilesRoutes","generateStaticRoutes","fsRoutes","generateFsStaticRoutes","type","name","fn","_parsedUrl","finished","shift","lastParam","endsWith","join","host","toLowerCase","render","_nextDataReq","_params","restrictedRedirectPaths","map","rule","redirects","generateRewrites","catchAllMiddleware","generateCatchAllMiddlewareRoute","catchAllRoute","Error","bubbleNoFallback","_nextBubbleNoFallback","handled","handleApiRequest","NoFallbackError","useFileSystemPublicRoutes","getDynamicRoutes","middleware","getMiddleware","pageChecker","hasPage","found","getPagePath","_","_beforeCatchAllRender","_req","_res","ensureApiPage","pageFound","dynamicRoute","builtPagePath","runApi","addedPages","Set","has","add","filter","item","Boolean","handleCompression","matched","execute","pipe","partialContext","userAgent","ctx","supportsDynamicHTML","payload","revalidateOptions","sent","setHeader","sendRenderResult","result","options","getStaticHTML","toUnchunkedString","internalRender","renderToResponse","getStaticPaths","staticPaths","fallbackField","fallbackMode","renderToResponseWithComponents","components","is404Page","is500Page","isLikeServerless","ComponentMod","renderReqToHTML","isSSG","getStaticProps","hasServerProps","getServerSideProps","hasStaticPaths","hasGetInitialProps","Component","getInitialProps","isDataReq","parseInt","substr","fromStatic","Document","previewData","isPreviewMode","urlPathname","resolvedUrlPathname","stripNextDataPath","splitPath","substring","indexOf","handleRedirect","pageData","destination","pageProps","__N_REDIRECT","__N_REDIRECT_STATUS","__N_REDIRECT_BASE_PATH","ssgCacheKey","seg","decodeURIComponent","doRender","sprRevalidate","isNotFound","isRedirect","renderResult","html","revalidate","origQuery","hadTrailingSlash","resolvedUrl","resolvedAsPath","renderHTML","value","kind","props","cacheEntry","get","hasResolved","isProduction","isDynamicPathname","didRespond","getFallback","__nextFallback","cachedData","private","stateful","findPageComponents","isNoFallbackError","dynamicRouteResult","renderErrorToResponse","isWrappedError","WrappedBuildError","response","innerError","process","browser","renderToHTML","setHeaders","is404","using404Page","statusPage","env","NODE_ENV","maybeFallbackError","renderToHtmlError","fallbackComponents","getFallbackErrorComponents","renderErrorToHTML","readFile","Promise","resolve","readFileSync","writeFile","mkdir","stat","mtime","Date","target","curUrl","search"],"mappings":"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"}