{"version":3,"sources":["../../server/serve-static.ts"],"sourcesContent":["import { IncomingMessage, ServerResponse } from 'http'\nimport send from 'next/dist/compiled/send'\n\nexport function serveStatic(\n  req: IncomingMessage,\n  res: ServerResponse,\n  path: string\n): Promise<void> {\n  return new Promise((resolve, reject) => {\n    send(req, path)\n      .on('directory', () => {\n        // We don't allow directories to be read.\n        const err: any = new Error('No directory access')\n        err.code = 'ENOENT'\n        reject(err)\n      })\n      .on('error', reject)\n      .pipe(res)\n      .on('finish', resolve)\n  })\n}\n\nexport function getContentType(extWithoutDot: string): string | null {\n  if (extWithoutDot === 'avif') {\n    // TODO: update \"mime\" package\n    return 'image/avif'\n  }\n  const { mime } = send\n  if ('getType' in mime) {\n    // 2.0\n    return mime.getType(extWithoutDot)\n  }\n  // 1.0\n  return (mime as any).lookup(extWithoutDot)\n}\n\nexport function getExtension(contentType: string): string | null {\n  if (contentType === 'image/avif') {\n    // TODO: update \"mime\" package\n    return 'avif'\n  }\n  const { mime } = send\n  if ('getExtension' in mime) {\n    // 2.0\n    return mime.getExtension(contentType)\n  }\n  // 1.0\n  return (mime as any).extension(contentType)\n}\n"],"names":["serveStatic","getContentType","getExtension","req","res","path","Promise","resolve","reject","on","err","Error","code","pipe","extWithoutDot","mime","getType","lookup","contentType","extension"],"mappings":";;;;QAGgBA,WAAW,GAAXA,WAAW;QAmBXC,cAAc,GAAdA,cAAc;QAcdC,YAAY,GAAZA,YAAY;AAnCX,GAAyB,CAAzB,KAAyB;;;;;;SAE1BF,WAAW,CACzBG,GAAoB,EACpBC,GAAmB,EACnBC,IAAY,EACG,CAAC;IAChB,MAAM,CAAC,GAAG,CAACC,OAAO,EAAEC,OAAO,EAAEC,MAAM,GAAK,CAAC;YAP1B,KAAyB,UAQjCL,GAAG,EAAEE,IAAI,EACXI,EAAE,CAAC,CAAW,gBAAQ,CAAC;YACtB,EAAyC,AAAzC,uCAAyC;YACzC,KAAK,CAACC,GAAG,GAAQ,GAAG,CAACC,KAAK,CAAC,CAAqB;YAChDD,GAAG,CAACE,IAAI,GAAG,CAAQ;YACnBJ,MAAM,CAACE,GAAG;QACZ,CAAC,EACAD,EAAE,CAAC,CAAO,QAAED,MAAM,EAClBK,IAAI,CAACT,GAAG,EACRK,EAAE,CAAC,CAAQ,SAAEF,OAAO;IACzB,CAAC;AACH,CAAC;SAEeN,cAAc,CAACa,aAAqB,EAAiB,CAAC;IACpE,EAAE,EAAEA,aAAa,KAAK,CAAM,OAAE,CAAC;QAC7B,EAA8B,AAA9B,4BAA8B;QAC9B,MAAM,CAAC,CAAY;IACrB,CAAC;IACD,KAAK,CAAC,CAAC,CAACC,IAAI,EAAC,CAAC,GA1BC,KAAyB;IA2BxC,EAAE,EAAE,CAAS,YAAIA,IAAI,EAAE,CAAC;QACtB,EAAM,AAAN,IAAM;QACN,MAAM,CAACA,IAAI,CAACC,OAAO,CAACF,aAAa;IACnC,CAAC;IACD,EAAM,AAAN,IAAM;IACN,MAAM,CAAEC,IAAI,CAASE,MAAM,CAACH,aAAa;AAC3C,CAAC;SAEeZ,YAAY,CAACgB,WAAmB,EAAiB,CAAC;IAChE,EAAE,EAAEA,WAAW,KAAK,CAAY,aAAE,CAAC;QACjC,EAA8B,AAA9B,4BAA8B;QAC9B,MAAM,CAAC,CAAM;IACf,CAAC;IACD,KAAK,CAAC,CAAC,CAACH,IAAI,EAAC,CAAC,GAxCC,KAAyB;IAyCxC,EAAE,EAAE,CAAc,iBAAIA,IAAI,EAAE,CAAC;QAC3B,EAAM,AAAN,IAAM;QACN,MAAM,CAACA,IAAI,CAACb,YAAY,CAACgB,WAAW;IACtC,CAAC;IACD,EAAM,AAAN,IAAM;IACN,MAAM,CAAEH,IAAI,CAASI,SAAS,CAACD,WAAW;AAC5C,CAAC"}