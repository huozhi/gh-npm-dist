{"version":3,"sources":["../../../server/web/adapter.ts"],"sourcesContent":["import type { NextMiddleware, RequestData, FetchEventResult } from './types'\nimport type { RequestInit } from './spec-extension/request'\nimport { DeprecationError } from './error'\nimport { fromNodeHeaders } from './utils'\nimport { NextFetchEvent } from './spec-extension/fetch-event'\nimport { NextRequest } from './spec-extension/request'\nimport { NextResponse } from './spec-extension/response'\nimport { waitUntilSymbol } from './spec-compliant/fetch-event'\n\nexport async function adapter(params: {\n  handler: NextMiddleware\n  page: string\n  request: RequestData\n}): Promise<FetchEventResult> {\n  const request = new NextRequestHint({\n    page: params.page,\n    input: params.request.url,\n    init: {\n      geo: params.request.geo,\n      headers: fromNodeHeaders(params.request.headers),\n      ip: params.request.ip,\n      method: params.request.method,\n      nextConfig: params.request.nextConfig,\n      page: params.request.page,\n    },\n  })\n\n  const event = new NextFetchEvent({ request, page: params.page })\n  const original = await params.handler(request, event)\n\n  return {\n    response: original || NextResponse.next(),\n    waitUntil: Promise.all(event[waitUntilSymbol]),\n  }\n}\n\nclass NextRequestHint extends NextRequest {\n  sourcePage: string\n\n  constructor(params: {\n    init: RequestInit\n    input: Request | string\n    page: string\n  }) {\n    super(params.input, params.init)\n    this.sourcePage = params.page\n  }\n\n  get request() {\n    throw new DeprecationError({ page: this.sourcePage })\n  }\n\n  respondWith() {\n    throw new DeprecationError({ page: this.sourcePage })\n  }\n\n  waitUntil() {\n    throw new DeprecationError({ page: this.sourcePage })\n  }\n}\n"],"names":["adapter","params","request","NextRequestHint","page","input","url","init","geo","headers","ip","method","nextConfig","event","original","handler","response","next","waitUntil","Promise","all","sourcePage","respondWith"],"mappings":";;;;QASsBA,OAAO,GAAPA,OAAO;AAPI,GAAS,CAAT,MAAS;AACV,GAAS,CAAT,MAAS;AACV,GAA8B,CAA9B,WAA8B;AACjC,GAA0B,CAA1B,QAA0B;AACzB,GAA2B,CAA3B,SAA2B;AACxB,GAA8B,CAA9B,YAA8B;eAExCA,OAAO,CAACC,MAI7B,EAA6B,CAAC;IAC7B,KAAK,CAACC,OAAO,GAAG,GAAG,CAACC,eAAe,CAAC,CAAC;QACnCC,IAAI,EAAEH,MAAM,CAACG,IAAI;QACjBC,KAAK,EAAEJ,MAAM,CAACC,OAAO,CAACI,GAAG;QACzBC,IAAI,EAAE,CAAC;YACLC,GAAG,EAAEP,MAAM,CAACC,OAAO,CAACM,GAAG;YACvBC,OAAO,MAhBmB,MAAS,kBAgBVR,MAAM,CAACC,OAAO,CAACO,OAAO;YAC/CC,EAAE,EAAET,MAAM,CAACC,OAAO,CAACQ,EAAE;YACrBC,MAAM,EAAEV,MAAM,CAACC,OAAO,CAACS,MAAM;YAC7BC,UAAU,EAAEX,MAAM,CAACC,OAAO,CAACU,UAAU;YACrCR,IAAI,EAAEH,MAAM,CAACC,OAAO,CAACE,IAAI;QAC3B,CAAC;IACH,CAAC;IAED,KAAK,CAACS,KAAK,GAAG,GAAG,CAvBY,WAA8B,gBAuB1B,CAAC;QAACX,OAAO;QAAEE,IAAI,EAAEH,MAAM,CAACG,IAAI;IAAC,CAAC;IAC/D,KAAK,CAACU,QAAQ,GAAG,KAAK,CAACb,MAAM,CAACc,OAAO,CAACb,OAAO,EAAEW,KAAK;IAEpD,MAAM,CAAC,CAAC;QACNG,QAAQ,EAAEF,QAAQ,IAzBO,SAA2B,cAyBjBG,IAAI;QACvCC,SAAS,EAAEC,OAAO,CAACC,GAAG,CAACP,KAAK,CAzBA,YAA8B;IA0B5D,CAAC;AACH,CAAC;MAEKV,eAAe,SA/BO,QAA0B;gBAkCxCF,MAIX,CAAE,CAAC;QACF,KAAK,CAACA,MAAM,CAACI,KAAK,EAAEJ,MAAM,CAACM,IAAI;QAC/B,IAAI,CAACc,UAAU,GAAGpB,MAAM,CAACG,IAAI;IAC/B,CAAC;QAEGF,OAAO,GAAG,CAAC;QACb,KAAK,CAAC,GAAG,CA/CoB,MAAS,kBA+CX,CAAC;YAACE,IAAI,EAAE,IAAI,CAACiB,UAAU;QAAC,CAAC;IACtD,CAAC;IAEDC,WAAW,GAAG,CAAC;QACb,KAAK,CAAC,GAAG,CAnDoB,MAAS,kBAmDX,CAAC;YAAClB,IAAI,EAAE,IAAI,CAACiB,UAAU;QAAC,CAAC;IACtD,CAAC;IAEDH,SAAS,GAAG,CAAC;QACX,KAAK,CAAC,GAAG,CAvDoB,MAAS,kBAuDX,CAAC;YAACd,IAAI,EAAE,IAAI,CAACiB,UAAU;QAAC,CAAC;IACtD,CAAC"}