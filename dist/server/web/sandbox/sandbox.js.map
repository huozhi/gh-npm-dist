{"version":3,"sources":["../../../../server/web/sandbox/sandbox.ts"],"sourcesContent":["import type { RequestData, FetchEventResult } from '../types'\nimport { getModuleContext } from './context'\n\nexport async function run(params: {\n  name: string\n  env: string[]\n  onWarning: (warn: Error) => void\n  paths: string[]\n  request: RequestData\n  useCache: boolean\n}): Promise<FetchEventResult> {\n  const { runInContext, context } = getModuleContext({\n    module: params.name,\n    onWarning: params.onWarning,\n    useCache: params.useCache !== false,\n    env: params.env,\n  })\n\n  for (const paramPath of params.paths) {\n    runInContext(paramPath)\n  }\n\n  const subreq = params.request.headers[`x-middleware-subrequest`]\n  const subrequests = typeof subreq === 'string' ? subreq.split(':') : []\n  if (subrequests.includes(params.name)) {\n    return {\n      waitUntil: Promise.resolve(),\n      response: new context.Response(null, {\n        headers: {\n          'x-middleware-next': '1',\n        },\n      }),\n    }\n  }\n\n  return context._ENTRIES[`middleware_${params.name}`].default({\n    request: params.request,\n  })\n}\n"],"names":["run","params","runInContext","context","module","name","onWarning","useCache","env","paramPath","paths","subreq","request","headers","subrequests","split","includes","waitUntil","Promise","resolve","response","Response","_ENTRIES","default"],"mappings":";;;;QAGsBA,GAAG,GAAHA,GAAG;AAFQ,GAAW,CAAX,QAAW;eAEtBA,GAAG,CAACC,MAOzB,EAA6B,CAAC;IAC7B,KAAK,CAAC,CAAC,CAACC,YAAY,GAAEC,OAAO,EAAC,CAAC,OAVA,QAAW,mBAUS,CAAC;QAClDC,MAAM,EAAEH,MAAM,CAACI,IAAI;QACnBC,SAAS,EAAEL,MAAM,CAACK,SAAS;QAC3BC,QAAQ,EAAEN,MAAM,CAACM,QAAQ,KAAK,KAAK;QACnCC,GAAG,EAAEP,MAAM,CAACO,GAAG;IACjB,CAAC;IAED,GAAG,EAAE,KAAK,CAACC,SAAS,IAAIR,MAAM,CAACS,KAAK,CAAE,CAAC;QACrCR,YAAY,CAACO,SAAS;IACxB,CAAC;IAED,KAAK,CAACE,MAAM,GAAGV,MAAM,CAACW,OAAO,CAACC,OAAO,EAAE,uBAAuB;IAC9D,KAAK,CAACC,WAAW,GAAG,MAAM,CAACH,MAAM,KAAK,CAAQ,UAAGA,MAAM,CAACI,KAAK,CAAC,CAAG,MAAI,CAAC,CAAC;IACvE,EAAE,EAAED,WAAW,CAACE,QAAQ,CAACf,MAAM,CAACI,IAAI,GAAG,CAAC;QACtC,MAAM,CAAC,CAAC;YACNY,SAAS,EAAEC,OAAO,CAACC,OAAO;YAC1BC,QAAQ,EAAE,GAAG,CAACjB,OAAO,CAACkB,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACpCR,OAAO,EAAE,CAAC;oBACR,CAAmB,oBAAE,CAAG;gBAC1B,CAAC;YACH,CAAC;QACH,CAAC;IACH,CAAC;IAED,MAAM,CAACV,OAAO,CAACmB,QAAQ,EAAE,WAAW,EAAErB,MAAM,CAACI,IAAI,IAAIkB,OAAO,CAAC,CAAC;QAC5DX,OAAO,EAAEX,MAAM,CAACW,OAAO;IACzB,CAAC;AACH,CAAC"}