{"version":3,"sources":["../../../../server/web/spec-compliant/request.ts"],"sourcesContent":["import { Body, cloneBody, extractContentType, getInstanceBody } from './body'\nimport { Headers as BaseHeaders } from './headers'\nimport { NextURL } from '../next-url'\nimport { notImplemented } from '../utils'\n\nexport const INTERNALS = Symbol('internal request')\n\nclass BaseRequest extends Body implements Request {\n  [INTERNALS]: {\n    credentials: RequestCredentials\n    headers: Headers\n    method: string\n    referrer: string\n    redirect: RequestRedirect\n    url: NextURL\n  }\n\n  constructor(input: BaseRequest | string, init: RequestInit = {}) {\n    const method = init.method?.toUpperCase() ?? 'GET'\n\n    if (\n      (method === 'GET' || method === 'HEAD') &&\n      (init.body || (input instanceof BaseRequest && getInstanceBody(input)))\n    ) {\n      throw new TypeError('Request with GET/HEAD method cannot have body')\n    }\n\n    let inputBody: BodyInit | null = null\n    if (init.body) {\n      inputBody = init.body\n    } else if (input instanceof BaseRequest && getInstanceBody(input)) {\n      inputBody = cloneBody(input)\n    }\n\n    super(inputBody)\n\n    const headers = new BaseHeaders(\n      init.headers || getProp(input, 'headers') || {}\n    )\n    if (inputBody !== null) {\n      const contentType = extractContentType(this)\n      if (contentType !== null && !headers.has('Content-Type')) {\n        headers.append('Content-Type', contentType)\n      }\n    }\n\n    this[INTERNALS] = {\n      credentials:\n        init.credentials || getProp(input, 'credentials') || 'same-origin',\n      headers,\n      method,\n      referrer: init.referrer || 'about:client',\n      redirect: init.redirect || getProp(input, 'redirect') || 'follow',\n      url: new NextURL(typeof input === 'string' ? input : input.url),\n    }\n  }\n\n  get url() {\n    return this[INTERNALS].url.toString()\n  }\n\n  get credentials() {\n    return this[INTERNALS].credentials\n  }\n\n  get method() {\n    return this[INTERNALS].method\n  }\n\n  get referrer() {\n    return this[INTERNALS].referrer\n  }\n\n  get headers() {\n    return this[INTERNALS].headers\n  }\n\n  get redirect() {\n    return this[INTERNALS].redirect\n  }\n\n  public clone() {\n    return new BaseRequest(this)\n  }\n\n  get cache() {\n    return notImplemented('Request', 'cache')\n  }\n\n  get integrity() {\n    return notImplemented('Request', 'integrity')\n  }\n\n  get keepalive() {\n    return notImplemented('Request', 'keepalive')\n  }\n\n  get mode() {\n    return notImplemented('Request', 'mode')\n  }\n\n  get destination() {\n    return notImplemented('Request', 'destination')\n  }\n\n  get referrerPolicy() {\n    return notImplemented('Request', 'referrerPolicy')\n  }\n\n  get signal() {\n    return notImplemented('Request', 'signal')\n  }\n\n  get [Symbol.toStringTag]() {\n    return 'Request'\n  }\n}\n\nexport { BaseRequest as Request }\n\nfunction getProp<K extends keyof BaseRequest>(\n  input: BaseRequest | string,\n  key: K\n): BaseRequest[K] | undefined {\n  return input instanceof BaseRequest ? input[key] : undefined\n}\n"],"names":["INTERNALS","Symbol","BaseRequest","input","init","method","toUpperCase","body","TypeError","inputBody","headers","getProp","contentType","has","append","credentials","referrer","redirect","url","toString","clone","cache","integrity","keepalive","mode","destination","referrerPolicy","signal","toStringTag","Request","key","undefined"],"mappings":"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"}