{"version":3,"sources":["../../../client/streaming/vitals.ts"],"sourcesContent":["import { useEffect, useRef } from 'react'\nimport { NextWebVitalsMetric } from '../../pages/_app'\n\ntype ReportWebVitalsCallback = (webVitals: NextWebVitalsMetric) => any\nexport const webVitalsCallbacks = new Set<ReportWebVitalsCallback>()\n\nlet flushed = false\nconst metrics: NextWebVitalsMetric[] = []\n\nexport function getBufferedVitalsMetrics() {\n  return metrics\n}\n\nexport function flushBufferedVitalsMetrics() {\n  flushed = true\n  metrics.length = 0\n}\n\nexport function trackWebVitalMetric(metric: NextWebVitalsMetric) {\n  metrics.push(metric)\n  webVitalsCallbacks.forEach((callback) => callback(metric))\n}\n\nexport function useWebVitalsReport(callback: ReportWebVitalsCallback) {\n  const metricIndexRef = useRef(0)\n\n  if (process.env.NODE_ENV === 'development') {\n    if (flushed) {\n      console.error(\n        'The `useWebVitalsReport` hook was called too late -- did you use it inside of a <Suspense> boundary?'\n      )\n    }\n  }\n\n  useEffect(() => {\n    // Flush calculated metrics\n    const reportMetric = (metric: NextWebVitalsMetric) => {\n      callback(metric)\n      metricIndexRef.current = metrics.length\n    }\n    for (let i = metricIndexRef.current; i < metrics.length; i++) {\n      reportMetric(metrics[i])\n    }\n\n    webVitalsCallbacks.add(reportMetric)\n    return () => {\n      webVitalsCallbacks.delete(reportMetric)\n    }\n  }, [callback])\n}\n"],"names":["getBufferedVitalsMetrics","flushBufferedVitalsMetrics","trackWebVitalMetric","useWebVitalsReport","webVitalsCallbacks","Set","flushed","metrics","length","metric","push","forEach","callback","metricIndexRef","process","env","NODE_ENV","console","error","reportMetric","current","i","add","delete"],"mappings":";;;;QASgBA,wBAAwB,GAAxBA,wBAAwB;QAIxBC,0BAA0B,GAA1BA,0BAA0B;QAK1BC,mBAAmB,GAAnBA,mBAAmB;QAKnBC,kBAAkB,GAAlBA,kBAAkB;;AAvBA,GAAO,CAAP,MAAO;AAIlC,KAAK,CAACC,kBAAkB,GAAG,GAAG,CAACC,GAAG;QAA5BD,kBAAkB,GAAlBA,kBAAkB;AAE/B,GAAG,CAACE,OAAO,GAAG,KAAK;AACnB,KAAK,CAACC,OAAO,GAA0B,CAAC,CAAC;SAEzBP,wBAAwB,GAAG,CAAC;IAC1C,MAAM,CAACO,OAAO;AAChB,CAAC;SAEeN,0BAA0B,GAAG,CAAC;IAC5CK,OAAO,GAAG,IAAI;IACdC,OAAO,CAACC,MAAM,GAAG,CAAC;AACpB,CAAC;SAEeN,mBAAmB,CAACO,MAA2B,EAAE,CAAC;IAChEF,OAAO,CAACG,IAAI,CAACD,MAAM;IACnBL,kBAAkB,CAACO,OAAO,EAAEC,QAAQ,GAAKA,QAAQ,CAACH,MAAM;;AAC1D,CAAC;SAEeN,kBAAkB,CAACS,QAAiC,EAAE,CAAC;IACrE,KAAK,CAACC,cAAc,OAxBY,MAAO,SAwBT,CAAC;IAE/B,EAAE,EAAEC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,CAAa,cAAE,CAAC;QAC3C,EAAE,EAAEV,OAAO,EAAE,CAAC;YACZW,OAAO,CAACC,KAAK,CACX,CAAsG;QAE1G,CAAC;IACH,CAAC;QAhC+B,MAAO,gBAkCvB,CAAC;QACf,EAA2B,AAA3B,yBAA2B;QAC3B,KAAK,CAACC,YAAY,IAAIV,MAA2B,GAAK,CAAC;YACrDG,QAAQ,CAACH,MAAM;YACfI,cAAc,CAACO,OAAO,GAAGb,OAAO,CAACC,MAAM;QACzC,CAAC;QACD,GAAG,CAAE,GAAG,CAACa,CAAC,GAAGR,cAAc,CAACO,OAAO,EAAEC,CAAC,GAAGd,OAAO,CAACC,MAAM,EAAEa,CAAC,GAAI,CAAC;YAC7DF,YAAY,CAACZ,OAAO,CAACc,CAAC;QACxB,CAAC;QAEDjB,kBAAkB,CAACkB,GAAG,CAACH,YAAY;QACnC,MAAM,KAAO,CAAC;YACZf,kBAAkB,CAACmB,MAAM,CAACJ,YAAY;QACxC,CAAC;IACH,CAAC,EAAE,CAACP;QAAAA,QAAQ;IAAA,CAAC;AACf,CAAC"}