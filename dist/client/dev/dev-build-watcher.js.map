{"version":3,"sources":["../../../client/dev/dev-build-watcher.js"],"sourcesContent":["import { addMessageListener } from './error-overlay/websocket'\n\nexport default function initializeBuildWatcher(\n  toggleCallback,\n  position = 'bottom-right'\n) {\n  const shadowHost = document.createElement('div')\n  shadowHost.id = '__next-build-watcher'\n  // Make sure container is fixed and on a high zIndex so it shows\n  shadowHost.style.position = 'fixed'\n  // Ensure container's position to be top or bottom (default)\n  if (['top-left', 'top-right'].indexOf(position) > -1) {\n    shadowHost.style.top = '10px'\n  } else {\n    shadowHost.style.bottom = '10px'\n  }\n  // Ensure container's position to be left or right (default)\n  if (['bottom-left', 'top-left'].indexOf(position) > -1) {\n    shadowHost.style.left = '20px'\n  } else {\n    shadowHost.style.right = '20px'\n  }\n  shadowHost.style.width = 0\n  shadowHost.style.height = 0\n  shadowHost.style.zIndex = 99999\n  document.body.appendChild(shadowHost)\n\n  let shadowRoot\n  let prefix = ''\n\n  if (shadowHost.attachShadow) {\n    shadowRoot = shadowHost.attachShadow({ mode: 'open' })\n  } else {\n    // If attachShadow is undefined then the browser does not support\n    // the Shadow DOM, we need to prefix all the names so there\n    // will be no conflicts\n    shadowRoot = shadowHost\n    prefix = '__next-build-watcher-'\n  }\n\n  // Container\n  const container = createContainer(prefix)\n  shadowRoot.appendChild(container)\n\n  // CSS\n  const css = createCss(prefix)\n  shadowRoot.appendChild(css)\n\n  // State\n  let isVisible = false\n  let isBuilding = false\n  let timeoutId = null\n\n  // Handle events\n\n  addMessageListener((event) => {\n    // This is the heartbeat event\n    if (event.data === '\\uD83D\\uDC93') {\n      return\n    }\n\n    try {\n      handleMessage(event)\n    } catch {}\n  })\n\n  function handleMessage(event) {\n    const obj =\n      typeof event === 'string' ? { action: event } : JSON.parse(event.data)\n\n    // eslint-disable-next-line default-case\n    switch (obj.action) {\n      case 'building':\n        timeoutId && clearTimeout(timeoutId)\n        isVisible = true\n        isBuilding = true\n        updateContainer()\n        break\n      case 'built':\n      case 'sync':\n        isBuilding = false\n        // Wait for the fade out transition to complete\n        timeoutId = setTimeout(() => {\n          isVisible = false\n          updateContainer()\n        }, 100)\n        updateContainer()\n        break\n    }\n  }\n\n  toggleCallback(handleMessage)\n\n  function updateContainer() {\n    if (isBuilding) {\n      container.classList.add(`${prefix}building`)\n    } else {\n      container.classList.remove(`${prefix}building`)\n    }\n\n    if (isVisible) {\n      container.classList.add(`${prefix}visible`)\n    } else {\n      container.classList.remove(`${prefix}visible`)\n    }\n  }\n}\n\nfunction createContainer(prefix) {\n  const container = document.createElement('div')\n  container.id = `${prefix}container`\n  container.innerHTML = `\n    <div id=\"${prefix}icon-wrapper\">\n      <svg viewBox=\"0 0 226 200\">\n        <defs>\n          <linearGradient\n            x1=\"114.720775%\"\n            y1=\"181.283245%\"\n            x2=\"39.5399306%\"\n            y2=\"100%\"\n            id=\"${prefix}linear-gradient\"\n          >\n            <stop stop-color=\"#000000\" offset=\"0%\" />\n            <stop stop-color=\"#FFFFFF\" offset=\"100%\" />\n          </linearGradient>\n        </defs>\n        <g id=\"${prefix}icon-group\" fill=\"none\" stroke=\"url(#${prefix}linear-gradient)\" stroke-width=\"18\">\n          <path d=\"M113,5.08219117 L4.28393801,197.5 L221.716062,197.5 L113,5.08219117 Z\" />\n        </g>\n      </svg>\n    </div>\n  `\n\n  return container\n}\n\nfunction createCss(prefix) {\n  const css = document.createElement('style')\n  css.textContent = `\n    #${prefix}container {\n      position: absolute;\n      bottom: 10px;\n      right: 30px;\n\n      border-radius: 3px;\n      background: #000;\n      color: #fff;\n      font: initial;\n      cursor: initial;\n      letter-spacing: initial;\n      text-shadow: initial;\n      text-transform: initial;\n      visibility: initial;\n\n      padding: 7px 10px 8px 10px;\n      align-items: center;\n      box-shadow: 0 11px 40px 0 rgba(0, 0, 0, 0.25), 0 2px 10px 0 rgba(0, 0, 0, 0.12);\n\n      display: none;\n      opacity: 0;\n      transition: opacity 0.1s ease, bottom 0.1s ease;\n      animation: ${prefix}fade-in 0.1s ease-in-out;\n    }\n\n    #${prefix}container.${prefix}visible {\n      display: flex;\n    }\n\n    #${prefix}container.${prefix}building {\n      bottom: 20px;\n      opacity: 1;\n    }\n\n    #${prefix}icon-wrapper {\n      width: 16px;\n      height: 16px;\n    }\n\n    #${prefix}icon-wrapper > svg {\n      width: 100%;\n      height: 100%;\n    }\n\n    #${prefix}icon-group {\n      animation: ${prefix}strokedash 1s ease-in-out both infinite;\n    }\n\n    @keyframes ${prefix}fade-in {\n      from {\n        bottom: 10px;\n        opacity: 0;\n      }\n      to {\n        bottom: 20px;\n        opacity: 1;\n      }\n    }\n\n    @keyframes ${prefix}strokedash {\n      0% {\n        stroke-dasharray: 0 226;\n      }\n      80%,\n      100% {\n        stroke-dasharray: 659 226;\n      }\n    }\n  `\n\n  return css\n}\n"],"names":["initializeBuildWatcher","toggleCallback","position","shadowHost","document","createElement","id","style","indexOf","top","bottom","left","right","width","height","zIndex","body","appendChild","shadowRoot","prefix","attachShadow","mode","container","createContainer","css","createCss","isVisible","isBuilding","timeoutId","event","data","handleMessage","obj","action","JSON","parse","clearTimeout","updateContainer","setTimeout","classList","add","remove","innerHTML","textContent"],"mappings":"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"}