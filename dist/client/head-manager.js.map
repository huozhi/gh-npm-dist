{"version":3,"sources":["../../client/head-manager.ts"],"sourcesContent":["export const DOMAttributeNames: Record<string, string> = {\n  acceptCharset: 'accept-charset',\n  className: 'class',\n  htmlFor: 'for',\n  httpEquiv: 'http-equiv',\n  noModule: 'noModule',\n}\n\nfunction reactElementToDOM({ type, props }: JSX.Element): HTMLElement {\n  const el: HTMLElement = document.createElement(type)\n  for (const p in props) {\n    if (!props.hasOwnProperty(p)) continue\n    if (p === 'children' || p === 'dangerouslySetInnerHTML') continue\n\n    // we don't render undefined props to the DOM\n    if (props[p] === undefined) continue\n\n    const attr = DOMAttributeNames[p] || p.toLowerCase()\n    if (\n      type === 'script' &&\n      (attr === 'async' || attr === 'defer' || attr === 'noModule')\n    ) {\n      ;(el as HTMLScriptElement)[attr] = !!props[p]\n    } else {\n      el.setAttribute(attr, props[p])\n    }\n  }\n\n  const { children, dangerouslySetInnerHTML } = props\n  if (dangerouslySetInnerHTML) {\n    el.innerHTML = dangerouslySetInnerHTML.__html || ''\n  } else if (children) {\n    el.textContent =\n      typeof children === 'string'\n        ? children\n        : Array.isArray(children)\n        ? children.join('')\n        : ''\n  }\n  return el\n}\n\n/**\n * When a `nonce` is present on an element, browsers such as Chrome and Firefox strip it out of the\n * actual HTML attributes for security reasons *when the element is added to the document*. Thus,\n * given two equivalent elements that have nonces, `Element,isEqualNode()` will return false if one\n * of those elements gets added to the document. Although the `element.nonce` property will be the\n * same for both elements, the one that was added to the document will return an empty string for\n * its nonce HTML attribute value.\n *\n * This custom `isEqualNode()` function therefore removes the nonce value from the `newTag` before\n * comparing it to `oldTag`, restoring it afterwards.\n *\n * For more information, see:\n * https://bugs.chromium.org/p/chromium/issues/detail?id=1211471#c12\n */\nexport function isEqualNode(oldTag: Element, newTag: Element) {\n  if (oldTag instanceof HTMLElement && newTag instanceof HTMLElement) {\n    const nonce = newTag.getAttribute('nonce')\n    // Only strip the nonce if `oldTag` has had it stripped. An element's nonce attribute will not\n    // be stripped if there is no content security policy response header that includes a nonce.\n    if (nonce && !oldTag.getAttribute('nonce')) {\n      const cloneTag = newTag.cloneNode(true) as typeof newTag\n      cloneTag.setAttribute('nonce', '')\n      cloneTag.nonce = nonce\n      return nonce === oldTag.nonce && oldTag.isEqualNode(cloneTag)\n    }\n  }\n\n  return oldTag.isEqualNode(newTag)\n}\n\nfunction updateElements(type: string, components: JSX.Element[]): void {\n  const headEl = document.getElementsByTagName('head')[0]\n  const headCountEl: HTMLMetaElement = headEl.querySelector(\n    'meta[name=next-head-count]'\n  ) as HTMLMetaElement\n  if (process.env.NODE_ENV !== 'production') {\n    if (!headCountEl) {\n      console.error(\n        'Warning: next-head-count is missing. https://nextjs.org/docs/messages/next-head-count-missing'\n      )\n      return\n    }\n  }\n\n  const headCount = Number(headCountEl.content)\n  const oldTags: Element[] = []\n\n  for (\n    let i = 0, j = headCountEl.previousElementSibling;\n    i < headCount;\n    i++, j = j?.previousElementSibling || null\n  ) {\n    if (j?.tagName?.toLowerCase() === type) {\n      oldTags.push(j)\n    }\n  }\n  const newTags = (components.map(reactElementToDOM) as HTMLElement[]).filter(\n    (newTag) => {\n      for (let k = 0, len = oldTags.length; k < len; k++) {\n        const oldTag = oldTags[k]\n        if (isEqualNode(oldTag, newTag)) {\n          oldTags.splice(k, 1)\n          return false\n        }\n      }\n      return true\n    }\n  )\n\n  oldTags.forEach((t) => t.parentNode?.removeChild(t))\n  newTags.forEach((t) => headEl.insertBefore(t, headCountEl))\n  headCountEl.content = (headCount - oldTags.length + newTags.length).toString()\n}\n\nexport default function initHeadManager(): {\n  mountedInstances: Set<unknown>\n  updateHead: (head: JSX.Element[]) => void\n} {\n  let updatePromise: Promise<void> | null = null\n\n  return {\n    mountedInstances: new Set(),\n    updateHead: (head: JSX.Element[]) => {\n      const promise = (updatePromise = Promise.resolve().then(() => {\n        if (promise !== updatePromise) return\n\n        updatePromise = null\n        const tags: Record<string, JSX.Element[]> = {}\n\n        head.forEach((h) => {\n          if (\n            // If the font tag is loaded only on client navigation\n            // it won't be inlined. In this case revert to the original behavior\n            h.type === 'link' &&\n            h.props['data-optimized-fonts']\n          ) {\n            if (\n              document.querySelector(\n                `style[data-href=\"${h.props['data-href']}\"]`\n              )\n            ) {\n              return\n            } else {\n              h.props.href = h.props['data-href']\n              h.props['data-href'] = undefined\n            }\n          }\n\n          const components = tags[h.type] || []\n          components.push(h)\n          tags[h.type] = components\n        })\n\n        const titleComponent = tags.title ? tags.title[0] : null\n        let title = ''\n        if (titleComponent) {\n          const { children } = titleComponent.props\n          title =\n            typeof children === 'string'\n              ? children\n              : Array.isArray(children)\n              ? children.join('')\n              : ''\n        }\n        if (title !== document.title) document.title = title\n        ;['meta', 'base', 'link', 'style', 'script'].forEach((type) => {\n          updateElements(type, tags[type] || [])\n        })\n      }))\n    },\n  }\n}\n"],"names":["isEqualNode","initHeadManager","DOMAttributeNames","acceptCharset","className","htmlFor","httpEquiv","noModule","reactElementToDOM","type","props","el","document","createElement","p","hasOwnProperty","undefined","attr","toLowerCase","setAttribute","children","dangerouslySetInnerHTML","innerHTML","__html","textContent","Array","isArray","join","oldTag","newTag","HTMLElement","nonce","getAttribute","cloneTag","cloneNode","updateElements","components","headEl","getElementsByTagName","headCountEl","querySelector","process","env","NODE_ENV","console","error","headCount","Number","content","oldTags","i","j","previousElementSibling","tagName","push","newTags","map","filter","k","len","length","splice","forEach","t","parentNode","removeChild","insertBefore","toString","updatePromise","mountedInstances","Set","updateHead","head","promise","Promise","resolve","then","tags","h","href","titleComponent","title"],"mappings":"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"}