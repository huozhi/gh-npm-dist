{"version":3,"sources":["../../client/performance-relayer.ts"],"sourcesContent":["/* global location */\nimport {\n  getCLS,\n  getFCP,\n  getFID,\n  getLCP,\n  getTTFB,\n  Metric,\n  ReportHandler,\n} from 'next/dist/compiled/web-vitals'\n\nconst initialHref = location.href\nlet isRegistered = false\nlet userReportHandler: ReportHandler | undefined\n\nfunction onReport(metric: Metric): void {\n  if (userReportHandler) {\n    userReportHandler(metric)\n  }\n\n  // This code is not shipped, executed, or present in the client-side\n  // JavaScript bundle unless explicitly enabled in your application.\n  //\n  // When this feature is enabled, we'll make it very clear by printing a\n  // message during the build (`next build`).\n  if (\n    process.env.NODE_ENV === 'production' &&\n    // This field is empty unless you explicitly configure it:\n    process.env.__NEXT_ANALYTICS_ID\n  ) {\n    const body: Record<string, string> = {\n      dsn: process.env.__NEXT_ANALYTICS_ID,\n      id: metric.id,\n      page: window.__NEXT_DATA__.page,\n      href: initialHref,\n      event_name: metric.name,\n      value: metric.value.toString(),\n      speed:\n        'connection' in navigator &&\n        (navigator as any)['connection'] &&\n        'effectiveType' in (navigator as any)['connection']\n          ? ((navigator as any)['connection']['effectiveType'] as string)\n          : '',\n    }\n\n    const blob = new Blob([new URLSearchParams(body).toString()], {\n      // This content type is necessary for `sendBeacon`:\n      type: 'application/x-www-form-urlencoded',\n    })\n    const vitalsUrl = 'https://vitals.vercel-insights.com/v1/vitals'\n    // Navigator has to be bound to ensure it does not error in some browsers\n    // https://xgwang.me/posts/you-may-not-know-beacon/#it-may-throw-error%2C-be-sure-to-catch\n    const send = navigator.sendBeacon && navigator.sendBeacon.bind(navigator)\n\n    function fallbackSend() {\n      fetch(vitalsUrl, {\n        body: blob,\n        method: 'POST',\n        credentials: 'omit',\n        keepalive: true,\n        // console.error is used here as when the fetch fails it does not affect functioning of the app\n      }).catch(console.error)\n    }\n\n    try {\n      // If send is undefined it'll throw as well. This reduces output code size.\n      send!(vitalsUrl, blob) || fallbackSend()\n    } catch (err) {\n      fallbackSend()\n    }\n  }\n}\n\nexport default (onPerfEntry?: ReportHandler): void => {\n  // Update function if it changes:\n  userReportHandler = onPerfEntry\n\n  // Only register listeners once:\n  if (isRegistered) {\n    return\n  }\n  isRegistered = true\n\n  getCLS(onReport)\n  getFID(onReport)\n  getFCP(onReport)\n  getLCP(onReport)\n  getTTFB(onReport)\n}\n"],"names":["initialHref","location","href","isRegistered","userReportHandler","onReport","metric","process","env","NODE_ENV","__NEXT_ANALYTICS_ID","body","dsn","id","page","window","__NEXT_DATA__","event_name","name","value","toString","speed","navigator","blob","Blob","URLSearchParams","type","vitalsUrl","send","sendBeacon","bind","fallbackSend","fetch","method","credentials","keepalive","catch","console","error","err","onPerfEntry"],"mappings":";;;;;AASO,GAA+B,CAA/B,UAA+B;AAEtC,KAAK,CAACA,WAAW,GAAGC,QAAQ,CAACC,IAAI;AACjC,GAAG,CAACC,YAAY,GAAG,KAAK;AACxB,GAAG,CAACC,iBAAiB;SAEZC,QAAQ,CAACC,MAAc,EAAQ,CAAC;IACvC,EAAE,EAAEF,iBAAiB,EAAE,CAAC;QACtBA,iBAAiB,CAACE,MAAM;IAC1B,CAAC;IAED,EAAoE,AAApE,kEAAoE;IACpE,EAAmE,AAAnE,iEAAmE;IACnE,EAAE;IACF,EAAuE,AAAvE,qEAAuE;IACvE,EAA2C,AAA3C,yCAA2C;IAC3C,EAAE,EACAC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,CAAY,eACrC,EAA0D,AAA1D,wDAA0D;IAC1DF,OAAO,CAACC,GAAG,CAACE,mBAAmB,EAC/B,CAAC;QACD,KAAK,CAACC,IAAI,GAA2B,CAAC;YACpCC,GAAG,EAAEL,OAAO,CAACC,GAAG,CAACE,mBAAmB;YACpCG,EAAE,EAAEP,MAAM,CAACO,EAAE;YACbC,IAAI,EAAEC,MAAM,CAACC,aAAa,CAACF,IAAI;YAC/BZ,IAAI,EAAEF,WAAW;YACjBiB,UAAU,EAAEX,MAAM,CAACY,IAAI;YACvBC,KAAK,EAAEb,MAAM,CAACa,KAAK,CAACC,QAAQ;YAC5BC,KAAK,EACH,CAAY,eAAIC,SAAS,IACxBA,SAAS,CAAS,CAAY,gBAC/B,CAAe,kBAAKA,SAAS,CAAS,CAAY,eAC5CA,SAAS,CAAS,CAAY,aAAE,CAAe,kBACjD,CAAE;QACV,CAAC;QAED,KAAK,CAACC,IAAI,GAAG,GAAG,CAACC,IAAI,CAAC,CAAC;YAAA,GAAG,CAACC,eAAe,CAACd,IAAI,EAAES,QAAQ;QAAE,CAAC,EAAE,CAAC;YAC7D,EAAmD,AAAnD,iDAAmD;YACnDM,IAAI,EAAE,CAAmC;QAC3C,CAAC;QACD,KAAK,CAACC,SAAS,GAAG,CAA8C;QAChE,EAAyE,AAAzE,uEAAyE;QACzE,EAA0F,AAA1F,wFAA0F;QAC1F,KAAK,CAACC,IAAI,GAAGN,SAAS,CAACO,UAAU,IAAIP,SAAS,CAACO,UAAU,CAACC,IAAI,CAACR,SAAS;iBAE/DS,YAAY,GAAG,CAAC;YACvBC,KAAK,CAACL,SAAS,EAAE,CAAC;gBAChBhB,IAAI,EAAEY,IAAI;gBACVU,MAAM,EAAE,CAAM;gBACdC,WAAW,EAAE,CAAM;gBACnBC,SAAS,EAAE,IAAI;YAEjB,CAAC,EAAEC,KAAK,CAACC,OAAO,CAACC,KAAK;QACxB,CAAC;QAED,GAAG,CAAC,CAAC;YACH,EAA2E,AAA3E,yEAA2E;YAC3EV,IAAI,CAAED,SAAS,EAAEJ,IAAI,KAAKQ,YAAY;QACxC,CAAC,CAAC,KAAK,EAAEQ,GAAG,EAAE,CAAC;YACbR,YAAY;QACd,CAAC;IACH,CAAC;AACH,CAAC;gBAEeS,WAA2B,GAAW,CAAC;IACrD,EAAiC,AAAjC,+BAAiC;IACjCpC,iBAAiB,GAAGoC,WAAW;IAE/B,EAAgC,AAAhC,8BAAgC;IAChC,EAAE,EAAErC,YAAY,EAAE,CAAC;QACjB,MAAM;IACR,CAAC;IACDA,YAAY,GAAG,IAAI;QAxEd,UAA+B,SA0E7BE,QAAQ;QA1EV,UAA+B,SA2E7BA,QAAQ;QA3EV,UAA+B,SA4E7BA,QAAQ;QA5EV,UAA+B,SA6E7BA,QAAQ;QA7EV,UAA+B,UA8E5BA,QAAQ;AAClB,CAAC"}