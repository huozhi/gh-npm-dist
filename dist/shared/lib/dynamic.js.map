{"version":3,"sources":["../../../shared/lib/dynamic.tsx"],"sourcesContent":["import React from 'react'\nimport Loadable from './loadable'\n\nconst isServerSide = typeof window === 'undefined'\n\nexport type LoaderComponent<P = {}> = Promise<\n  React.ComponentType<P> | { default: React.ComponentType<P> }\n>\n\nexport type Loader<P = {}> = (() => LoaderComponent<P>) | LoaderComponent<P>\n\nexport type LoaderMap = { [mdule: string]: () => Loader<any> }\n\nexport type LoadableGeneratedOptions = {\n  webpack?(): any\n  modules?(): LoaderMap\n}\n\nexport type LoadableBaseOptions<P = {}> = LoadableGeneratedOptions & {\n  loading?: ({\n    error,\n    isLoading,\n    pastDelay,\n  }: {\n    error?: Error | null\n    isLoading?: boolean\n    pastDelay?: boolean\n    retry?: () => void\n    timedOut?: boolean\n  }) => JSX.Element | null\n  loader?: Loader<P> | LoaderMap\n  loadableGenerated?: LoadableGeneratedOptions\n  ssr?: boolean\n}\n\nexport type LoadableSuspenseOptions = {\n  suspense?: boolean\n}\n\nexport type LoadableOptions<P = {}> = LoadableBaseOptions<P>\n\nexport type DynamicOptions<P = {}> =\n  | LoadableBaseOptions<P>\n  | LoadableSuspenseOptions\n\nexport type LoadableFn<P = {}> = (\n  opts: LoadableOptions<P> | LoadableSuspenseOptions\n) => React.ComponentType<P>\n\nexport type LoadableComponent<P = {}> = React.ComponentType<P>\n\nexport function noSSR<P = {}>(\n  LoadableInitializer: LoadableFn<P>,\n  loadableOptions: LoadableBaseOptions<P>\n): React.ComponentType<P> {\n  // Removing webpack and modules means react-loadable won't try preloading\n  delete loadableOptions.webpack\n  delete loadableOptions.modules\n\n  // This check is necessary to prevent react-loadable from initializing on the server\n  if (!isServerSide) {\n    return LoadableInitializer(loadableOptions)\n  }\n\n  const Loading = loadableOptions.loading!\n  // This will only be rendered on the server side\n  return () => (\n    <Loading error={null} isLoading pastDelay={false} timedOut={false} />\n  )\n}\n\nexport default function dynamic<P = {}>(\n  dynamicOptions: DynamicOptions<P> | Loader<P>,\n  options?: DynamicOptions<P>\n): React.ComponentType<P> {\n  let loadableFn: LoadableFn<P> = Loadable\n  let loadableOptions: LoadableOptions<P> = {\n    // A loading component is not required, so we default it\n    loading: ({ error, isLoading, pastDelay }) => {\n      if (!pastDelay) return null\n      if (process.env.NODE_ENV === 'development') {\n        if (isLoading) {\n          return null\n        }\n        if (error) {\n          return (\n            <p>\n              {error.message}\n              <br />\n              {error.stack}\n            </p>\n          )\n        }\n      }\n\n      return null\n    },\n  }\n\n  // Support for direct import(), eg: dynamic(import('../hello-world'))\n  // Note that this is only kept for the edge case where someone is passing in a promise as first argument\n  // The react-loadable babel plugin will turn dynamic(import('../hello-world')) into dynamic(() => import('../hello-world'))\n  // To make sure we don't execute the import without rendering first\n  if (dynamicOptions instanceof Promise) {\n    loadableOptions.loader = () => dynamicOptions\n    // Support for having import as a function, eg: dynamic(() => import('../hello-world'))\n  } else if (typeof dynamicOptions === 'function') {\n    loadableOptions.loader = dynamicOptions\n    // Support for having first argument being options, eg: dynamic({loader: import('../hello-world')})\n  } else if (typeof dynamicOptions === 'object') {\n    loadableOptions = { ...loadableOptions, ...dynamicOptions }\n  }\n\n  // Support for passing options, eg: dynamic(import('../hello-world'), {loading: () => <p>Loading something</p>})\n  loadableOptions = { ...loadableOptions, ...options }\n\n  const suspenseOptions = loadableOptions as LoadableSuspenseOptions & {\n    loader: Loader<P>\n  }\n  if (!process.env.__NEXT_CONCURRENT_FEATURES) {\n    // Error if react root is not enabled and `suspense` option is set to true\n    if (!process.env.__NEXT_REACT_ROOT && suspenseOptions.suspense) {\n      // TODO: add error doc when this feature is stable\n      throw new Error(\n        `Invalid suspense option usage in next/dynamic. Read more: https://nextjs.org/docs/messages/invalid-dynamic-suspense`\n      )\n    }\n  }\n  if (suspenseOptions.suspense) {\n    return loadableFn(suspenseOptions)\n  }\n\n  // coming from build/babel/plugins/react-loadable-plugin.js\n  if (loadableOptions.loadableGenerated) {\n    loadableOptions = {\n      ...loadableOptions,\n      ...loadableOptions.loadableGenerated,\n    }\n    delete loadableOptions.loadableGenerated\n  }\n\n  // support for disabling server side rendering, eg: dynamic(import('../hello-world'), {ssr: false})\n  if (typeof loadableOptions.ssr === 'boolean') {\n    if (!loadableOptions.ssr) {\n      delete loadableOptions.ssr\n      return noSSR(loadableFn, loadableOptions)\n    }\n    delete loadableOptions.ssr\n  }\n\n  return loadableFn(loadableOptions)\n}\n"],"names":["noSSR","dynamic","isServerSide","window","LoadableInitializer","loadableOptions","webpack","modules","Loading","loading","error","isLoading","pastDelay","timedOut","dynamicOptions","options","loadableFn","process","env","NODE_ENV","p","message","br","stack","Promise","loader","suspenseOptions","__NEXT_CONCURRENT_FEATURES","__NEXT_REACT_ROOT","suspense","Error","loadableGenerated","ssr"],"mappings":"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"}