{"version":3,"sources":["../../../../../shared/lib/router/utils/parse-next-url.ts"],"sourcesContent":["import { getCookieParser } from '../../../../server/api-utils'\nimport { getLocaleMetadata } from '../../i18n/get-locale-metadata'\nimport { parseUrl } from './parse-url'\nimport type { NextConfig, DomainLocale } from '../../../../server/config-shared'\nimport type { ParsedUrl } from './parse-url'\nimport type { PathLocale } from '../../i18n/normalize-locale-path'\nimport { hasBasePath, replaceBasePath } from '../../../../server/router'\n\ninterface Params {\n  headers?: { [key: string]: string | string[] | undefined }\n  nextConfig: NextConfig\n  url?: string\n}\n\nexport function parseNextUrl({ headers, nextConfig, url = '/' }: Params) {\n  const urlParsed: ParsedNextUrl = parseUrl(url)\n  const { basePath } = nextConfig\n\n  if (basePath && hasBasePath(urlParsed.pathname, basePath)) {\n    urlParsed.pathname = replaceBasePath(urlParsed.pathname, basePath)\n    urlParsed.basePath = basePath\n  }\n\n  if (nextConfig.i18n) {\n    urlParsed.locale = getLocaleMetadata({\n      cookies: getCookieParser(headers || {}),\n      headers: headers,\n      nextConfig: {\n        basePath: nextConfig.basePath,\n        i18n: nextConfig.i18n,\n        trailingSlash: nextConfig.trailingSlash,\n      },\n      url: urlParsed,\n    })\n\n    if (urlParsed.locale?.path.detectedLocale) {\n      urlParsed.pathname = urlParsed.locale.path.pathname\n    }\n  }\n\n  return urlParsed\n}\n\nexport interface ParsedNextUrl extends ParsedUrl {\n  basePath?: string\n  locale?: {\n    defaultLocale: string\n    domain?: DomainLocale\n    locale: string\n    path: PathLocale\n    redirect?: string\n    trailingSlash?: boolean\n  }\n}\n"],"names":["parseNextUrl","headers","nextConfig","url","urlParsed","basePath","pathname","i18n","locale","cookies","trailingSlash","path","detectedLocale"],"mappings":";;;;QAcgBA,YAAY,GAAZA,YAAY;AAdI,GAA8B,CAA9B,SAA8B;AAC5B,GAAgC,CAAhC,kBAAgC;AACzC,GAAa,CAAb,SAAa;AAIO,GAA2B,CAA3B,OAA2B;SAQxDA,YAAY,CAAC,CAAC,CAACC,OAAO,GAAEC,UAAU,GAAEC,GAAG,EAAG,CAAG,IAAS,CAAC,EAAE,CAAC;IACxE,KAAK,CAACC,SAAS,OAbQ,SAAa,WAaMD,GAAG;IAC7C,KAAK,CAAC,CAAC,CAACE,QAAQ,EAAC,CAAC,GAAGH,UAAU;IAE/B,EAAE,EAAEG,QAAQ,QAZ+B,OAA2B,cAY1CD,SAAS,CAACE,QAAQ,EAAED,QAAQ,GAAG,CAAC;QAC1DD,SAAS,CAACE,QAAQ,OAbuB,OAA2B,kBAa/BF,SAAS,CAACE,QAAQ,EAAED,QAAQ;QACjED,SAAS,CAACC,QAAQ,GAAGA,QAAQ;IAC/B,CAAC;IAED,EAAE,EAAEH,UAAU,CAACK,IAAI,EAAE,CAAC;YAYhBH,GAAgB;QAXpBA,SAAS,CAACI,MAAM,OAvBc,kBAAgC,oBAuBzB,CAAC;YACpCC,OAAO,MAzBmB,SAA8B,kBAyB/BR,OAAO,IAAI,CAAC,CAAC;YACtCA,OAAO,EAAEA,OAAO;YAChBC,UAAU,EAAE,CAAC;gBACXG,QAAQ,EAAEH,UAAU,CAACG,QAAQ;gBAC7BE,IAAI,EAAEL,UAAU,CAACK,IAAI;gBACrBG,aAAa,EAAER,UAAU,CAACQ,aAAa;YACzC,CAAC;YACDP,GAAG,EAAEC,SAAS;QAChB,CAAC;QAED,EAAE,GAAEA,GAAgB,GAAhBA,SAAS,CAACI,MAAM,cAAhBJ,GAAgB,KAAhBA,IAAI,CAAJA,CAAsB,GAAtBA,IAAI,CAAJA,CAAsB,GAAtBA,GAAgB,CAAEO,IAAI,CAACC,cAAc,EAAE,CAAC;YAC1CR,SAAS,CAACE,QAAQ,GAAGF,SAAS,CAACI,MAAM,CAACG,IAAI,CAACL,QAAQ;QACrD,CAAC;IACH,CAAC;IAED,MAAM,CAACF,SAAS;AAClB,CAAC"}