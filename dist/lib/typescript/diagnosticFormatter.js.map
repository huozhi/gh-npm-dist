{"version":3,"sources":["../../../lib/typescript/diagnosticFormatter.ts"],"sourcesContent":["import { codeFrameColumns } from 'next/dist/compiled/babel/code-frame'\nimport chalk from 'next/dist/compiled/chalk'\nimport path from 'path'\n\n// eslint typescript has a bug with TS enums\n/* eslint-disable no-shadow */\nexport enum DiagnosticCategory {\n  Warning = 0,\n  Error = 1,\n  Suggestion = 2,\n  Message = 3,\n}\n\nexport async function getFormattedDiagnostic(\n  ts: typeof import('typescript'),\n  baseDir: string,\n  diagnostic: import('typescript').Diagnostic\n): Promise<string> {\n  let message = ''\n\n  const reason = ts.flattenDiagnosticMessageText(diagnostic.messageText, '\\n')\n  const category = diagnostic.category\n  switch (category) {\n    // Warning\n    case DiagnosticCategory.Warning: {\n      message += chalk.yellow.bold('Type warning') + ': '\n      break\n    }\n    // Error\n    case DiagnosticCategory.Error: {\n      message += chalk.red.bold('Type error') + ': '\n      break\n    }\n    // 2 = Suggestion, 3 = Message\n    case DiagnosticCategory.Suggestion:\n    case DiagnosticCategory.Message:\n    default: {\n      message += chalk.cyan.bold(category === 2 ? 'Suggestion' : 'Info') + ': '\n      break\n    }\n  }\n  message += reason + '\\n'\n\n  if (diagnostic.file) {\n    const pos = diagnostic.file.getLineAndCharacterOfPosition(diagnostic.start!)\n    const line = pos.line + 1\n    const character = pos.character + 1\n\n    let fileName = path.posix.normalize(\n      path.relative(baseDir, diagnostic.file.fileName).replace(/\\\\/g, '/')\n    )\n    if (!fileName.startsWith('.')) {\n      fileName = './' + fileName\n    }\n\n    message =\n      chalk.cyan(fileName) +\n      ':' +\n      chalk.yellow(line.toString()) +\n      ':' +\n      chalk.yellow(character.toString()) +\n      '\\n' +\n      message\n\n    message +=\n      '\\n' +\n      codeFrameColumns(\n        diagnostic.file.getFullText(diagnostic.file.getSourceFile()),\n        {\n          start: { line: line, column: character },\n        },\n        { forceColor: true }\n      )\n  }\n\n  return message\n}\n"],"names":["getFormattedDiagnostic","DiagnosticCategory","Warning","Error","Suggestion","Message","ts","baseDir","diagnostic","message","reason","flattenDiagnosticMessageText","messageText","category","yellow","bold","red","cyan","file","pos","getLineAndCharacterOfPosition","start","line","character","fileName","posix","normalize","relative","replace","startsWith","toString","getFullText","getSourceFile","column","forceColor"],"mappings":"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"}