{"version":3,"sources":["../../../lib/typescript/getTypeScriptIntent.ts"],"sourcesContent":["import { promises as fs } from 'fs'\nimport path from 'path'\nimport { NextConfigComplete } from '../../server/config-shared'\nimport { fileExists } from '../file-exists'\nimport { recursiveReadDir } from '../recursive-readdir'\n\nexport type TypeScriptIntent = { firstTimeSetup: boolean }\n\nexport async function getTypeScriptIntent(\n  baseDir: string,\n  pagesDir: string,\n  config: NextConfigComplete\n): Promise<TypeScriptIntent | false> {\n  const tsConfigPath = path.join(baseDir, config.typescript.tsconfigPath)\n\n  // The integration turns on if we find a `tsconfig.json` in the user's\n  // project.\n  const hasTypeScriptConfiguration = await fileExists(tsConfigPath)\n  if (hasTypeScriptConfiguration) {\n    const content = await fs.readFile(tsConfigPath, { encoding: 'utf8' }).then(\n      (txt) => txt.trim(),\n      () => null\n    )\n    return { firstTimeSetup: content === '' || content === '{}' }\n  }\n\n  // Next.js also offers a friendly setup mode that bootstraps a TypeScript\n  // project for the user when we detect TypeScript files. So, we need to check\n  // the `pages/` directory for a TypeScript file.\n  // Checking all directories is too slow, so this is a happy medium.\n  const typescriptFiles = await recursiveReadDir(\n    pagesDir,\n    /.*\\.(ts|tsx)$/,\n    /(node_modules|.*\\.d\\.ts)/\n  )\n  if (typescriptFiles.length) {\n    return { firstTimeSetup: true }\n  }\n\n  return false\n}\n"],"names":["getTypeScriptIntent","baseDir","pagesDir","config","tsConfigPath","join","typescript","tsconfigPath","hasTypeScriptConfiguration","content","readFile","encoding","then","txt","trim","firstTimeSetup","typescriptFiles","length"],"mappings":";;;;QAQsBA,mBAAmB,GAAnBA,mBAAmB;AARV,GAAI,CAAJ,GAAI;AAClB,GAAM,CAAN,KAAM;AAEI,GAAgB,CAAhB,WAAgB;AACV,GAAsB,CAAtB,iBAAsB;;;;;;eAIjCA,mBAAmB,CACvCC,OAAe,EACfC,QAAgB,EAChBC,MAA0B,EACS,CAAC;IACpC,KAAK,CAACC,YAAY,GAZH,KAAM,SAYKC,IAAI,CAACJ,OAAO,EAAEE,MAAM,CAACG,UAAU,CAACC,YAAY;IAEtE,EAAsE,AAAtE,oEAAsE;IACtE,EAAW,AAAX,SAAW;IACX,KAAK,CAACC,0BAA0B,GAAG,KAAK,KAdf,WAAgB,aAcWJ,YAAY;IAChE,EAAE,EAAEI,0BAA0B,EAAE,CAAC;QAC/B,KAAK,CAACC,OAAO,GAAG,KAAK,CAnBM,GAAI,UAmBNC,QAAQ,CAACN,YAAY,EAAE,CAAC;YAACO,QAAQ,EAAE,CAAM;QAAC,CAAC,EAAEC,IAAI,EACvEC,GAAG,GAAKA,GAAG,CAACC,IAAI;cACX,IAAI;;QAEZ,MAAM,CAAC,CAAC;YAACC,cAAc,EAAEN,OAAO,KAAK,CAAE,KAAIA,OAAO,KAAK,CAAI;QAAC,CAAC;IAC/D,CAAC;IAED,EAAyE,AAAzE,uEAAyE;IACzE,EAA6E,AAA7E,2EAA6E;IAC7E,EAAgD,AAAhD,8CAAgD;IAChD,EAAmE,AAAnE,iEAAmE;IACnE,KAAK,CAACO,eAAe,GAAG,KAAK,KA1BE,iBAAsB,mBA2BnDd,QAAQ;IAIV,EAAE,EAAEc,eAAe,CAACC,MAAM,EAAE,CAAC;QAC3B,MAAM,CAAC,CAAC;YAACF,cAAc,EAAE,IAAI;QAAC,CAAC;IACjC,CAAC;IAED,MAAM,CAAC,KAAK;AACd,CAAC"}