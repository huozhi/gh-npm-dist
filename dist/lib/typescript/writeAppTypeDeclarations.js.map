{"version":3,"sources":["../../../lib/typescript/writeAppTypeDeclarations.ts"],"sourcesContent":["import os from 'os'\nimport path from 'path'\nimport { promises as fs } from 'fs'\n\nexport async function writeAppTypeDeclarations(\n  baseDir: string,\n  imageImportsEnabled: boolean\n): Promise<void> {\n  // Reference `next` types\n  const appTypeDeclarations = path.join(baseDir, 'next-env.d.ts')\n\n  // Defaults EOL to system default\n  let eol = os.EOL\n  let currentContent: string | undefined\n\n  try {\n    currentContent = await fs.readFile(appTypeDeclarations, 'utf8')\n    // If file already exists then preserve its line ending\n    const lf = currentContent.indexOf('\\n', /* skip first so we can lf - 1 */ 1)\n\n    if (lf !== -1) {\n      if (currentContent[lf - 1] === '\\r') {\n        eol = '\\r\\n'\n      } else {\n        eol = '\\n'\n      }\n    }\n  } catch (err) {}\n\n  const content =\n    '/// <reference types=\"next\" />' +\n    eol +\n    (imageImportsEnabled\n      ? '/// <reference types=\"next/image-types/global\" />' + eol\n      : '') +\n    eol +\n    '// NOTE: This file should not be edited' +\n    eol +\n    '// see https://nextjs.org/docs/basic-features/typescript for more information.' +\n    eol\n\n  // Avoids an un-necessary write on read-only fs\n  if (currentContent === content) {\n    return\n  }\n  await fs.writeFile(appTypeDeclarations, content)\n}\n"],"names":["writeAppTypeDeclarations","baseDir","imageImportsEnabled","appTypeDeclarations","join","eol","EOL","currentContent","readFile","lf","indexOf","err","content","writeFile"],"mappings":";;;;QAIsBA,wBAAwB,GAAxBA,wBAAwB;AAJ/B,GAAI,CAAJ,GAAI;AACF,GAAM,CAAN,KAAM;AACQ,GAAI,CAAJ,GAAI;;;;;;eAEbA,wBAAwB,CAC5CC,OAAe,EACfC,mBAA4B,EACb,CAAC;IAChB,EAAyB,AAAzB,uBAAyB;IACzB,KAAK,CAACC,mBAAmB,GARV,KAAM,SAQYC,IAAI,CAACH,OAAO,EAAE,CAAe;IAE9D,EAAiC,AAAjC,+BAAiC;IACjC,GAAG,CAACI,GAAG,GAZM,GAAI,SAYJC,GAAG;IAChB,GAAG,CAACC,cAAc;IAElB,GAAG,CAAC,CAAC;QACHA,cAAc,GAAG,KAAK,CAdK,GAAI,UAcLC,QAAQ,CAACL,mBAAmB,EAAE,CAAM;QAC9D,EAAuD,AAAvD,qDAAuD;QACvD,KAAK,CAACM,EAAE,GAAGF,cAAc,CAACG,OAAO,CAAC,CAAI,KAAE,EAAiC,AAAjC,6BAAiC,AAAjC,EAAiC,CAAC,CAAC;QAE3E,EAAE,EAAED,EAAE,MAAM,CAAC,EAAE,CAAC;YACd,EAAE,EAAEF,cAAc,CAACE,EAAE,GAAG,CAAC,MAAM,CAAI,KAAE,CAAC;gBACpCJ,GAAG,GAAG,CAAM;YACd,CAAC,MAAM,CAAC;gBACNA,GAAG,GAAG,CAAI;YACZ,CAAC;QACH,CAAC;IACH,CAAC,CAAC,KAAK,EAAEM,GAAG,EAAE,CAAC,CAAC;IAEhB,KAAK,CAACC,OAAO,GACX,CAAgC,kCAChCP,GAAG,IACFH,mBAAmB,GAChB,CAAmD,qDAAGG,GAAG,GACzD,CAAE,KACNA,GAAG,GACH,CAAyC,2CACzCA,GAAG,GACH,CAAgF,kFAChFA,GAAG;IAEL,EAA+C,AAA/C,6CAA+C;IAC/C,EAAE,EAAEE,cAAc,KAAKK,OAAO,EAAE,CAAC;QAC/B,MAAM;IACR,CAAC;IACD,KAAK,CA3CwB,GAAI,UA2CxBC,SAAS,CAACV,mBAAmB,EAAES,OAAO;AACjD,CAAC"}