{"version":3,"sources":["../../lib/get-package-version.ts"],"sourcesContent":["import { promises as fs } from 'fs'\nimport findUp from 'next/dist/compiled/find-up'\nimport JSON5 from 'next/dist/compiled/json5'\nimport * as path from 'path'\n\ntype PackageJsonDependencies = {\n  dependencies: Record<string, string>\n  devDependencies: Record<string, string>\n}\n\nlet cachedDeps: PackageJsonDependencies\n\nasync function getDependencies({\n  cwd,\n}: {\n  cwd: string\n}): Promise<PackageJsonDependencies> {\n  if (cachedDeps) {\n    return cachedDeps\n  }\n\n  const configurationPath: string | undefined = await findUp('package.json', {\n    cwd,\n  })\n  if (!configurationPath) {\n    return (cachedDeps = { dependencies: {}, devDependencies: {} })\n  }\n\n  const content = await fs.readFile(configurationPath, 'utf-8')\n  const packageJson: any = JSON5.parse(content)\n\n  const { dependencies = {}, devDependencies = {} } = packageJson || {}\n  return (cachedDeps = { dependencies, devDependencies })\n}\n\nexport async function getPackageVersion({\n  cwd,\n  name,\n}: {\n  cwd: string\n  name: string\n}): Promise<string | null> {\n  const { dependencies, devDependencies } = await getDependencies({ cwd })\n  if (!(dependencies[name] || devDependencies[name])) {\n    return null\n  }\n\n  const cwd2 =\n    cwd.endsWith(path.posix.sep) || cwd.endsWith(path.win32.sep)\n      ? cwd\n      : `${cwd}/`\n\n  try {\n    const targetPath = require.resolve(`${name}/package.json`, {\n      paths: [cwd2],\n    })\n    const targetContent = await fs.readFile(targetPath, 'utf-8')\n    return JSON5.parse(targetContent).version ?? null\n  } catch {\n    return null\n  }\n}\n"],"names":["getPackageVersion","path","cachedDeps","getDependencies","cwd","configurationPath","dependencies","devDependencies","content","readFile","packageJson","parse","name","cwd2","endsWith","posix","sep","win32","targetPath","require","resolve","paths","targetContent","JSON5","version"],"mappings":";;;;QAmCsBA,iBAAiB,GAAjBA,iBAAiB;AAnCR,GAAI,CAAJ,GAAI;AAChB,GAA4B,CAA5B,OAA4B;AAC7B,GAA0B,CAA1B,MAA0B;AAChCC,GAAI,CAAJA,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOhB,GAAG,CAACC,UAAU;eAECC,eAAe,CAAC,CAAC,CAC9BC,GAAG,EAGL,CAAC,EAAoC,CAAC;IACpC,EAAE,EAAEF,UAAU,EAAE,CAAC;QACf,MAAM,CAACA,UAAU;IACnB,CAAC;IAED,KAAK,CAACG,iBAAiB,GAAuB,KAAK,KApBlC,OAA4B,UAoBc,CAAc,eAAE,CAAC;QAC1ED,GAAG;IACL,CAAC;IACD,EAAE,GAAGC,iBAAiB,EAAE,CAAC;QACvB,MAAM,CAAEH,UAAU,GAAG,CAAC;YAACI,YAAY,EAAE,CAAC,CAAC;YAAEC,eAAe,EAAE,CAAC,CAAC;QAAC,CAAC;IAChE,CAAC;IAED,KAAK,CAACC,OAAO,GAAG,KAAK,CA5BQ,GAAI,UA4BRC,QAAQ,CAACJ,iBAAiB,EAAE,CAAO;IAC5D,KAAK,CAACK,WAAW,GA3BD,MAA0B,SA2BXC,KAAK,CAACH,OAAO;IAE5C,KAAK,CAAC,CAAC,CAACF,YAAY,EAAG,CAAC,CAAC,GAAEC,eAAe,EAAG,CAAC,CAAC,EAAC,CAAC,GAAGG,WAAW,IAAI,CAAC,CAAC;IACrE,MAAM,CAAER,UAAU,GAAG,CAAC;QAACI,YAAY;QAAEC,eAAe;IAAC,CAAC;AACxD,CAAC;eAEqBP,iBAAiB,CAAC,CAAC,CACvCI,GAAG,GACHQ,IAAI,EAIN,CAAC,EAA0B,CAAC;IAC1B,KAAK,CAAC,CAAC,CAACN,YAAY,GAAEC,eAAe,EAAC,CAAC,GAAG,KAAK,CAACJ,eAAe,CAAC,CAAC;QAACC,GAAG;IAAC,CAAC;IACvE,EAAE,IAAIE,YAAY,CAACM,IAAI,KAAKL,eAAe,CAACK,IAAI,IAAI,CAAC;QACnD,MAAM,CAAC,IAAI;IACb,CAAC;IAED,KAAK,CAACC,IAAI,GACRT,GAAG,CAACU,QAAQ,CA7CJb,IAAI,CA6CMc,KAAK,CAACC,GAAG,KAAKZ,GAAG,CAACU,QAAQ,CA7CpCb,IAAI,CA6CsCgB,KAAK,CAACD,GAAG,IACvDZ,GAAG,MACAA,GAAG,CAAC,CAAC;IAEd,GAAG,CAAC,CAAC;QACH,KAAK,CAACc,UAAU,GAAGC,OAAO,CAACC,OAAO,IAAIR,IAAI,CAAC,aAAa,GAAG,CAAC;YAC1DS,KAAK,EAAE,CAACR;gBAAAA,IAAI;YAAA,CAAC;QACf,CAAC;QACD,KAAK,CAACS,aAAa,GAAG,KAAK,CAxDA,GAAI,UAwDAb,QAAQ,CAACS,UAAU,EAAE,CAAO;YACpDK,QAAkC;QAAzC,MAAM,EAACA,QAAkC,GAvD3B,MAA0B,SAuD3BZ,KAAK,CAACW,aAAa,EAAEE,OAAO,cAAlCD,QAAkC,cAAlCA,QAAkC,GAAI,IAAI;IACnD,CAAC,CAAC,KAAK,EAAC,CAAC;QACP,MAAM,CAAC,IAAI;IACb,CAAC;AACH,CAAC"}