{"version":3,"sources":["../../../lib/helpers/install.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nimport chalk from 'next/dist/compiled/chalk'\nimport spawn from 'next/dist/compiled/cross-spawn'\n\ninterface InstallArgs {\n  /**\n   * Indicate whether to install packages using Yarn.\n   */\n  useYarn: boolean\n  /**\n   * Indicate whether there is an active Internet connection.\n   */\n  isOnline: boolean\n  /**\n   * Indicate whether the given dependencies are devDependencies.\n   */\n  devDependencies?: boolean\n}\n\n/**\n * Spawn a package manager installation with either Yarn or NPM.\n *\n * @returns A Promise that resolves once the installation is finished.\n */\nexport function install(\n  root: string,\n  dependencies: string[] | null,\n  { useYarn, isOnline, devDependencies }: InstallArgs\n): Promise<void> {\n  /**\n   * NPM-specific command-line flags.\n   */\n  const npmFlags: string[] = []\n  /**\n   * Yarn-specific command-line flags.\n   */\n  const yarnFlags: string[] = []\n  /**\n   * Return a Promise that resolves once the installation is finished.\n   */\n  return new Promise((resolve, reject) => {\n    let args: string[]\n    let command: string = useYarn ? 'yarnpkg' : 'npm'\n\n    if (dependencies && dependencies.length) {\n      /**\n       * If there are dependencies, run a variation of `{displayCommand} add`.\n       */\n      if (useYarn) {\n        /**\n         * Call `yarn add --exact (--offline)? (-D)? ...`.\n         */\n        args = ['add', '--exact']\n        if (!isOnline) args.push('--offline')\n        args.push('--cwd', root)\n        if (devDependencies) args.push('--dev')\n        args.push(...dependencies)\n      } else {\n        /**\n         * Call `npm install [--save|--save-dev] ...`.\n         */\n        args = ['install', '--save-exact']\n        args.push(devDependencies ? '--save-dev' : '--save')\n        args.push(...dependencies)\n      }\n    } else {\n      /**\n       * If there are no dependencies, run a variation of `{displayCommand}\n       * install`.\n       */\n      args = ['install']\n      if (!isOnline) {\n        console.log(chalk.yellow('You appear to be offline.'))\n        if (useYarn) {\n          console.log(chalk.yellow('Falling back to the local Yarn cache.'))\n          console.log()\n          args.push('--offline')\n        } else {\n          console.log()\n        }\n      }\n    }\n    /**\n     * Add any package manager-specific flags.\n     */\n    if (useYarn) {\n      args.push(...yarnFlags)\n    } else {\n      args.push(...npmFlags)\n    }\n    /**\n     * Spawn the installation process.\n     */\n    const child = spawn(command, args, {\n      stdio: 'inherit',\n      env: {\n        ...process.env,\n        NODE_ENV: devDependencies ? 'development' : 'production',\n        ADBLOCK: '1',\n        DISABLE_OPENCOLLECTIVE: '1',\n      },\n    })\n    child.on('close', (code) => {\n      if (code !== 0) {\n        reject({ command: `${command} ${args.join(' ')}` })\n        return\n      }\n      resolve()\n    })\n  })\n}\n"],"names":["install","root","dependencies","useYarn","isOnline","devDependencies","npmFlags","yarnFlags","Promise","resolve","reject","args","command","length","push","console","log","yellow","child","stdio","env","process","NODE_ENV","ADBLOCK","DISABLE_OPENCOLLECTIVE","on","code","join"],"mappings":"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"}