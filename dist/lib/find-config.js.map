{"version":3,"sources":["../../lib/find-config.ts"],"sourcesContent":["import findUp from 'next/dist/compiled/find-up'\nimport fs from 'fs'\nimport JSON5 from 'next/dist/compiled/json5'\n\ntype RecursivePartial<T> = {\n  [P in keyof T]?: RecursivePartial<T[P]>\n}\n\n// We'll allow configuration to be typed, but we force everything provided to\n// become optional. We do not perform any schema validation. We should maybe\n// force all the types to be `unknown` as well.\nexport async function findConfig<T>(\n  directory: string,\n  key: string\n): Promise<RecursivePartial<T> | null> {\n  // `package.json` configuration always wins. Let's check that first.\n  const packageJsonPath = await findUp('package.json', { cwd: directory })\n  if (packageJsonPath) {\n    const packageJson = require(packageJsonPath)\n    if (packageJson[key] != null && typeof packageJson[key] === 'object') {\n      return packageJson[key]\n    }\n  }\n\n  // If we didn't find the configuration in `package.json`, we should look for\n  // known filenames.\n  const filePath = await findUp(\n    [\n      `.${key}rc.json`,\n      `${key}.config.json`,\n      `.${key}rc.js`,\n      `${key}.config.js`,\n    ],\n    {\n      cwd: directory,\n    }\n  )\n  if (filePath) {\n    if (filePath.endsWith('.js')) {\n      return require(filePath)\n    }\n\n    // We load JSON contents with JSON5 to allow users to comment in their\n    // configuration file. This pattern was popularized by TypeScript.\n    const fileContents = fs.readFileSync(filePath, 'utf8')\n    return JSON5.parse(fileContents)\n  }\n\n  return null\n}\n"],"names":["findConfig","directory","key","packageJsonPath","cwd","packageJson","require","filePath","endsWith","fileContents","readFileSync","parse"],"mappings":";;;;QAWsBA,UAAU,GAAVA,UAAU;AAXb,GAA4B,CAA5B,OAA4B;AAChC,GAAI,CAAJ,GAAI;AACD,GAA0B,CAA1B,MAA0B;;;;;;eAStBA,UAAU,CAC9BC,SAAiB,EACjBC,GAAW,EAC0B,CAAC;IACtC,EAAoE,AAApE,kEAAoE;IACpE,KAAK,CAACC,eAAe,GAAG,KAAK,KAhBZ,OAA4B,UAgBR,CAAc,eAAE,CAAC;QAACC,GAAG,EAAEH,SAAS;IAAC,CAAC;IACvE,EAAE,EAAEE,eAAe,EAAE,CAAC;QACpB,KAAK,CAACE,WAAW,GAAGC,OAAO,CAACH,eAAe;QAC3C,EAAE,EAAEE,WAAW,CAACH,GAAG,KAAK,IAAI,IAAI,MAAM,CAACG,WAAW,CAACH,GAAG,MAAM,CAAQ,SAAE,CAAC;YACrE,MAAM,CAACG,WAAW,CAACH,GAAG;QACxB,CAAC;IACH,CAAC;IAED,EAA4E,AAA5E,0EAA4E;IAC5E,EAAmB,AAAnB,iBAAmB;IACnB,KAAK,CAACK,QAAQ,GAAG,KAAK,KA1BL,OAA4B,UA2B3C,CAAC;SACE,CAAC,EAAEL,GAAG,CAAC,OAAO;WACZA,GAAG,CAAC,YAAY;SAClB,CAAC,EAAEA,GAAG,CAAC,KAAK;WACVA,GAAG,CAAC,UAAU;IACnB,CAAC,EACD,CAAC;QACCE,GAAG,EAAEH,SAAS;IAChB,CAAC;IAEH,EAAE,EAAEM,QAAQ,EAAE,CAAC;QACb,EAAE,EAAEA,QAAQ,CAACC,QAAQ,CAAC,CAAK,OAAG,CAAC;YAC7B,MAAM,CAACF,OAAO,CAACC,QAAQ;QACzB,CAAC;QAED,EAAsE,AAAtE,oEAAsE;QACtE,EAAkE,AAAlE,gEAAkE;QAClE,KAAK,CAACE,YAAY,GA3CP,GAAI,SA2CSC,YAAY,CAACH,QAAQ,EAAE,CAAM;QACrD,MAAM,CA3CQ,MAA0B,SA2C3BI,KAAK,CAACF,YAAY;IACjC,CAAC;IAED,MAAM,CAAC,IAAI;AACb,CAAC"}