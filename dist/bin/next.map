{"version":3,"sources":["../../bin/next.ts"],"sourcesContent":["#!/usr/bin/env node\nimport * as log from '../build/output/log'\nimport arg from 'next/dist/compiled/arg/index.js'\nimport { NON_STANDARD_NODE_ENV } from '../lib/constants'\n;['react', 'react-dom'].forEach((dependency) => {\n  try {\n    // When 'npm link' is used it checks the clone location. Not the project.\n    require.resolve(dependency)\n  } catch (err) {\n    console.warn(\n      `The module '${dependency}' was not found. Next.js requires that you include it in 'dependencies' of your 'package.json'. To add it, run 'npm install ${dependency}'`\n    )\n  }\n})\n\nconst defaultCommand = 'dev'\nexport type cliCommand = (argv?: string[]) => void\nconst commands: { [command: string]: () => Promise<cliCommand> } = {\n  build: () => Promise.resolve(require('../cli/next-build').nextBuild),\n  start: () => Promise.resolve(require('../cli/next-start').nextStart),\n  export: () => Promise.resolve(require('../cli/next-export').nextExport),\n  dev: () => Promise.resolve(require('../cli/next-dev').nextDev),\n  lint: () => Promise.resolve(require('../cli/next-lint').nextLint),\n  telemetry: () =>\n    Promise.resolve(require('../cli/next-telemetry').nextTelemetry),\n  info: () => Promise.resolve(require('../cli/next-info').nextInfo),\n}\n\nconst args = arg(\n  {\n    // Types\n    '--version': Boolean,\n    '--help': Boolean,\n    '--inspect': Boolean,\n\n    // Aliases\n    '-v': '--version',\n    '-h': '--help',\n  },\n  {\n    permissive: true,\n  }\n)\n\n// Version is inlined into the file using taskr build pipeline\nif (args['--version']) {\n  console.log(`Next.js v${process.env.__NEXT_VERSION}`)\n  process.exit(0)\n}\n\n// Check if we are running `next <subcommand>` or `next`\nconst foundCommand = Boolean(commands[args._[0]])\n\n// Makes sure the `next --help` case is covered\n// This help message is only showed for `next --help`\n// `next <subcommand> --help` falls through to be handled later\nif (!foundCommand && args['--help']) {\n  console.log(`\n    Usage\n      $ next <command>\n\n    Available commands\n      ${Object.keys(commands).join(', ')}\n\n    Options\n      --version, -v   Version number\n      --help, -h      Displays this message\n\n    For more information run a command with the --help flag\n      $ next build --help\n  `)\n  process.exit(0)\n}\n\nconst command = foundCommand ? args._[0] : defaultCommand\nconst forwardedArgs = foundCommand ? args._.slice(1) : args._\n\nif (args['--inspect'])\n  throw new Error(\n    `--inspect flag is deprecated. Use env variable NODE_OPTIONS instead: NODE_OPTIONS='--inspect' next ${command}`\n  )\n\n// Make sure the `next <subcommand> --help` case is covered\nif (args['--help']) {\n  forwardedArgs.push('--help')\n}\n\nconst defaultEnv = command === 'dev' ? 'development' : 'production'\n\nconst standardEnv = ['production', 'development', 'test']\n\nif (process.env.NODE_ENV) {\n  const isNotStandard = !standardEnv.includes(process.env.NODE_ENV)\n  const shouldWarnCommands =\n    process.env.NODE_ENV === 'development'\n      ? ['start', 'build']\n      : process.env.NODE_ENV === 'production'\n      ? ['dev']\n      : []\n\n  if (isNotStandard || shouldWarnCommands.includes(command)) {\n    log.warn(NON_STANDARD_NODE_ENV)\n  }\n}\n\n;(process.env as any).NODE_ENV = process.env.NODE_ENV || defaultEnv\n\n// Make sure commands gracefully respect termination signals (e.g. from Docker)\nprocess.on('SIGTERM', () => process.exit(0))\nprocess.on('SIGINT', () => process.exit(0))\n\ncommands[command]()\n  .then((exec) => exec(forwardedArgs))\n  .then(() => {\n    if (command === 'build') {\n      // ensure process exits after build completes so open handles/connections\n      // don't cause process to hang\n      process.exit(0)\n    }\n  })\n\nif (command === 'dev') {\n  const { CONFIG_FILES } = require('../shared/lib/constants')\n  const { watchFile } = require('fs')\n\n  for (const CONFIG_FILE of CONFIG_FILES) {\n    watchFile(`${process.cwd()}/${CONFIG_FILE}`, (cur: any, prev: any) => {\n      if (cur.size > 0 || prev.size > 0) {\n        console.log(\n          `\\n> Found a change in ${CONFIG_FILE}. Restart the server to see the changes in effect.`\n        )\n      }\n    })\n  }\n}\n"],"names":["log","forEach","dependency","require","resolve","err","console","warn","defaultCommand","commands","build","Promise","nextBuild","start","nextStart","export","nextExport","dev","nextDev","lint","nextLint","telemetry","nextTelemetry","info","nextInfo","args","Boolean","permissive","process","env","__NEXT_VERSION","exit","foundCommand","_","Object","keys","join","command","forwardedArgs","slice","Error","push","defaultEnv","standardEnv","NODE_ENV","isNotStandard","includes","shouldWarnCommands","on","then","exec","CONFIG_FILES","watchFile","CONFIG_FILE","cwd","cur","prev","size"],"mappings":"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"}