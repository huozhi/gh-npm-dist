{"version":3,"sources":["../../../telemetry/events/version.ts"],"sourcesContent":["import path from 'path'\nimport { NextConfigComplete } from '../../server/config-shared'\n\nconst EVENT_VERSION = 'NEXT_CLI_SESSION_STARTED'\n\ntype EventCliSessionStarted = {\n  nextVersion: string\n  nodeVersion: string\n  cliCommand: string\n  isSrcDir: boolean | null\n  hasNowJson: boolean\n  isCustomServer: boolean | null\n  hasNextConfig: boolean\n  buildTarget: string\n  hasWebpackConfig: boolean\n  hasBabelConfig: boolean\n  basePathEnabled: boolean\n  i18nEnabled: boolean\n  imageEnabled: boolean\n  locales: string | null\n  localeDomainsCount: number | null\n  localeDetectionEnabled: boolean | null\n  imageDomainsCount: number | null\n  imageSizes: string | null\n  imageLoader: string | null\n  trailingSlashEnabled: boolean\n  reactStrictMode: boolean\n  webpackVersion: number | null\n}\n\nfunction hasBabelConfig(dir: string): boolean {\n  try {\n    const noopFile = path.join(dir, 'noop.js')\n    const res = require('next/dist/compiled/babel/core').loadPartialConfig({\n      cwd: dir,\n      filename: noopFile,\n      sourceFileName: noopFile,\n    }) as any\n    const isForTooling =\n      res.options?.presets?.every(\n        (e: any) => e?.file?.request === 'next/babel'\n      ) && res.options?.plugins?.length === 0\n    return res.hasFilesystemConfig() && !isForTooling\n  } catch {\n    return false\n  }\n}\n\nexport function eventCliSession(\n  dir: string,\n  nextConfig: NextConfigComplete,\n  event: Omit<\n    EventCliSessionStarted,\n    | 'nextVersion'\n    | 'nodeVersion'\n    | 'hasNextConfig'\n    | 'buildTarget'\n    | 'hasWebpackConfig'\n    | 'hasBabelConfig'\n    | 'basePathEnabled'\n    | 'i18nEnabled'\n    | 'imageEnabled'\n    | 'locales'\n    | 'localeDomainsCount'\n    | 'localeDetectionEnabled'\n    | 'imageDomainsCount'\n    | 'imageSizes'\n    | 'imageLoader'\n    | 'trailingSlashEnabled'\n    | 'reactStrictMode'\n  >\n): { eventName: string; payload: EventCliSessionStarted }[] {\n  // This should be an invariant, if it fails our build tooling is broken.\n  if (typeof process.env.__NEXT_VERSION !== 'string') {\n    return []\n  }\n\n  const { images, i18n } = nextConfig || {}\n\n  const payload: EventCliSessionStarted = {\n    nextVersion: process.env.__NEXT_VERSION,\n    nodeVersion: process.version,\n    cliCommand: event.cliCommand,\n    isSrcDir: event.isSrcDir,\n    hasNowJson: event.hasNowJson,\n    isCustomServer: event.isCustomServer,\n    hasNextConfig: nextConfig.configOrigin !== 'default',\n    buildTarget: nextConfig.target === 'server' ? 'default' : nextConfig.target,\n    hasWebpackConfig: typeof nextConfig?.webpack === 'function',\n    hasBabelConfig: hasBabelConfig(dir),\n    imageEnabled: !!images,\n    basePathEnabled: !!nextConfig?.basePath,\n    i18nEnabled: !!i18n,\n    locales: i18n?.locales ? i18n.locales.join(',') : null,\n    localeDomainsCount: i18n?.domains ? i18n.domains.length : null,\n    localeDetectionEnabled: !i18n ? null : i18n.localeDetection !== false,\n    imageDomainsCount: images?.domains ? images.domains.length : null,\n    imageSizes: images?.imageSizes ? images.imageSizes.join(',') : null,\n    imageLoader: images?.loader,\n    trailingSlashEnabled: !!nextConfig?.trailingSlash,\n    reactStrictMode: !!nextConfig?.reactStrictMode,\n    webpackVersion: event.webpackVersion || null,\n  }\n  return [{ eventName: EVENT_VERSION, payload }]\n}\n"],"names":["eventCliSession","EVENT_VERSION","hasBabelConfig","dir","res","noopFile","join","require","loadPartialConfig","cwd","filename","sourceFileName","isForTooling","options","presets","every","e","file","request","plugins","length","hasFilesystemConfig","nextConfig","event","process","env","__NEXT_VERSION","images","i18n","payload","nextVersion","nodeVersion","version","cliCommand","isSrcDir","hasNowJson","isCustomServer","hasNextConfig","configOrigin","buildTarget","target","hasWebpackConfig","webpack","imageEnabled","basePathEnabled","basePath","i18nEnabled","locales","localeDomainsCount","domains","localeDetectionEnabled","localeDetection","imageDomainsCount","imageSizes","imageLoader","loader","trailingSlashEnabled","trailingSlash","reactStrictMode","webpackVersion","eventName"],"mappings":"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"}