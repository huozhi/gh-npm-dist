{"version":3,"sources":["../../../telemetry/events/plugins.ts"],"sourcesContent":["import findUp from 'next/dist/compiled/find-up'\n\nconst EVENT_PLUGIN_PRESENT = 'NEXT_PACKAGE_DETECTED'\ntype NextPluginsEvent = {\n  eventName: string\n  payload: {\n    packageName: string\n    packageVersion: string\n  }\n}\n\nexport async function eventNextPlugins(\n  dir: string\n): Promise<Array<NextPluginsEvent>> {\n  try {\n    const packageJsonPath = await findUp('package.json', { cwd: dir })\n    if (!packageJsonPath) {\n      return []\n    }\n\n    const { dependencies = {}, devDependencies = {} } = require(packageJsonPath)\n\n    const deps = { ...devDependencies, ...dependencies }\n\n    return Object.keys(deps).reduce(\n      (events: NextPluginsEvent[], plugin: string): NextPluginsEvent[] => {\n        const version = deps[plugin]\n        // Don't add deps without a version set\n        if (!version) {\n          return events\n        }\n\n        events.push({\n          eventName: EVENT_PLUGIN_PRESENT,\n          payload: {\n            packageName: plugin,\n            packageVersion: version,\n          },\n        })\n\n        return events\n      },\n      []\n    )\n  } catch (_) {\n    return []\n  }\n}\n"],"names":["eventNextPlugins","EVENT_PLUGIN_PRESENT","dir","packageJsonPath","cwd","dependencies","devDependencies","require","deps","Object","keys","reduce","events","plugin","version","push","eventName","payload","packageName","packageVersion","_"],"mappings":";;;;QAWsBA,gBAAgB,GAAhBA,gBAAgB;AAXnB,GAA4B,CAA5B,OAA4B;;;;;;AAE/C,KAAK,CAACC,oBAAoB,GAAG,CAAuB;eAS9BD,gBAAgB,CACpCE,GAAW,EACuB,CAAC;IACnC,GAAG,CAAC,CAAC;QACH,KAAK,CAACC,eAAe,GAAG,KAAK,KAfd,OAA4B,UAeN,CAAc,eAAE,CAAC;YAACC,GAAG,EAAEF,GAAG;QAAC,CAAC;QACjE,EAAE,GAAGC,eAAe,EAAE,CAAC;YACrB,MAAM,CAAC,CAAC,CAAC;QACX,CAAC;QAED,KAAK,CAAC,CAAC,CAACE,YAAY,EAAG,CAAC,CAAC,GAAEC,eAAe,EAAG,CAAC,CAAC,EAAC,CAAC,GAAGC,OAAO,CAACJ,eAAe;QAE3E,KAAK,CAACK,IAAI,GAAG,CAAC;eAAIF,eAAe;eAAKD,YAAY;QAAC,CAAC;QAEpD,MAAM,CAACI,MAAM,CAACC,IAAI,CAACF,IAAI,EAAEG,MAAM,EAC5BC,MAA0B,EAAEC,MAAc,GAAyB,CAAC;YACnE,KAAK,CAACC,OAAO,GAAGN,IAAI,CAACK,MAAM;YAC3B,EAAuC,AAAvC,qCAAuC;YACvC,EAAE,GAAGC,OAAO,EAAE,CAAC;gBACb,MAAM,CAACF,MAAM;YACf,CAAC;YAEDA,MAAM,CAACG,IAAI,CAAC,CAAC;gBACXC,SAAS,EAAEf,oBAAoB;gBAC/BgB,OAAO,EAAE,CAAC;oBACRC,WAAW,EAAEL,MAAM;oBACnBM,cAAc,EAAEL,OAAO;gBACzB,CAAC;YACH,CAAC;YAED,MAAM,CAACF,MAAM;QACf,CAAC,EACD,CAAC,CAAC;IAEN,CAAC,CAAC,KAAK,EAAEQ,CAAC,EAAE,CAAC;QACX,MAAM,CAAC,CAAC,CAAC;IACX,CAAC;AACH,CAAC"}